<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>é™é»˜ã®Blog</title><meta name="description" content="é™é»˜çš„Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">é™é»˜ã®Blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#seata-server-tc-ç¯å¢ƒæ­å»º" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Seata Serverï¼ˆTCï¼‰ç¯å¢ƒæ­å»º"><!--[--><!--]--> Seata Serverï¼ˆTCï¼‰ç¯å¢ƒæ­å»º <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#ä¸‹è½½seata-server" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸‹è½½seata server"><!--[--><!--]--> ä¸‹è½½seata server <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#å»ºè¡¨-dbæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å»ºè¡¨(dbæ¨¡å¼)"><!--[--><!--]--> å»ºè¡¨(dbæ¨¡å¼) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#seataé…ç½®nacos" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="seataé…ç½®nacos"><!--[--><!--]--> seataé…ç½®nacos <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#ä¸Šä¼ é…ç½®è‡³nacosé…ç½®ä¸­å¿ƒ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ"><!--[--><!--]--> ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#å¯åŠ¨" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¯åŠ¨"><!--[--><!--]--> å¯åŠ¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#æ”¯æŒçš„å¯åŠ¨å‚æ•°" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æ”¯æŒçš„å¯åŠ¨å‚æ•°"><!--[--><!--]--> æ”¯æŒçš„å¯åŠ¨å‚æ•° <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#è®¿é—®ç•Œé¢" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è®¿é—®ç•Œé¢"><!--[--><!--]--> è®¿é—®ç•Œé¢ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#seata-clientå¿«é€Ÿå¼€å§‹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Seata Clientå¿«é€Ÿå¼€å§‹"><!--[--><!--]--> Seata Clientå¿«é€Ÿå¼€å§‹ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#ç¯å¢ƒå‡†å¤‡" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç¯å¢ƒå‡†å¤‡"><!--[--><!--]--> ç¯å¢ƒå‡†å¤‡ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#ä¾èµ–" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¾èµ–"><!--[--><!--]--> ä¾èµ– <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo-logè¡¨-ä»…atæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo_logè¡¨(ä»…ATæ¨¡å¼)"><!--[--><!--]--> å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo_logè¡¨(ä»…ATæ¨¡å¼) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#å¾®æœåŠ¡application-ymlä¸­æ·»åŠ seataé…" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¾®æœåŠ¡application.ymlä¸­æ·»åŠ seataé…"><!--[--><!--]--> å¾®æœåŠ¡application.ymlä¸­æ·»åŠ seataé… <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ -globaltransactionalæ³¨" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ @GlobalTransactionalæ³¨"><!--[--><!--]--> åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ @GlobalTransactionalæ³¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æµ‹è¯•"><!--[--><!--]--> æµ‹è¯• <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#å°ç»“" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å°ç»“"><!--[--><!--]--> å°ç»“ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/seata/03%20Seata%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8BAT%E6%A8%A1%E5%BC%8F.html#seataç‰ˆæœ¬" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Seataç‰ˆæœ¬"><!--[--><!--]--> Seataç‰ˆæœ¬ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Seataåˆ†TCã€TMå’ŒRMä¸‰ä¸ªè§’è‰²ï¼ŒTCï¼ˆServerç«¯ï¼‰ä¸ºå•ç‹¬æœåŠ¡ç«¯éƒ¨ç½²ï¼ŒTMå’ŒRMï¼ˆClientç«¯ï¼‰ç”±ä¸šåŠ¡ç³»ç»Ÿé›†æˆ</p></div><h2 id="seata-server-tc-ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#seata-server-tc-ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> <strong>Seata Serverï¼ˆTCï¼‰ç¯å¢ƒæ­å»º</strong></h2><p><strong>Serverç«¯å­˜å‚¨æ¨¡å¼ï¼ˆstore.modeï¼‰æ”¯æŒä¸‰ç§ï¼š</strong></p><ul><li>fileï¼šå•æœºæ¨¡å¼ï¼Œå…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯å†…å­˜ä¸­è¯»å†™å¹¶æŒä¹…åŒ–æœ¬åœ°æ–‡ä»¶root.dataï¼Œæ€§èƒ½è¾ƒé«˜</li><li>dbï¼šé«˜å¯ç”¨æ¨¡å¼ï¼Œå…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯é€šè¿‡dbå…±äº«ï¼Œç›¸åº”æ€§èƒ½å·®äº›</li><li>redisï¼š1.3åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ,æ€§èƒ½è¾ƒé«˜,å­˜åœ¨äº‹åŠ¡ä¿¡æ¯ä¸¢å¤±é£é™©,è¯·æå‰é…ç½®é€‚åˆå½“å‰åœºæ™¯çš„redisæŒä¹…åŒ–é…ç½®</li></ul><blockquote><p><strong>dbå­˜å‚¨æ¨¡å¼+Nacos(æ³¨å†Œ&amp;é…ç½®ä¸­å¿ƒ)æ–¹å¼éƒ¨ç½²</strong></p></blockquote><h3 id="ä¸‹è½½seata-server" tabindex="-1"><a class="header-anchor" href="#ä¸‹è½½seata-server" aria-hidden="true">#</a> ä¸‹è½½seata server</h3><p><a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">Releases Â· seata/seata (github.com)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/images/seata/image-20230420183959655.png" alt="image-20230420183959655"></p><blockquote><p>tar -zxvf seata-server-1.5.2.tar.gz</p></blockquote><h3 id="å»ºè¡¨-dbæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å»ºè¡¨-dbæ¨¡å¼" aria-hidden="true">#</a> <strong>å»ºè¡¨(dbæ¨¡å¼)</strong></h3><p>åˆ›å»ºæ•°æ®åº“seataï¼Œæ‰§è¡Œsqlè„šæœ¬ï¼Œ<a href="https://github.com/seata/seata/tree/v1.5.2/script/server/db" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/tree/v1.5.2/script/server/db<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/images/seata/image-20230420110315652.png" alt="image-20230420110315652"></p><details class="custom-container details"><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------</span>
<span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_status_gmt_modified<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>         <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;0:locked ,1:rollbacking&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid_and_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span>       <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_value<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;AsyncCommitting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;RetryCommitting&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;RetryRollbacking&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;TxTimeoutCheck&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div></details><p><img src="/images/seata/image-20230420110540320.png" alt="image-20230420110540320"></p><h3 id="seataé…ç½®nacos" tabindex="-1"><a class="header-anchor" href="#seataé…ç½®nacos" aria-hidden="true">#</a> seataé…ç½®nacos</h3><p><a href="https://seata.io/zh-cn/docs/user/configuration/nacos.html" target="_blank" rel="noopener noreferrer">nacos (seata.io)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>æ³¨å†Œä¸­å¿ƒå¯ä»¥è¯´æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„â€é€šè®¯å½•â€œï¼Œå®ƒè®°å½•äº†æœåŠ¡å’ŒæœåŠ¡åœ°å€çš„æ˜ å°„å…³ç³»ã€‚åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¼šæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œå½“æœåŠ¡éœ€è¦è°ƒç”¨å…¶å®ƒæœåŠ¡æ—¶ï¼Œå°±åˆ°æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°æœåŠ¡çš„åœ°å€ï¼Œè¿›è¡Œè°ƒç”¨ã€‚æ¯”å¦‚Seata Clientç«¯(TM,RM)ï¼Œå‘ç°Seata Server(TC)é›†ç¾¤çš„åœ°å€,å½¼æ­¤é€šä¿¡ã€‚</p><p>æ³¨æ„ï¼šSeataçš„æ³¨å†Œä¸­å¿ƒæ˜¯ä½œç”¨äºSeataè‡ªèº«çš„ï¼Œå’ŒSpring Cloudçš„æ³¨å†Œä¸­å¿ƒæ— å…³</p><p><img src="/images/seata/54137.png" alt="img"></p><p><strong>é…ç½®å°†Seata Serveræ³¨å†Œåˆ°Nacosï¼Œä¿®æ”¹conf/application.ymlæ–‡ä»¶</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token comment"># support: nacos, consul, apollo, zk, etcd3</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.135.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">group</span> <span class="token punctuation">:</span> <span class="token string">&quot;SEATA_GROUP&quot;</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> c3f112d8<span class="token punctuation">-</span>1c5e<span class="token punctuation">-</span>419e<span class="token punctuation">-</span>9c83<span class="token punctuation">-</span>b0b26b987a42
      <span class="token key atrule">dataId</span><span class="token punctuation">:</span> seataServer.properties
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.135.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> c3f112d8<span class="token punctuation">-</span>1c5e<span class="token punctuation">-</span>419e<span class="token punctuation">-</span>9c83<span class="token punctuation">-</span>b0b26b987a42
      <span class="token key atrule">data-id</span><span class="token punctuation">:</span> seataServer.properties
      <span class="token key atrule">cluster</span><span class="token punctuation">:</span> default
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
  <span class="token key atrule">store</span><span class="token punctuation">:</span>
    <span class="token comment"># support: file ã€ db ã€ redis</span>
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> db
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><blockquote><p>é…ç½®æˆåŠŸånacosçš„æ˜¾ç¤ºæ•ˆæœ</p></blockquote><p><img src="/images/seata/image-20230420200742678.png" alt="image-20230420200742678"></p><p><img src="/images/seata/image-20230420200720491.png" alt="image-20230420200720491"></p><h3 id="ä¸Šä¼ é…ç½®è‡³nacosé…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#ä¸Šä¼ é…ç½®è‡³nacosé…ç½®ä¸­å¿ƒ" aria-hidden="true">#</a> <strong>ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ</strong></h3><p><a href="https://github.com/seata/seata/blob/v1.5.2/script/config-center/config.txt" target="_blank" rel="noopener noreferrer">seata/config.txt at v1.5.2 Â· seata/seata (github.com)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>è·å–/seata/script/config-center/config.txtï¼Œä¿®æ”¹ä¸ºdbå­˜å‚¨æ¨¡å¼ï¼Œå¹¶ä¿®æ”¹mysqlè¿æ¥é…ç½®</p><blockquote><p>ä½¿ç”¨mysql8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ä¸Šä¼ æ–¹å¼åœ¨ï¼šnacosé…ç½®ä¸­å¿ƒè‡ªå·±åˆ›å»ºä¸€ä¸ªé…ç½®ï¼Œç„¶åç²˜è´´ä¸Šå»
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></blockquote><p><img src="/images/seata/image-20230420195417525.png" alt="image-20230420195417525"></p><p>åœ¨store.mode=dbï¼Œç”±äºseataæ˜¯é€šè¿‡jdbcçš„executeBatchæ¥æ‰¹é‡æ’å…¥å…¨å±€é”çš„ï¼Œæ ¹æ®MySQLå®˜ç½‘çš„è¯´æ˜ï¼Œè¿æ¥å‚æ•°ä¸­çš„rewriteBatchedStatementsä¸ºtrueæ—¶ï¼Œåœ¨æ‰§è¡ŒexecuteBatchï¼Œå¹¶ä¸”æ“ä½œç±»å‹ä¸ºinsertæ—¶ï¼Œjdbcé©±åŠ¨ä¼šæŠŠå¯¹åº”çš„SQLä¼˜åŒ–æˆ<code>insert into () values (), ()</code>çš„å½¢å¼æ¥æå‡æ‰¹é‡æ’å…¥çš„æ€§èƒ½ã€‚ æ ¹æ®å®é™…çš„æµ‹è¯•ï¼Œè¯¥å‚æ•°è®¾ç½®ä¸ºtrueåï¼Œå¯¹åº”çš„æ‰¹é‡æ’å…¥æ€§èƒ½ä¸ºåŸæ¥çš„10å€å¤šï¼Œå› æ­¤åœ¨æ•°æ®æºä¸ºMySQLæ—¶ï¼Œå»ºè®®æŠŠè¯¥å‚æ•°è®¾ç½®ä¸ºtrueã€‚</p><hr><p>é…ç½®äº‹åŠ¡åˆ†ç»„ï¼Œ è¦ä¸clienté…ç½®çš„äº‹åŠ¡åˆ†ç»„ä¸€è‡´</p><ul><li>äº‹åŠ¡åˆ†ç»„ï¼šseataçš„èµ„æºé€»è¾‘ï¼Œå¯ä»¥æŒ‰å¾®æœåŠ¡çš„éœ€è¦ï¼Œåœ¨åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹è‡ªè¡Œå®šä¹‰äº‹åŠ¡åˆ†ç»„ï¼Œæ¯ç»„å–ä¸€ä¸ªåå­—ã€‚</li><li>é›†ç¾¤ï¼šseata-serveræœåŠ¡ç«¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤clusterã€‚ åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šäº‹åŠ¡é€»è¾‘åˆ†ç»„ä¸SeataæœåŠ¡ç«¯é›†ç¾¤çš„æ˜ å°„å…³ç³»ã€‚</li></ul><p>â€‹ <img src="/images/seata/53977.png" alt="0"></p><p>äº‹åŠ¡åˆ†ç»„å¦‚ä½•æ‰¾åˆ°åç«¯Seataé›†ç¾¤ï¼ˆTCï¼‰ï¼Ÿ</p><ol><li>é¦–å…ˆåº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸­é…ç½®äº†äº‹åŠ¡åˆ†ç»„ï¼ˆGlobalTransactionScanner æ„é€ æ–¹æ³•çš„txServiceGroupå‚æ•°ï¼‰ã€‚è‹¥åº”ç”¨ç¨‹åºæ˜¯SpringBootåˆ™é€šè¿‡seata.tx-service-group é…ç½®ã€‚</li><li>åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä¼šé€šè¿‡ç”¨æˆ·é…ç½®çš„é…ç½®ä¸­å¿ƒå»å¯»æ‰¾service.vgroupMapping .[äº‹åŠ¡åˆ†ç»„é…ç½®é¡¹]ï¼Œå–å¾—é…ç½®é¡¹çš„å€¼å°±æ˜¯TCé›†ç¾¤çš„åç§°ã€‚è‹¥åº”ç”¨ç¨‹åºæ˜¯SpringBootåˆ™é€šè¿‡seata.service.vgroup-mapping.äº‹åŠ¡åˆ†ç»„å=é›†ç¾¤åç§° é…ç½®</li><li>æ‹¿åˆ°é›†ç¾¤åç§°ç¨‹åºé€šè¿‡ä¸€å®šçš„å‰åç¼€+é›†ç¾¤åç§°å»æ„é€ æœåŠ¡åï¼Œå„é…ç½®ä¸­å¿ƒçš„æœåŠ¡åå®ç°ä¸åŒï¼ˆå‰ææ˜¯Seata-Serverå·²ç»å®ŒæˆæœåŠ¡æ³¨å†Œï¼Œä¸”Seata-Serverå‘æ³¨å†Œä¸­å¿ƒæŠ¥å‘Šclusteråä¸åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰é…ç½®çš„é›†ç¾¤åç§°ä¸€è‡´ï¼‰</li><li>æ‹¿åˆ°æœåŠ¡åå»ç›¸åº”çš„æ³¨å†Œä¸­å¿ƒå»æ‹‰å–ç›¸åº”æœåŠ¡åçš„æœåŠ¡åˆ—è¡¨ï¼Œè·å¾—åç«¯çœŸå®çš„TCæœåŠ¡åˆ—è¡¨ï¼ˆå³Seata-Serveré›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼‰</li></ol><hr><p><strong>åœ¨nacosé…ç½®ä¸­å¿ƒä¸­æ–°å»ºé…ç½®ï¼ŒdataIdä¸ºseataServer.properties</strong>ï¼Œé…ç½®å†…å®¹ä¸ºä¸Šé¢ä¿®æ”¹åçš„config.txtä¸­çš„é…ç½®ä¿¡æ¯</p><blockquote><p>ä»v1.4.2ç‰ˆæœ¬å¼€å§‹ï¼Œseataå·²æ”¯æŒä»ä¸€ä¸ªNacos dataIdä¸­è·å–æ‰€æœ‰é…ç½®ä¿¡æ¯,ä½ åªéœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªdataIdé…ç½®é¡¹ã€‚</p></blockquote><p>â€‹ <img src="/images/seata/54003.png" alt="0"></p><details class="custom-container details"><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span>
<span class="token comment">#Transport configuration, for client and server</span>
<span class="token key attr-name">transport.type</span><span class="token punctuation">=</span><span class="token value attr-value">TCP</span>
<span class="token key attr-name">transport.server</span><span class="token punctuation">=</span><span class="token value attr-value">NIO</span>
<span class="token key attr-name">transport.heartbeat</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">transport.enableTmClientBatchSendRequest</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">transport.enableRmClientBatchSendRequest</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">transport.enableTcServerBatchSendResponse</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">transport.rpcRmRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span>
<span class="token key attr-name">transport.rpcTmRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span>
<span class="token key attr-name">transport.rpcTcRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span>
<span class="token key attr-name">transport.threadFactory.bossThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyBoss</span>
<span class="token key attr-name">transport.threadFactory.workerThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyServerNIOWorker</span>
<span class="token key attr-name">transport.threadFactory.serverExecutorThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyServerBizHandler</span>
<span class="token key attr-name">transport.threadFactory.shareBossWorker</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">transport.threadFactory.clientSelectorThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyClientSelector</span>
<span class="token key attr-name">transport.threadFactory.clientSelectorThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">transport.threadFactory.clientWorkerThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyClientWorkerThread</span>
<span class="token key attr-name">transport.threadFactory.bossThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">transport.threadFactory.workerThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token key attr-name">transport.shutdown.wait</span><span class="token punctuation">=</span><span class="token value attr-value">3</span>
<span class="token key attr-name">transport.serialization</span><span class="token punctuation">=</span><span class="token value attr-value">seata</span>
<span class="token key attr-name">transport.compressor</span><span class="token punctuation">=</span><span class="token value attr-value">none</span>

<span class="token comment">#Transaction routing rules configuration, only for the client</span>
<span class="token key attr-name">service.vgroupMapping.default_tx_group</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token comment">#If you use a registry, you can ignore it</span>
<span class="token key attr-name">service.default.grouplist</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8091</span>
<span class="token key attr-name">service.enableDegrade</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">service.disableGlobalTransaction</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>

<span class="token comment">#Transaction rule configuration, only for the client</span>
<span class="token key attr-name">client.rm.asyncCommitBufferLimit</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span>
<span class="token key attr-name">client.rm.lock.retryInterval</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
<span class="token key attr-name">client.rm.lock.retryTimes</span><span class="token punctuation">=</span><span class="token value attr-value">30</span>
<span class="token key attr-name">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">client.rm.reportRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">client.rm.tableMetaCheckEnable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">client.rm.tableMetaCheckerInterval</span><span class="token punctuation">=</span><span class="token value attr-value">60000</span>
<span class="token key attr-name">client.rm.sqlParserType</span><span class="token punctuation">=</span><span class="token value attr-value">druid</span>
<span class="token key attr-name">client.rm.reportSuccessEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">client.rm.sagaBranchRegisterEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">client.rm.sagaJsonParser</span><span class="token punctuation">=</span><span class="token value attr-value">fastjson</span>
<span class="token key attr-name">client.rm.tccActionInterceptorOrder</span><span class="token punctuation">=</span><span class="token value attr-value">-2147482648</span>
<span class="token key attr-name">client.tm.commitRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">client.tm.rollbackRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">client.tm.defaultGlobalTransactionTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">60000</span>
<span class="token key attr-name">client.tm.degradeCheck</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">client.tm.degradeCheckAllowTimes</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
<span class="token key attr-name">client.tm.degradeCheckPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">2000</span>
<span class="token key attr-name">client.tm.interceptorOrder</span><span class="token punctuation">=</span><span class="token value attr-value">-2147482648</span>
<span class="token key attr-name">client.undo.dataValidation</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">client.undo.logSerialization</span><span class="token punctuation">=</span><span class="token value attr-value">jackson</span>
<span class="token key attr-name">client.undo.onlyCareUpdateColumns</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">server.undo.logSaveDays</span><span class="token punctuation">=</span><span class="token value attr-value">7</span>
<span class="token key attr-name">server.undo.logDeletePeriod</span><span class="token punctuation">=</span><span class="token value attr-value">86400000</span>
<span class="token key attr-name">client.undo.logTable</span><span class="token punctuation">=</span><span class="token value attr-value">undo_log</span>
<span class="token key attr-name">client.undo.compress.enable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">client.undo.compress.type</span><span class="token punctuation">=</span><span class="token value attr-value">zip</span>
<span class="token key attr-name">client.undo.compress.threshold</span><span class="token punctuation">=</span><span class="token value attr-value">64k</span>
<span class="token comment">#For TCC transaction mode</span>
<span class="token key attr-name">tcc.fence.logTableName</span><span class="token punctuation">=</span><span class="token value attr-value">tcc_fence_log</span>
<span class="token key attr-name">tcc.fence.cleanPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1h</span>

<span class="token comment">#Log rule configuration, for client and server</span>
<span class="token key attr-name">log.exceptionRate</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>

<span class="token comment">#Transaction storage configuration, only for the server. The file, DB, and redis configuration values are optional.</span>
<span class="token key attr-name">store.mode</span><span class="token punctuation">=</span><span class="token value attr-value">db</span>
<span class="token key attr-name">store.lock.mode</span><span class="token punctuation">=</span><span class="token value attr-value">db</span>
<span class="token key attr-name">store.session.mode</span><span class="token punctuation">=</span><span class="token value attr-value">db</span>
<span class="token comment">#Used for password encryption</span>
<span class="token key attr-name">store.publicKey</span><span class="token punctuation">=</span>

<span class="token comment">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span>
<span class="token key attr-name">store.file.dir</span><span class="token punctuation">=</span><span class="token value attr-value">file_store/data</span>
<span class="token key attr-name">store.file.maxBranchSessionSize</span><span class="token punctuation">=</span><span class="token value attr-value">16384</span>
<span class="token key attr-name">store.file.maxGlobalSessionSize</span><span class="token punctuation">=</span><span class="token value attr-value">512</span>
<span class="token key attr-name">store.file.fileWriteBufferCacheSize</span><span class="token punctuation">=</span><span class="token value attr-value">16384</span>
<span class="token key attr-name">store.file.flushDiskMode</span><span class="token punctuation">=</span><span class="token value attr-value">async</span>
<span class="token key attr-name">store.file.sessionReloadReadSize</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>

<span class="token comment">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span>
<span class="token key attr-name">store.db.datasource</span><span class="token punctuation">=</span><span class="token value attr-value">druid</span>
<span class="token key attr-name">store.db.dbType</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span>
<span class="token key attr-name">store.db.driverClassName</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">store.db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.135.130:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true</span>
<span class="token key attr-name">store.db.user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">store.db.password</span><span class="token punctuation">=</span><span class="token value attr-value">Root.123456</span>
<span class="token key attr-name">store.db.minConn</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">store.db.maxConn</span><span class="token punctuation">=</span><span class="token value attr-value">30</span>
<span class="token key attr-name">store.db.globalTable</span><span class="token punctuation">=</span><span class="token value attr-value">global_table</span>
<span class="token key attr-name">store.db.branchTable</span><span class="token punctuation">=</span><span class="token value attr-value">branch_table</span>
<span class="token key attr-name">store.db.distributedLockTable</span><span class="token punctuation">=</span><span class="token value attr-value">distributed_lock</span>
<span class="token key attr-name">store.db.queryLimit</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>
<span class="token key attr-name">store.db.lockTable</span><span class="token punctuation">=</span><span class="token value attr-value">lock_table</span>
<span class="token key attr-name">store.db.maxWait</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span>

<span class="token comment">#These configurations are required if the `store mode` is `redis`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `redis`, you can remove the configuration block.</span>
<span class="token key attr-name">store.redis.mode</span><span class="token punctuation">=</span><span class="token value attr-value">single</span>
<span class="token key attr-name">store.redis.single.host</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">store.redis.single.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token key attr-name">store.redis.sentinel.masterName</span><span class="token punctuation">=</span>
<span class="token key attr-name">store.redis.sentinel.sentinelHosts</span><span class="token punctuation">=</span>
<span class="token key attr-name">store.redis.maxConn</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
<span class="token key attr-name">store.redis.minConn</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">store.redis.maxTotal</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>
<span class="token key attr-name">store.redis.database</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">store.redis.password</span><span class="token punctuation">=</span>
<span class="token key attr-name">store.redis.queryLimit</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>

<span class="token comment">#Transaction rule configuration, only for the server</span>
<span class="token key attr-name">server.recovery.committingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.asynCommittingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.rollbackingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.timeoutRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.maxCommitRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token key attr-name">server.maxRollbackRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token key attr-name">server.rollbackRetryTimeoutUnlockEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">server.distributedLockExpireTime</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span>
<span class="token key attr-name">server.xaerNotaRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">60000</span>
<span class="token key attr-name">server.session.branchAsyncQueueSize</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span>
<span class="token key attr-name">server.session.enableBranchAsyncRemove</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">server.enableParallelRequestHandle</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>

<span class="token comment">#Metrics configuration, only for the server</span>
<span class="token key attr-name">metrics.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">metrics.registryType</span><span class="token punctuation">=</span><span class="token value attr-value">compact</span>
<span class="token key attr-name">metrics.exporterList</span><span class="token punctuation">=</span><span class="token value attr-value">prometheus</span>
<span class="token key attr-name">metrics.exporterPrometheusPort</span><span class="token punctuation">=</span><span class="token value attr-value">9898</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br></div></div></details><hr><h3 id="å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨" aria-hidden="true">#</a> å¯åŠ¨</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>  <span class="token comment"># éœ€è¦è¿›å…¥binç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦åˆ™æ‰¾ä¸åˆ°SpringBootApplicationç­‰ç±»</span>
  <span class="token builtin class-name">cd</span> /usr/local/seata/bin
  seata-server.sh 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="æ”¯æŒçš„å¯åŠ¨å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒçš„å¯åŠ¨å‚æ•°" aria-hidden="true">#</a> æ”¯æŒçš„å¯åŠ¨å‚æ•°</h3><table><thead><tr><th>å‚æ•°</th><th>å…¨å†™</th><th>ä½œç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>-h</td><td>--host</td><td>æŒ‡å®šåœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„ IP</td><td>ä¸æŒ‡å®šæ—¶è·å–å½“å‰çš„ IPï¼Œå¤–éƒ¨è®¿é—®éƒ¨ç½²åœ¨äº‘ç¯å¢ƒå’Œå®¹å™¨ä¸­çš„ server å»ºè®®æŒ‡å®š</td></tr><tr><td>-p</td><td>--port</td><td>æŒ‡å®š server å¯åŠ¨çš„ç«¯å£</td><td>é»˜è®¤ä¸º 8091</td></tr><tr><td>-m</td><td>--storeMode</td><td>äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ–¹å¼</td><td>æ”¯æŒfile,db,redisï¼Œé»˜è®¤ä¸º file æ³¨:rediséœ€seata-server 1.3ç‰ˆæœ¬åŠä»¥ä¸Š</td></tr><tr><td>-n</td><td>--serverNode</td><td>ç”¨äºæŒ‡å®šseata-serverèŠ‚ç‚¹ID</td><td>å¦‚ 1,2,3..., é»˜è®¤ä¸º 1</td></tr><tr><td>-e</td><td>--seataEnv</td><td>æŒ‡å®š seata-server è¿è¡Œç¯å¢ƒ</td><td>å¦‚ dev, test ç­‰, æœåŠ¡å¯åŠ¨æ—¶ä¼šä½¿ç”¨ registry-dev.conf è¿™æ ·çš„é…ç½®</td></tr></tbody></table><p>æ¯”å¦‚ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># éœ€è¦è¿›å…¥binç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦åˆ™æ‰¾ä¸åˆ°SpringBootApplicationç­‰ç±»</span>
<span class="token builtin class-name">cd</span> /usr/local/seata/bin
<span class="token comment"># åˆ¶å®šip</span>
./seata-server.sh <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.135.130 <span class="token parameter variable">-p</span> <span class="token number">8091</span>
seata-server.sh <span class="token parameter variable">-p</span> <span class="token number">8091</span> <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-m</span> db 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="è®¿é—®ç•Œé¢" tabindex="-1"><a class="header-anchor" href="#è®¿é—®ç•Œé¢" aria-hidden="true">#</a> è®¿é—®ç•Œé¢</h3><p><a href="http://192.168.135.130:7091/" target="_blank" rel="noopener noreferrer">http://192.168.135.130:7091/<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/images/seata/image-20230420164849463.png" alt="image-20230420164849463"></p><h2 id="seata-clientå¿«é€Ÿå¼€å§‹" tabindex="-1"><a class="header-anchor" href="#seata-clientå¿«é€Ÿå¼€å§‹" aria-hidden="true">#</a> <strong>Seata Clientå¿«é€Ÿå¼€å§‹</strong></h2><p><a href="https://github.com/Q10Viking/learncode/tree/main/seata/learnSeata/MicroServices" target="_blank" rel="noopener noreferrer">Source Code<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><strong>Spring Cloud Alibabaæ•´åˆSeata ATæ¨¡å¼å®æˆ˜</strong></p></div><p><strong>ä¸šåŠ¡åœºæ™¯</strong></p><p>ç”¨æˆ·ä¸‹å•ï¼Œæ•´ä¸ªä¸šåŠ¡é€»è¾‘ç”±ä¸‰ä¸ªå¾®æœåŠ¡æ„æˆï¼š</p><ul><li>åº“å­˜æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤åº“å­˜æ•°é‡ã€‚</li><li>è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å•ã€‚</li><li>å¸æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·å¸æˆ·ä¸­æ‰£é™¤ä½™é¢ã€‚</li></ul><p><img src="/images/seata/54076.png" alt="https://note.youdao.com/yws/public/resource/c480b9d259db401acff9fdd30a770d64/xmlnote/174DF4D5850D46D4A11920DF78129626/54076"></p><h3 id="ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå‡†å¤‡" aria-hidden="true">#</a> <strong>ç¯å¢ƒå‡†å¤‡</strong></h3><p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬è¯´æ˜ Â· alibaba/spring-cloud-alibaba Wiki (github.com)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><ul><li>çˆ¶pomæŒ‡å®šå¾®æœåŠ¡ç‰ˆæœ¬</li></ul><table><thead><tr><th>Spring Cloud Alibaba Version</th><th>Spring Cloud Version</th><th>Spring Boot Version</th><th>Seata Version</th><th>nacos</th></tr></thead><tbody><tr><td>2.2.9.RELEASE</td><td>Spring Cloud Hoxton.SR12</td><td>2.3.12.RELEASE</td><td>1.5.2</td><td>2.1.0</td></tr></tbody></table><ul><li>å¯åŠ¨Seata Server(TC)ç«¯ï¼ŒSeata Serverä½¿ç”¨nacosä½œä¸ºé…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒ</li><li>å¯åŠ¨nacosæœåŠ¡</li></ul><h3 id="ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–" aria-hidden="true">#</a> ä¾èµ–</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo-logè¡¨-ä»…atæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo-logè¡¨-ä»…atæ¨¡å¼" aria-hidden="true">#</a> å¾®æœåŠ¡å¯¹åº”æ•°æ®åº“ä¸­æ·»åŠ undo_logè¡¨(ä»…ATæ¨¡å¼)</h3><p><a href="https://github.com/seata/seata/blob/1.5.2/script/client/at/db/mysql.sql" target="_blank" rel="noopener noreferrer">seata/mysql.sql at 1.5.2 Â· seata/seata (github.com)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;branch transaction id&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;global transaction id&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;undo_log context,such as serialization&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;rollback info&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;0:normal status,1:defense status&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;create datetime&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;modify datetime&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">&#39;AT transaction mode undo table&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="å¾®æœåŠ¡application-ymlä¸­æ·»åŠ seataé…" tabindex="-1"><a class="header-anchor" href="#å¾®æœåŠ¡application-ymlä¸­æ·»åŠ seataé…" aria-hidden="true">#</a> å¾®æœåŠ¡application.ymlä¸­æ·»åŠ seataé…</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">application-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> default_tx_group
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.135.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> c3f112d8<span class="token punctuation">-</span>1c5e<span class="token punctuation">-</span>419e<span class="token punctuation">-</span>9c83<span class="token punctuation">-</span>b0b26b987a42
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.135.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> c3f112d8<span class="token punctuation">-</span>1c5e<span class="token punctuation">-</span>419e<span class="token punctuation">-</span>9c83<span class="token punctuation">-</span>b0b26b987a42
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">data-id</span><span class="token punctuation">:</span> seataServer.properties
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ -globaltransactionalæ³¨" tabindex="-1"><a class="header-anchor" href="#åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ -globaltransactionalæ³¨" aria-hidden="true">#</a> åœ¨å…¨å±€äº‹åŠ¡å‘èµ·è€…ä¸­æ·»åŠ @GlobalTransactionalæ³¨</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token comment">//@Transactional</span>
    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;createOrder&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token class-name">OrderVo</span> orderVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;=============ç”¨æˆ·ä¸‹å•=================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰ XID: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">RootContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä¿å­˜è®¢å•</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCommodityCode</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getCommodityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatus</span><span class="token punctuation">.</span><span class="token constant">INIT</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Integer</span> saveOrderRecord <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿å­˜è®¢å•{}&quot;</span><span class="token punctuation">,</span> saveOrderRecord <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;æˆåŠŸ&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰£å‡åº“å­˜</span>
        storageFeignService<span class="token punctuation">.</span><span class="token function">deduct</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getCommodityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderVo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰£å‡ä½™é¢   æœåŠ¡é™çº§  throw</span>
        <span class="token class-name">Boolean</span> debit<span class="token operator">=</span> accountFeignService<span class="token punctuation">.</span><span class="token function">debit</span><span class="token punctuation">(</span>orderVo<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderVo<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        if(!debit){</span>
<span class="token comment">//            // è§£å†³ feignæ•´åˆsentinelé™çº§å¯¼è‡´SeaTaå¤±æ•ˆçš„å¤„ç†</span>
<span class="token comment">//            throw new RuntimeException(&quot;è´¦æˆ·æœåŠ¡å¼‚å¸¸é™çº§äº†&quot;);</span>
<span class="token comment">//        }</span>

        <span class="token comment">//æ›´æ–°è®¢å•</span>
        <span class="token class-name">Integer</span> updateOrderRecord <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">updateOrderStatus</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">OrderStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°è®¢å•id:{} {}&quot;</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> updateOrderRecord <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;æˆåŠŸ&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> order<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">debit</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span><span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;=============ç”¨æˆ·è´¦æˆ·æ‰£æ¬¾=================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰ XID: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">RootContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">checkBalance</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ‰£å‡ç”¨æˆ· {} ä½™é¢&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> record <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">reduceBalance</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">ERROR_USER_ID</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ¨¡æ‹Ÿå¼‚å¸¸</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;account branch exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰£å‡ç”¨æˆ· {} ä½™é¢ç»“æœ:{}&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> record <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;æ“ä½œæˆåŠŸ&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ‰£å‡ä½™é¢å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a> æµ‹è¯•</h3><p><img src="/images/seata/image-20230420212526253.png" alt="image-20230420212526253"></p><h2 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h2><p><img src="/images/seata/image-20230420212644627.png" alt="image-20230420212644627"></p><blockquote><p>å…¨å±€äº‹åŠ¡IDä¸åˆ†æ”¯äº‹åŠ¡ID</p></blockquote><p><img src="/images/seata/image-20230420211158758.png" alt="image-20230420211158758"></p><p><img src="/images/seata/image-20230420211241807.png" alt="image-20230420211241807"></p><h2 id="seataç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#seataç‰ˆæœ¬" aria-hidden="true">#</a> Seataç‰ˆæœ¬</h2><blockquote><p>1.5.1çš„ç‰ˆæœ¬å®ƒä¾èµ–çš„jaråŒ…éƒ½é›†æˆåˆ°äº†seata-server.jaråŒ…ä¸­ï¼Œä½¿ç”¨mysql8ä¸æ–¹ä¾¿æ·»åŠ lib.æ²¡æœ‰libç›®å½•</p><p>1.5.2çš„ç‰ˆæœ¬ï¼Œæœ‰libç›®å½•ï¼Œä¾èµ–çš„åŒ…éƒ½åœ¨libç›®å½•ä¸‹ï¼Œå¹¶ä¸”æœ‰mysql8çš„jaråŒ…</p></blockquote><p><img src="/images/seata/image-20230420182419565.png" alt="image-20230420182419565"></p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> â† <a href="/seata/" class="nav-link router-link-active" aria-label="Back To ç›®å½•"><!--[--><!--]--> Back To ç›®å½• <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
