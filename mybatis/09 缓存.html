<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>é™é»˜ã®Blog</title><meta name="description" content="é™é»˜çš„Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">é™é»˜ã®Blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#ä¸€çº§ç¼“å­˜" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸€çº§ç¼“å­˜"><!--[--><!--]--> ä¸€çº§ç¼“å­˜ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#ç‰¹æ€§â¤ï¸" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç‰¹æ€§â¤ï¸"><!--[--><!--]--> ç‰¹æ€§â¤ï¸ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#é»˜è®¤å¼€å¯çš„ä½“ç°" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="é»˜è®¤å¼€å¯çš„ä½“ç°"><!--[--><!--]--> é»˜è®¤å¼€å¯çš„ä½“ç° <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#å¤±æ•ˆçš„éªŒè¯" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¤±æ•ˆçš„éªŒè¯"><!--[--><!--]--> å¤±æ•ˆçš„éªŒè¯ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#äºŒçº§ç¼“å­˜" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="äºŒçº§ç¼“å­˜"><!--[--><!--]--> äºŒçº§ç¼“å­˜ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#ç‰¹æ€§" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç‰¹æ€§"><!--[--><!--]--> ç‰¹æ€§ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#å¼€å¯äºŒçº§ç¼“å­˜" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¼€å¯äºŒçº§ç¼“å­˜"><!--[--><!--]--> å¼€å¯äºŒçº§ç¼“å­˜ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#å¤±æ•ˆ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¤±æ•ˆ"><!--[--><!--]--> å¤±æ•ˆ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#cacheæ ‡ç­¾" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="cacheæ ‡ç­¾"><!--[--><!--]--> cacheæ ‡ç­¾ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#ä½œç”¨èŒƒå›´" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä½œç”¨èŒƒå›´"><!--[--><!--]--> ä½œç”¨èŒƒå›´ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§"><!--[--><!--]--> ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/mybatis/09%20%E7%BC%93%E5%AD%98.html#" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label><!--[--><!--]-->  <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><a href="https://github.com/Q10Viking/learncode/tree/main/mybatis/05_mybatis_cache" target="_blank" rel="noopener noreferrer">Source Code 05 mybatis cache<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></div><h2 id="ä¸€çº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ä¸€çº§ç¼“å­˜" aria-hidden="true">#</a> ä¸€çº§ç¼“å­˜</h2><p>çº¿ç¨‹çº§åˆ«çš„ç¼“å­˜ï¼Œæ˜¯æœ¬åœ°ç¼“å­˜ï¼ŒsqlSessionçº§åˆ«çš„ç¼“å­˜ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¸ç®¡ä»–ã€‚ä½†æ˜¯è¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹ã€‚</p><h3 id="ç‰¹æ€§â¤ï¸" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ€§â¤ï¸" aria-hidden="true">#</a> ç‰¹æ€§â¤ï¸</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¸€çº§ç¼“å­˜
 * ç‰¹æ€§ï¼š
 * 1.é»˜è®¤å°±å¼€å¯äº†ï¼Œä¹Ÿå¯ä»¥å…³é—­ä¸€çº§ç¼“å­˜ localCacheScope=STATEMENT
 * 2.ä½œç”¨åŸŸï¼šæ˜¯åŸºäºsqlSessionï¼ˆé»˜è®¤ï¼‰ï¼Œä¸€æ¬¡æ•°æ®åº“æ“ä½œä¼šè¯ã€‚
 * 3.ç¼“å­˜é»˜è®¤å®ç°ç±»PerpetualCache ,ä½¿ç”¨mapè¿›è¡Œå­˜å‚¨çš„(å¯ä»¥è¿›å»æ‰“æ–­ç‚¹è§‚å¯Ÿ)
 * 4.æŸ¥è¯¢å®Œå°±ä¼šè¿›è¡Œå­˜å‚¨
 * 5.å…ˆä»äºŒçº§ç¼“å­˜ä¸­è·å–ï¼Œå†ä»ä¸€çº§ç¼“å­˜ä¸­è·å–
 * key==&gt;   hashcode+sqlid+sql
 * å¤±æ•ˆæƒ…å†µï¼š
 * 1.ä¸åŒçš„sqlSessionä¼šä½¿ä¸€çº§ç¼“å­˜å¤±æ•ˆ
 * 2.åŒä¸€ä¸ªSqlSessionï¼Œä½†æ˜¯æŸ¥è¯¢è¯­å¥ä¸ä¸€æ ·
 * 3.åŒä¸€ä¸ªSqlSessionï¼ŒæŸ¥è¯¢è¯­å¥ä¸€æ ·ï¼Œä½†æ˜¯æœŸé—´æ‰§è¡Œå¢åˆ æ”¹æ“ä½œ
 * 4.åŒä¸€ä¸ªSqlSessionï¼ŒæŸ¥è¯¢è¯­å¥ä¸€æ ·ï¼Œæ‰§è¡Œæ‰‹åŠ¨æ¸…é™¤ç¼“å­˜  sqlSession.clearCache();
 */</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="é»˜è®¤å¼€å¯çš„ä½“ç°" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤å¼€å¯çš„ä½“ç°" aria-hidden="true">#</a> é»˜è®¤å¼€å¯çš„ä½“ç°</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è™½ç„¶ä»£ç ä¸­æŸ¥è¯¢äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šåªä»æ•°æ®åº“æŸ¥è¯¢äº†ä¸€æ¬¡</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts2 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/images/mybatis/image-20220807205520016.png" alt="image-20220807205520016"></p><h3 id="å¤±æ•ˆçš„éªŒè¯" tabindex="-1"><a class="header-anchor" href="#å¤±æ•ˆçš„éªŒè¯" aria-hidden="true">#</a> å¤±æ•ˆçš„éªŒè¯</h3><h4 id="ä¸åŒçš„sqlsession" tabindex="-1"><a class="header-anchor" href="#ä¸åŒçš„sqlsession" aria-hidden="true">#</a> ä¸åŒçš„sqlsession</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * ä¸€çº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯åœ¨sqlSession
     * ä¸åŒçš„sqlSessionä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆ
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è™½ç„¶ä»£ç ä¸­æŸ¥è¯¢äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šåªä»æ•°æ®åº“æŸ¥è¯¢äº†ä¸€æ¬¡</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts2 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><img src="/images/mybatis/image-20220807210152870.png" alt="image-20220807210152870"></p><h4 id="æŸ¥è¯¢è¯­å¥ä¸ä¸€æ ·" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¯­å¥ä¸ä¸€æ ·" aria-hidden="true">#</a> æŸ¥è¯¢è¯­å¥ä¸ä¸€æ ·</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Dept</span> dept1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dept1<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Dept</span> dept2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//dept2.setDeptId(1);  // ä¼šèµ°ä¸€çº§ç¼“å­˜</span>
        dept2<span class="token punctuation">.</span><span class="token function">setDeptName</span><span class="token punctuation">(</span><span class="token string">&quot;ç»ç†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¼“å­˜å¤±æ•ˆ</span>
        mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/images/mybatis/image-20220807210854579.png" alt="image-20220807210854579"></p><h4 id="æŸ¥è¯¢è¯­å¥ä¸€æ ·-ä½†æ˜¯æœŸé—´æ‰§è¡Œå¢åˆ æ”¹æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¯­å¥ä¸€æ ·-ä½†æ˜¯æœŸé—´æ‰§è¡Œå¢åˆ æ”¹æ“ä½œ" aria-hidden="true">#</a> æŸ¥è¯¢è¯­å¥ä¸€æ ·ï¼Œä½†æ˜¯æœŸé—´æ‰§è¡Œå¢åˆ æ”¹æ“ä½œ</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Dept</span> dept1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dept1<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œäº†å¢åˆ æ”¹çš„æ“ä½œ</span>
        <span class="token class-name">EmpMapper</span> empMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmpMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Emp</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        empMapper<span class="token punctuation">.</span><span class="token function">insertEmp</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Dept</span> dept2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dept2<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="/images/mybatis/image-20220807211857232.png" alt="image-20220807211857232"></p><h2 id="äºŒçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#äºŒçº§ç¼“å­˜" aria-hidden="true">#</a> äºŒçº§ç¼“å­˜</h2><h3 id="ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ€§" aria-hidden="true">#</a> ç‰¹æ€§</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span> äºŒçº§ç¼“å­˜ï¼š
    <span class="token operator">*</span>    ç‰¹æ€§ï¼š
    <span class="token operator">*</span>      <span class="token number">1.</span>é»˜è®¤å¼€å¯äº†ï¼Œæ²¡æœ‰å®ç°
    <span class="token operator">*</span>      <span class="token number">2.</span>ä½œç”¨åŸŸï¼šåŸºäºå…¨å±€èŒƒå›´ï¼Œåº”ç”¨çº§åˆ«ã€‚
    <span class="token operator">*</span>      <span class="token number">3.</span>ç¼“å­˜é»˜è®¤å®ç°ç±»<span class="token class-name">PerpetualCache</span> <span class="token punctuation">,</span>ä½¿ç”¨mapè¿›è¡Œå­˜å‚¨çš„ä½†æ˜¯äºŒçº§ç¼“å­˜æ ¹æ®ä¸åŒçš„mapperå‘½åç©ºé—´å¤šåŒ…äº†ä¸€å±‚map
    <span class="token operator">*</span>              <span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span>Configuration</span>#caches    key<span class="token operator">:</span>mapperå‘½åç©ºé—´   value<span class="token operator">:</span>erpetualCache<span class="token punctuation">.</span>map
        <span class="token operator">*</span>          <span class="token operator">*</span> key<span class="token operator">==</span><span class="token operator">&gt;</span> sqlid<span class="token operator">+</span>sql
    <span class="token operator">*</span>      <span class="token number">4.</span>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼ˆsqlSessionå…³é—­<span class="token punctuation">)</span>è¿›è¡Œå­˜å‚¨
    <span class="token operator">*</span>      <span class="token number">5.</span>å…ˆä»äºŒçº§ç¼“å­˜ä¸­è·å–ï¼Œå†ä»ä¸€çº§ç¼“å­˜ä¸­è·å–
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="å¼€å¯äºŒçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#å¼€å¯äºŒçº§ç¼“å­˜" aria-hidden="true">#</a> å¼€å¯äºŒçº§ç¼“å­˜</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>å®ç°ï¼š
     <span class="token operator">*</span>      <span class="token number">1.</span>å¼€å¯äºŒçº§ç¼“å­˜<span class="token operator">&lt;</span>setting name<span class="token operator">=</span><span class="token string">&quot;cacheEnabled&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">*</span>      <span class="token number">2.</span>åœ¨éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„æ˜ å°„æ–‡ä»¶ä¸­åŠ å…¥<span class="token generics"><span class="token punctuation">&lt;</span>cache<span class="token punctuation">&gt;</span></span><span class="token operator">&lt;</span><span class="token operator">/</span>cache<span class="token operator">&gt;</span><span class="token punctuation">,</span>åŸºäº<span class="token class-name">Mapper</span>æ˜ å°„æ–‡ä»¶æ¥å®ç°ç¼“å­˜çš„ï¼ŒåŸºäº<span class="token class-name">Mapper</span>æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´æ¥å­˜å‚¨çš„
     <span class="token operator">*</span>      <span class="token number">3.</span>åœ¨éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„javaBeanä¸­å®ç°åºåˆ—åŒ–æ¥å£<span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
     <span class="token operator">*</span>          é…ç½®æˆåŠŸå°±ä¼šå‡ºç°ç¼“å­˜å‘½ä¸­ç‡ åŒä¸€ä¸ªsqlId<span class="token operator">:</span> ä»ç¼“å­˜ä¸­æ‹¿å‡ºçš„æ¬¡æ•°<span class="token operator">/</span>æŸ¥è¯¢æ€»æ¬¡æ•°
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>mybatisï¼ŒäºŒçº§ç¼“å­˜æ˜¯å¼€å¯çš„</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- mybatis-config.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--   é»˜è®¤æ˜¯å¼€å¯çš„     --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cacheEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://mybatis.net.cn/configuration.html#settings" target="_blank" rel="noopener noreferrer">é…ç½®_MyBatisä¸­æ–‡ç½‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/images/mybatis/image-20220807214734918.png" alt="image-20220807214734918"></p><ol start="2"><li>åœ¨éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„æ˜ å°„æ–‡ä»¶ä¸­åŠ å…¥<code>&lt;cache&gt;&lt;/cache&gt;</code>,åŸºäºMapperæ˜ å°„æ–‡ä»¶æ¥å®ç°ç¼“å­˜çš„ï¼ŒåŸºäºMapperæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´æ¥å­˜å‚¨çš„</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- DeptMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li><p>åœ¨éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„javaBeanä¸­å®ç°åºåˆ—åŒ–æ¥å£implements Serializable</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dept</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><blockquote><p>éªŒè¯ä¸€ä¸‹ï¼š é…ç½®æˆåŠŸå°±ä¼šå‡ºç°ç¼“å­˜å‘½ä¸­ç‡ åŒä¸€ä¸ªsqlId: ä»ç¼“å­˜ä¸­æ‹¿å‡ºçš„æ¬¡æ•°/æŸ¥è¯¢æ€»æ¬¡æ•°</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è™½ç„¶ä»£ç ä¸­æŸ¥è¯¢äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šåªä»æ•°æ®åº“æŸ¥è¯¢äº†ä¸€æ¬¡</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">&gt;</span></span> depts2 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="/images/mybatis/image-20220807215927988.png" alt="image-20220807215927988"></p><h3 id="å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#å¤±æ•ˆ" aria-hidden="true">#</a> å¤±æ•ˆ</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>å¤±æ•ˆï¼š
     <span class="token operator">*</span>      <span class="token number">1.</span>åŒä¸€ä¸ªå‘½åç©ºé—´è¿›è¡Œäº†å¢åˆ æ”¹çš„æ“ä½œï¼Œä¼šå¯¼è‡´äºŒçº§ç¼“å­˜å¤±æ•ˆ
     <span class="token operator">*</span>          ä½†æ˜¯å¦‚æœä¸æƒ³å¤±æ•ˆï¼šå¯ä»¥å°†<span class="token constant">SQL</span>çš„flushCache è®¾ç½®ä¸º<span class="token boolean">false</span>ï¼ˆé»˜è®¤æ˜¯<span class="token boolean">true</span>ï¼‰<span class="token punctuation">,</span>ä½†æ˜¯è¦æ…é‡è®¾ç½®ï¼Œå› ä¸ºä¼šé€ æˆæ•°æ®è„è¯»é—®é¢˜ï¼Œé™¤éä½ èƒ½ä¿è¯æŸ¥è¯¢çš„æ•°æ®æ°¸è¿œä¸ä¼šæ‰§è¡Œå¢åˆ æ”¹
     <span class="token operator">*</span>      <span class="token number">2.</span>è®©æŸ¥è¯¢ä¸ç¼“å­˜æ•°æ®åˆ°äºŒçº§ç¼“å­˜ä¸­useCache<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">(</span>é»˜è®¤ä¸º<span class="token boolean">true</span><span class="token punctuation">)</span>
     <span class="token operator">*</span>      <span class="token number">3.</span>å¦‚æœå¸Œæœ›æŸä¸ªmapperæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´æ‰§è¡Œäº†å¢åˆ æ”¹æ¸…ç©ºå¦å¤–çš„å‘½åç©ºé—´<span class="token punctuation">(</span>cache<span class="token operator">-</span>ref ä¸­çš„namespaceæŒ‡å®š<span class="token punctuation">)</span>çš„ç¼“å­˜å°±å¯ä»¥è®¾ç½®ï¼š
     <span class="token operator">*</span>          <span class="token operator">&lt;</span>cache<span class="token operator">-</span>ref namespace<span class="token operator">=</span><span class="token string">&quot;cn.tulingxueyuan.mapper.DeptMapper&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="cache-refä½¿å¾—å¦å¤–ä¸€ä¸ªmapperçš„ç¼“å­˜å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#cache-refä½¿å¾—å¦å¤–ä¸€ä¸ªmapperçš„ç¼“å­˜å¤±æ•ˆ" aria-hidden="true">#</a> cache-refä½¿å¾—å¦å¤–ä¸€ä¸ªmapperçš„ç¼“å­˜å¤±æ•ˆ</h4><blockquote><p>å±€é™æ€§ï¼Œåªèƒ½å½±å“ä¸€ä¸ªmapper,å¦‚æœæœ‰å¤šä¸ªmapperåˆ™ä¸è¡Œ</p></blockquote><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- EmpMapper.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-ref</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.hzz.mapper.DeptMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- DeptMapper.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>EmpMapperæ‰§è¡Œäº†å¢åˆ æ”¹ï¼Œæ¸…é™¤äº†DeptMapperçš„äºŒçº§ç¼“å­˜</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test06</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Dept</span> dept1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dept1<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// äº‹åŠ¡æäº¤ï¼Œå­˜å‚¨äºŒçº§ç¼“å­˜</span>
            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// æ‰§è¡Œäº†å¢åˆ æ”¹çš„æ“ä½œ Empé‡Œé¢æœ‰cache-ref</span>
            <span class="token class-name">EmpMapper</span> empMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmpMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Emp</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            empMapper<span class="token punctuation">.</span><span class="token function">insertEmp</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éœ€è¦æäº¤</span>

            <span class="token class-name">Dept</span> dept2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dept2<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/images/mybatis/image-20220807222741326.png" alt="image-20220807222741326"></p><h3 id="cacheæ ‡ç­¾" tabindex="-1"><a class="header-anchor" href="#cacheæ ‡ç­¾" aria-hidden="true">#</a> cacheæ ‡ç­¾</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!--
        eviction å½“ç¼“å­˜è¾¾åˆ°ä¸€å®šçš„æ•°é‡çš„æ—¶å€™ï¼ˆsizeçš„æ•°é‡ï¼‰ï¼Œä»¥å“ªç§æ–¹å¼è¿›è¡Œå›æ”¶ç¼“å­˜ï¼š
            LRU â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚ï¼ˆé»˜è®¤ï¼‰
            FIFO â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚
            SOFT â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚
            WEAK â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚
        flushInterval åˆ·æ–°æ—¶é—´  æ¯«ç§’
        size å¯ä»¥ç¼“å­˜çš„æ•°é‡
        readOnly è®¾ç½®æ•°æ®æ˜¯å¦åªè¯»
              true       è¯»å–ç¼“å­˜çš„æ•°æ®æ€§èƒ½æ›´é«˜ï¼Œä¼šç›´æ¥è·å–å†…å­˜å¼•ç”¨ å®¹æ˜“å¼•èµ·è„è¯»
              false é»˜è®¤ è¯»å–ç¼“å­˜çš„æ•°æ®æ€§èƒ½æ›´ä½ï¼Œä¼šå°†æ•°æ®æ‹·è´ä¸€ä»½
        type äºŒçº§ç¼“å­˜å®ç°ç±» org.apache.ibatis.cache.impl.PerpetualCache(å¯çœç•¥)ã€‚
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.mybatis.caches.redis.RedisCache<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FIFO<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">flushInterval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>60000<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>512<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">readOnly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="ä½œç”¨èŒƒå›´" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨èŒƒå›´" aria-hidden="true">#</a> ä½œç”¨èŒƒå›´</h3><ol><li>åœ¨settingä¸­è®¾ç½®ï¼Œæ˜¯é…ç½®äºŒçº§ç¼“å­˜å¼€å¯ï¼Œä¸€çº§ç¼“å­˜é»˜è®¤ä¸€ç›´å¼€å¯</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>selectæ ‡ç­¾çš„useCacheå±æ€§ï¼šåœ¨æ¯ä¸€ä¸ªselectçš„æŸ¥è¯¢ä¸­å¯ä»¥è®¾ç½®å½“å‰æŸ¥è¯¢æ˜¯å¦è¦ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œåªå¯¹äºŒçº§ç¼“å­˜æœ‰æ•ˆ</li><li>sqlæ ‡ç­¾çš„flushCacheå±æ€§å¢åˆ æ”¹æ“ä½œé»˜è®¤å€¼ä¸ºtrueï¼Œsqlæ‰§è¡Œä¹‹åä¼šæ¸…ç©ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œè€ŒæŸ¥è¯¢æ“ä½œé»˜è®¤æ˜¯false</li><li>sqlSession.clearCache() åªæ˜¯ç”¨æ¥æ¸…é™¤ä¸€çº§ç¼“å­˜</li></ol><hr><h2 id="ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§" aria-hidden="true">#</a> ä¸€çº§å’ŒäºŒçº§å­˜å‚¨çš„ç‰¹æ€§</h2><ol><li>ä¸€çº§ç¼“å­˜ä¼šåœ¨æŸ¥è¯¢ç»“æŸåç¼“å­˜</li><li>äºŒçº§ç¼“å­˜ä¼šåœ¨äº‹åŠ¡æäº¤æˆ–è€…sqlsessionå…³é—­åç¼“å­˜</li></ol><p><strong>ç¨‹åºä¼šå…ˆä»äºŒçº§ç¼“å­˜æ‹¿å†ä»ä¸€çº§ç¼“å­˜æ‹¿â¤ï¸â¤ï¸</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">DeptMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">DeptMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Dept</span> dept1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dept1<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å­˜å‚¨äºŒçº§ç¼“å­˜</span>
            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Dept</span> dept2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dept2<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mapper<span class="token punctuation">.</span><span class="token function">selectDept</span><span class="token punctuation">(</span>dept2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¼šèµ°äºŒçº§ç¼“å­˜</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/images/mybatis/image-20220807220941920.png" alt="image-20220807220941920"></p><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h3><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> â† <a href="/mybatis/" class="nav-link router-link-active" aria-label="Back To ç›®å½•"><!--[--><!--]--> Back To ç›®å½• <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
