"use strict";(self.webpackChunkq10viking_github_io=self.webpackChunkq10viking_github_io||[]).push([[29067],{9782:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-05e43d3a",path:"/Docker/19%20k8s%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7.html",title:"",lang:"zh-CN",frontmatter:{sidebarDepth:3,sidebar:"auto",prev:{text:"Back To ç›®å½•",link:"/Docker/"},"typora-root-url":"..\\.vuepress\\public"},excerpt:"",headers:[{level:2,title:"ReplicaSet",slug:"replicaset",children:[]},{level:2,title:"ConfigMap",slug:"configmap",children:[]},{level:2,title:"Volume",slug:"volume",children:[]},{level:2,title:"IngressğŸ˜˜",slug:"ingressğŸ˜˜",children:[{level:3,title:"å®‰è£…",slug:"å®‰è£…",children:[]},{level:3,title:"é…ç½®è®¿é—®è§„åˆ™",slug:"é…ç½®è®¿é—®è§„åˆ™",children:[]}]},{level:2,title:"é…ç½®ç®¡ç†",slug:"é…ç½®ç®¡ç†",children:[{level:3,title:"ä½¿ç”¨",slug:"ä½¿ç”¨",children:[]}]},{level:2,title:"å­˜å‚¨å·çš„ä½¿ç”¨â¤ï¸",slug:"å­˜å‚¨å·çš„ä½¿ç”¨â¤ï¸",children:[{level:3,title:"å‡†å¤‡é…ç½®æ–‡ä»¶",slug:"å‡†å¤‡é…ç½®æ–‡ä»¶",children:[]},{level:3,title:"éƒ¨ç½²â¤ï¸",slug:"éƒ¨ç½²â¤ï¸",children:[]},{level:3,title:"æš´éœ²æœåŠ¡æµ‹è¯•",slug:"æš´éœ²æœåŠ¡æµ‹è¯•",children:[]}]},{level:2,title:"å°ç»“",slug:"å°ç»“",children:[]}],filePathRelative:"Docker/19 k8sé«˜çº§ç‰¹æ€§.md"}},83662:(n,s,a)=>{a.r(s),a.d(s,{default:()=>k});var p=a(20641);const e=(0,p.Fv)('<h2 id="replicaset" tabindex="-1"><a class="header-anchor" href="#replicaset" aria-hidden="true">#</a> ReplicaSet</h2><p>ReplicaSetç¡®ä¿ä»»ä½•æ—¶é—´éƒ½æœ‰æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬åœ¨è¿è¡Œã€‚é€šå¸¸ç”¨æ¥ä¿è¯ç»™å®šæ•°é‡çš„ã€å®Œå…¨ç›¸åŒçš„Podçš„å¯ç”¨æ€§ã€‚å»ºè®®ä½¿ç”¨Deploymentæ¥ç®¡ç†ReplicaSetï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ReplicaSetã€‚</p><h2 id="configmap" tabindex="-1"><a class="header-anchor" href="#configmap" aria-hidden="true">#</a> ConfigMap</h2><p>ConfigMapæ˜¯ä¸€ç§APIå¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚ä½¿ç”¨æ—¶ï¼ŒPodå¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ConfigMapå¯ä»¥å°†ä½ çš„é…ç½®æ•°æ®å’Œåº”ç”¨ç¨‹åºä»£ç åˆ†å¼€</p><h2 id="volume" tabindex="-1"><a class="header-anchor" href="#volume" aria-hidden="true">#</a> Volume</h2><p>VolumeæŒ‡çš„æ˜¯å­˜å‚¨å·ï¼ŒåŒ…å«å¯è¢«Podä¸­å®¹å™¨è®¿é—®çš„æ•°æ®ç›®å½•ã€‚å®¹å™¨ä¸­çš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ˜¯ä¸´æ—¶å­˜æ”¾çš„ï¼Œå½“å®¹å™¨å´©æºƒæ—¶æ–‡ä»¶ä¼šä¸¢å¤±ï¼ŒåŒæ—¶æ— æ³•åœ¨å¤šä¸ªPodä¸­å…±äº«æ–‡ä»¶ï¼Œé€šè¿‡ä½¿ç”¨å­˜å‚¨å·å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>å¸¸ç”¨çš„å­˜å‚¨å·æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>configMapï¼šconfigMapå·æä¾›äº†å‘Podæ³¨å…¥é…ç½®æ•°æ®çš„æ–¹æ³•ã€‚ConfigMapå¯¹è±¡ä¸­å­˜å‚¨çš„æ•°æ®å¯ä»¥è¢«configMapç±»å‹çš„å·å¼•ç”¨ï¼Œç„¶åè¢«Podä¸­è¿è¡Œçš„å®¹å™¨åŒ–åº”ç”¨ä½¿ç”¨ã€‚</li><li>emptyDirï¼šemptyDirå·å¯ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®ã€‚å½“Podåˆ†æ´¾åˆ°æŸä¸ªNodeä¸Šæ—¶ï¼ŒemptyDirå·ä¼šè¢«åˆ›å»ºï¼Œå¹¶ä¸”Podåœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡ŒæœŸé—´ï¼Œå·ä¸€ç›´å­˜åœ¨ã€‚å½“Podè¢«ä»èŠ‚ç‚¹ä¸Šåˆ é™¤æ—¶emptyDirå·ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚</li><li>hostPathï¼šhostPathå·èƒ½å°†ä¸»æœºèŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°ä½ çš„Podä¸­ã€‚åœ¨Minikubeä¸­çš„ä¸»æœºæŒ‡çš„æ˜¯Minikubeæ‰€åœ¨è™šæ‹Ÿæœºã€‚</li><li>localï¼šlocalå·æ‰€ä»£è¡¨çš„æ˜¯æŸä¸ªè¢«æŒ‚è½½çš„æœ¬åœ°å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ç£ç›˜ã€åˆ†åŒºæˆ–è€…ç›®å½•ã€‚localå·åªèƒ½ç”¨ä½œé™æ€åˆ›å»ºçš„æŒä¹…å·ï¼Œå°šä¸æ”¯æŒåŠ¨æ€é…ç½®ã€‚</li><li>nfsï¼šnfså·èƒ½å°†NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æŒ‚è½½åˆ°ä½ çš„Podä¸­ã€‚</li><li>persistentVolumeClaimï¼špersistentVolumeClaimå·ç”¨æ¥å°†æŒä¹…å·ï¼ˆPersistentVolumeï¼‰æŒ‚è½½åˆ°Podä¸­ã€‚æŒä¹…å·ï¼ˆPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥ç”±ç®¡ç†å‘˜äº‹å…ˆä¾›åº”ï¼Œæˆ–è€…ä½¿ç”¨å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰æ¥åŠ¨æ€ä¾›åº”ï¼ŒæŒä¹…å·æ˜¯é›†ç¾¤èµ„æºç±»ä¼¼äºèŠ‚ç‚¹</li></ul><h2 id="ingressğŸ˜˜" tabindex="-1"><a class="header-anchor" href="#ingressğŸ˜˜" aria-hidden="true">#</a> IngressğŸ˜˜</h2><p>é€šè¿‡K8Sçš„Ingressèµ„æºå¯ä»¥å®ç°ç±»ä¼¼Nginxçš„åŸºäºåŸŸåè®¿é—®ï¼Œä»è€Œå®ç°Podçš„è´Ÿè½½å‡è¡¡è®¿é—®ã€‚</p><p><img src="/images/Docker/111179.png" alt="https://note.youdao.com/yws/public/resource/bc7bee305611b52d6900ba209a92bd4d/xmlnote/CF0D33EA656C4B80A3161D651F0EC02E/111179"></p><p><strong>å®‰è£…Ingress</strong></p>',12),t={href:"https://github.com/kubernetes/ingress-nginx/blob/nginx-0.20.0/deploy/mandatory.yaml",target:"_blank",rel:"noopener noreferrer"},l={class:"custom-container details"},c=(0,p.Fv)('<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>configuration\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> tcp<span class="token punctuation">-</span>services\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> udp<span class="token punctuation">-</span>services\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">rules</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> configmaps\n      <span class="token punctuation">-</span> endpoints\n      <span class="token punctuation">-</span> nodes\n      <span class="token punctuation">-</span> pods\n      <span class="token punctuation">-</span> secrets\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> list\n      <span class="token punctuation">-</span> watch\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> nodes\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> services\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n      <span class="token punctuation">-</span> list\n      <span class="token punctuation">-</span> watch\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;extensions&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ingresses\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n      <span class="token punctuation">-</span> list\n      <span class="token punctuation">-</span> watch\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> events\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> create\n      <span class="token punctuation">-</span> patch\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;extensions&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ingresses/status\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> update\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">rules</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> configmaps\n      <span class="token punctuation">-</span> pods\n      <span class="token punctuation">-</span> secrets\n      <span class="token punctuation">-</span> namespaces\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> configmaps\n    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>\n      <span class="token comment"># Defaults to &quot;&lt;election-id&gt;-&lt;ingress-class&gt;&quot;</span>\n      <span class="token comment"># Here: &quot;&lt;ingress-controller-leader&gt;-&lt;nginx&gt;&quot;</span>\n      <span class="token comment"># This has to be adapted if you change either parameter</span>\n      <span class="token comment"># when launching the nginx-ingress-controller.</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;ingress-controller-leader-nginx&quot;</span>\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n      <span class="token punctuation">-</span> update\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> configmaps\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> create\n  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>\n    <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> endpoints\n    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> get\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role<span class="token punctuation">-</span>nisa<span class="token punctuation">-</span>binding\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>\n  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io\n  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role\n<span class="token key atrule">subjects</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount\n    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole<span class="token punctuation">-</span>nisa<span class="token punctuation">-</span>binding\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>\n  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io\n  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole\n<span class="token key atrule">subjects</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount\n    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n\n<span class="token punctuation">---</span>\n\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet \n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">selector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">template</span><span class="token punctuation">:</span>\n    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n      <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>\n        <span class="token key atrule">prometheus.io/port</span><span class="token punctuation">:</span> <span class="token string">&quot;10254&quot;</span>\n        <span class="token key atrule">prometheus.io/scrape</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>\n    <span class="token key atrule">spec</span><span class="token punctuation">:</span>\n      <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount\n      <span class="token key atrule">containers</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller\n          <span class="token key atrule">image</span><span class="token punctuation">:</span> siriuszg/nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller<span class="token punctuation">:</span>0.20.0\n          <span class="token key atrule">args</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> /nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller\n            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/nginx<span class="token punctuation">-</span>configuration\n            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>tcp<span class="token punctuation">-</span>services<span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/tcp<span class="token punctuation">-</span>services\n            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>udp<span class="token punctuation">-</span>services<span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/udp<span class="token punctuation">-</span>services\n            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>publish<span class="token punctuation">-</span>service=$(POD_NAMESPACE)/ingress<span class="token punctuation">-</span>nginx\n            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>annotations<span class="token punctuation">-</span>prefix=nginx.ingress.kubernetes.io\n          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>\n            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n            <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>\n              <span class="token key atrule">drop</span><span class="token punctuation">:</span>\n                <span class="token punctuation">-</span> ALL\n              <span class="token key atrule">add</span><span class="token punctuation">:</span>\n                <span class="token punctuation">-</span> NET_BIND_SERVICE\n            <span class="token comment"># www-data -&gt; 33</span>\n            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">33</span>\n          <span class="token key atrule">env</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME\n              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>\n                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>\n                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name\n            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE\n              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>\n                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>\n                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace\n          <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http\n              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>\n            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https\n              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">443</span>\n          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>\n            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>\n            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>\n              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz\n              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>\n              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP\n            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>\n            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>\n            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>\n            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>\n          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>\n            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>\n            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>\n              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz\n              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>\n              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP\n            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>\n            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>\n            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>\n\n<span class="token punctuation">---</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token comment">#type: NodePort</span>\n  <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http\n    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>\n    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>\n    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP\n  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https\n    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>\n    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">443</span>\n    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP\n  <span class="token key atrule">selector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br></div></div><h3 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h3><blockquote><p>å®‰è£…Ingress</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> kubectl apply <span class="token parameter variable">-f</span> ingress-controller.yaml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get pods <span class="token parameter variable">-n</span> ingress-nginx <span class="token parameter variable">-o</span> wide\n<span class="token punctuation">[</span>root@k8s-master learnk8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n ingress-nginx -o wide</span>\nNAME                             READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES\nnginx-ingress-controller-rqwgj   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m14s   <span class="token number">192.168</span>.135.132   k8s-node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>\nnginx-ingress-controller-txds2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m14s   <span class="token number">192.168</span>.135.135   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/images/Docker/image-20230425174451412.png" alt="image-20230425174451412"></p><h3 id="é…ç½®è®¿é—®è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#é…ç½®è®¿é—®è§„åˆ™" aria-hidden="true">#</a> é…ç½®è®¿é—®è§„åˆ™</h3><p>é…ç½®ingressè®¿é—®è§„åˆ™ï¼ˆå°±æ˜¯ç±»ä¼¼é…ç½®nginxçš„ä»£ç†è½¬å‘é…ç½®ï¼‰ï¼Œè®©ingresså°†åŸŸåtomcat.tuling.comè½¬å‘ç»™åç«¯çš„my-tomcat-yamlæœåŠ¡</p><p><img src="/images/Docker/image-20230425181346538.png" alt="image-20230425181346538"></p><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>ingress-tomcat.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1beta1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> web<span class="token punctuation">-</span>ingress\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">rules</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tomcat.hzz.org  <span class="token comment">#è½¬å‘åŸŸå</span>\n    <span class="token key atrule">http</span><span class="token punctuation">:</span>\n      <span class="token key atrule">paths</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /\n        <span class="token key atrule">backend</span><span class="token punctuation">:</span>\n          <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>tomcat<span class="token punctuation">-</span>yaml\n          <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>  <span class="token comment">#serviceçš„ç«¯å£</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæ•ˆè§„åˆ™</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> ingress-tomcat.yaml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>æŸ¥çœ‹ç”Ÿæ•ˆçš„ingressè§„åˆ™ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master learnk8s<span class="token punctuation">]</span><span class="token comment"># kubectl get ing</span>\nNAME          CLASS    HOSTS            ADDRESS   PORTS   AGE\nweb-ingress   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   tomcat.hzz.org             <span class="token number">80</span>      2m30s\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨è®¿é—®æœºå™¨é…ç½®hostï¼Œwin10å®¢æˆ·æœºåœ¨ç›®å½•ï¼š<code>C:\\Windows\\System32\\drivers\\etc</code>ï¼Œåœ¨hosté‡Œå¢åŠ å¦‚ä¸‹host(ingresséƒ¨ç½²çš„æœºå™¨ipå¯¹åº”è®¿é—®çš„åŸŸå)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> <span class="token number">192.168</span>.135.132 tomcat.hzz.org\n <span class="token number">192.168</span>.135.135 tomcat.hzz.org\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>',18),o={href:"http://tomcat.hzz.org/",target:"_blank",rel:"noopener noreferrer"},u=(0,p.Fv)('<p><img src="/images/Docker/image-20230425182529373.png" alt="image-20230425182529373"></p><h2 id="é…ç½®ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç®¡ç†" aria-hidden="true">#</a> é…ç½®ç®¡ç†</h2><p>ConfigMapå…è®¸ä½ å°†é…ç½®æ–‡ä»¶ä¸é•œåƒæ–‡ä»¶åˆ†ç¦»ï¼Œä»¥ä½¿å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå…·æœ‰å¯ç§»æ¤æ€§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¼”ç¤ºä¸‹å¦‚ä½•å°†ConfigMapçš„çš„å±æ€§æ³¨å…¥åˆ°Podçš„ç¯å¢ƒå˜é‡ä¸­å»</p><ul><li>æ·»åŠ é…ç½®æ–‡ä»¶<code>nginx-config.yaml</code>ç”¨äºåˆ›å»ºConfigMapï¼ŒConfigMapåç§°ä¸º<code>nginx-config</code>ï¼Œé…ç½®ä¿¡æ¯å­˜æ”¾åœ¨dataèŠ‚ç‚¹ä¸‹ï¼š</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default\n<span class="token key atrule">data</span><span class="token punctuation">:</span>\n  <span class="token key atrule">nginx-env</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>q10viking\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>åº”ç”¨ nginx-config.yaml æ–‡ä»¶åˆ›å»ºConfigMap</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create <span class="token parameter variable">-f</span> nginx-config.yaml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>è·å–ConfigMap</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master learnk8s<span class="token punctuation">]</span><span class="token comment"># kubectl get ConfigMap</span>\nNAME           DATA   AGE\nnginx-config   <span class="token number">1</span>      42s\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/images/Docker/image-20230425184301099.png" alt="image-20230425184301099"></p></li></ul><h3 id="ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨" aria-hidden="true">#</a> ä½¿ç”¨</h3><ul><li><p>æ·»åŠ é…ç½®æ–‡ä»¶ nginx-deployment.yaml ç”¨äºåˆ›å»ºDeploymentï¼Œéƒ¨ç½²ä¸€ä¸ªNginxæœåŠ¡ï¼Œåœ¨Nginxçš„ç¯å¢ƒå˜é‡ä¸­å¼•ç”¨ConfigMapä¸­çš„å±æ€§</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment"># ä¿®æ”¹label</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment  <span class="token comment"># ä¿®æ”¹deploymentçš„åç§°</span>\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>  \n  <span class="token key atrule">selector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment"># ä¿®æ”¹</span>\n  <span class="token key atrule">template</span><span class="token punctuation">:</span>\n    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n      <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment">#ä¿®æ”¹</span>\n    <span class="token key atrule">spec</span><span class="token punctuation">:</span>\n      <span class="token key atrule">containers</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.10</span>\n        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx\n        <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>\n        <span class="token key atrule">env</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NGINX_ENV  <span class="token comment">#åœ¨nginxä¸­è®¾ç½®ç¯å¢ƒå˜é‡</span>\n            <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>\n              <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span>\n                <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config <span class="token comment"># è®¾ç½®ConfigMapåç§°</span>\n                <span class="token key atrule">key</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>env <span class="token comment"># éœ€è¦å–å€¼çš„é”®</span>\n<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li><li><p>åº”ç”¨é…ç½®æ–‡ä»¶æ–‡ä»¶åˆ›å»ºDeployment</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> nginx-deployment.yaml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>åˆ›å»ºæˆåŠŸåæŸ¥çœ‹Podä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå‘ç°NGINX_ENVå˜é‡å·²ç»è¢«æ³¨å…¥äº†ï¼›</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master learnk8s<span class="token punctuation">]</span><span class="token comment"># kubectl exec nginx-deployment-7cf97748c4-bzszj -- env</span>\n<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>nginx-deployment-7cf97748c4-bzszj\n\n<span class="token assign-left variable">NGINX_ENV</span><span class="token operator">=</span>hello-q10viking\n\n<span class="token assign-left variable">NGINX_SERVICE_PORT</span><span class="token operator">=</span><span class="token number">80</span>\n<span class="token assign-left variable">NGINX_PORT</span><span class="token operator">=</span>tcp://10.108.139.46:80\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul><h2 id="å­˜å‚¨å·çš„ä½¿ç”¨â¤ï¸" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å·çš„ä½¿ç”¨â¤ï¸" aria-hidden="true">#</a> å­˜å‚¨å·çš„ä½¿ç”¨â¤ï¸</h2><div class="custom-container tip"><p class="custom-container-title">TIP</p><ul><li>å°†nginxçš„<code>nginx.conf</code>å’Œ<code>index.html</code>é€šè¿‡ConfigMapé…ç½®åˆ°nginxä¸­</li><li>å°†nginx,å®¹å™¨çš„logsæ—¥å¿—æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š</li></ul></div>',10),r=(0,p.Fv)('<h3 id="å‡†å¤‡é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> å‡†å¤‡é…ç½®æ–‡ä»¶</h3><blockquote><p>index.html</p></blockquote><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">\n            <span class="token selector">body</span> <span class="token punctuation">{</span>\n                <span class="token property">width</span><span class="token punctuation">:</span> 35em<span class="token punctuation">;</span>\n                <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>\n                <span class="token property">font-family</span><span class="token punctuation">:</span> Tahoma<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Q10Viking changed this html page!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If you see this page, the nginx web server is successfully installed and\n            working. Further configuration is required.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>\n\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Q10Viking learning k8s technology :)\n            &lt;a href=\\&quot;http://nginx.org/\\&quot;&gt;nginx.org<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>\n            Commercial support is available at\n            &lt;a href=\\&quot;http://nginx.com/\\&quot;&gt;nginx.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>\n\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Thank you for using nginx.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master html<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap  nginx-index-config --from-file=index.html</span>\nconfigmap/nginx-index-config createdsh\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/images/Docker/image-20230426092503246.png" alt="image-20230426092503246"></p><blockquote><p>nginx.conf</p></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>worker_processes  1;\n\t\t\n\t\tevents <span class="token punctuation">{</span>\n\t\t    worker_connections  1024;\n\t\t<span class="token punctuation">}</span>\n\t\t\n\t\thttp <span class="token punctuation">{</span>\n\t\t  \n\t\t    sendfile        on;\n\t\t    <span class="token comment">#tcp_nopush     on;</span>\n\t\t\n\t\t    keepalive_timeout  65;\n\t\t    access_log /var/log/nginx/access.log; <span class="token comment"># é…ç½®æ—¥å¿—è¾“å‡ºçš„ä½ç½®</span>\n\t\t\n\t\t\n\t\t    server <span class="token punctuation">{</span>\n\t\t        listen       80;\n\t\t        server_name  localhost;\n\t\t        location / <span class="token punctuation">{</span>\n\t\t            root   /usr/share/nginx/html;    <span class="token comment"># æ³¨æ„ä½ç½®</span>\n\t\t            index  index.html;\n\t\t        <span class="token punctuation">}</span>\n\t\t\n\t\t    <span class="token punctuation">}</span>\n\t\t<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create configmap nginx-config-conf --from-file<span class="token operator">=</span>nginx.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/Docker/image-20230426162840632.png" alt="image-20230426162840632"></p><h4 id="æ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#æ•ˆæœ" aria-hidden="true">#</a> æ•ˆæœ</h4><p><img src="/images/Docker/image-20230426162907214.png" alt="image-20230426162907214"></p><h3 id="éƒ¨ç½²â¤ï¸" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²â¤ï¸" aria-hidden="true">#</a> éƒ¨ç½²â¤ï¸</h3><p>é€šè¿‡å­˜å‚¨å·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤–éƒ¨æ•°æ®æŒ‚è½½åˆ°å®¹å™¨ä¸­å»ï¼Œä¾›å®¹å™¨ä¸­çš„åº”ç”¨è®¿é—®ï¼Œè¿™æ ·å°±ç®—å®¹å™¨å´©æºƒäº†ï¼Œæ•°æ®ä¾ç„¶å¯ä»¥å­˜åœ¨ã€‚</p><ul><li>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨Dockeréƒ¨ç½²è½¯ä»¶æ—¶æ˜¯å¯ä»¥æŒ‚è½½æ–‡ä»¶çš„</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token parameter variable">--name</span> nginx <span class="token punctuation">\\</span>\n<span class="token parameter variable">-v</span> /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>\n<span class="token parameter variable">-v</span> /mydata/nginx/logs:/var/log/nginx  <span class="token punctuation">\\</span>\n<span class="token parameter variable">-v</span> /mydata/nginx/conf:/etc/nginx <span class="token punctuation">\\</span>\n<span class="token parameter variable">-d</span> nginx:1.10\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>K8Sä¹Ÿå¯ä»¥æŒ‚è½½æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®æ–‡ä»¶<code>nginx-volume-deployment.yaml</code>ç”¨äºåˆ›å»ºDeploymentï¼š <ul><li>å°†ConfigMap nginx-index-configæŒ‚è½½åˆ°nginxå®¹å™¨çš„<code>/usr/share/nginx/html</code>ç›®å½•</li><li>å°†ConfigMap nginx-config-confæŒ‚è½½åˆ°nginxå®¹å™¨çš„<code>/etc/nginx</code>ç›®å½•</li><li>å°†å®¿ä¸»æœºçš„<code>/mydata/nginx/logs</code>æŒ‚è½½åˆ°nginxå®¹å™¨çš„<code>/var/log/nginx</code>ç›®å½•</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment"># ä¿®æ”¹label</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>volume<span class="token punctuation">-</span>deployment  <span class="token comment"># ä¿®æ”¹deploymentçš„åç§°</span>\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>\n  <span class="token key atrule">selector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment"># ä¿®æ”¹</span>\n  <span class="token key atrule">template</span><span class="token punctuation">:</span>\n    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n      <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx <span class="token comment">#ä¿®æ”¹</span>\n    <span class="token key atrule">spec</span><span class="token punctuation">:</span>\n      <span class="token key atrule">containers</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.10</span>\n        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx\n        <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>\n        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html\n            <span class="token key atrule">name</span><span class="token punctuation">:</span> html<span class="token punctuation">-</span>volume\n          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx\n            <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume\n          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/nginx\n            <span class="token key atrule">name</span><span class="token punctuation">:</span> conf<span class="token punctuation">-</span>volume\n      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> html<span class="token punctuation">-</span>volume\n        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>\n          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>index<span class="token punctuation">-</span>config\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume\n        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>\n          <span class="token key atrule">path</span><span class="token punctuation">:</span> /mydata/nginx/logs\n          <span class="token key atrule">type</span><span class="token punctuation">:</span> DirectoryOrCreate\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> conf<span class="token punctuation">-</span>volume\n        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>\n          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config<span class="token punctuation">-</span>conf\n      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always\n<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><blockquote><p>æ‰§è¡Œéƒ¨ç½²</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> nginx-volume-deployment.yaml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/Docker/image-20230426163526571.png" alt="image-20230426163526571"></p><p><img src="/images/Docker/image-20230426163819588.png" alt="image-20230426163819588"></p><h3 id="æš´éœ²æœåŠ¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æš´éœ²æœåŠ¡æµ‹è¯•" aria-hidden="true">#</a> æš´éœ²æœåŠ¡æµ‹è¯•</h3><blockquote><p>æš´éœ²æœåŠ¡</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl expose deployment nginx-volume-deployment <span class="token parameter variable">--name</span><span class="token operator">=</span>nginx-volume <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span> <span class="token parameter variable">--type</span><span class="token operator">=</span>NodePort\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="/images/Docker/image-20230426162015757.png" alt="image-20230426162015757"></p><blockquote><p>æ—¥å¿—æµ‹è¯•</p></blockquote><p><img src="/images/Docker/image-20230426174023623.png" alt="image-20230426174023623"></p><ul><li>éƒ¨ç½²åœ¨node1çš„nginxè¾“å‡ºæ—¥å¿—åœ¨node1ä¸Š</li><li>éƒ¨ç½²åœ¨node2çš„nginxè¾“å‡ºæ—¥å¿—åœ¨node2ä¸Š</li></ul><h2 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h2><p><strong>Service æ˜¯ K8S æœåŠ¡çš„æ ¸å¿ƒï¼Œå±è”½äº†æœåŠ¡ç»†èŠ‚ï¼Œç»Ÿä¸€å¯¹å¤–æš´éœ²æœåŠ¡æ¥å£ï¼ŒçœŸæ­£åšåˆ°äº†â€œå¾®æœåŠ¡â€</strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæœåŠ¡ Aï¼Œéƒ¨ç½²äº† 3 ä¸ªå¤‡ä»½ï¼Œä¹Ÿå°±æ˜¯ 3 ä¸ª Podï¼›å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œåªéœ€è¦å…³æ³¨ä¸€ä¸ª Service çš„å…¥å£å°±å¯ä»¥ï¼Œè€Œä¸éœ€è¦æ“å¿ƒç©¶ç«Ÿåº”è¯¥è¯·æ±‚å“ªä¸€ä¸ª Podã€‚ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼š<strong>ä¸€æ–¹é¢å¤–éƒ¨ç”¨æˆ·ä¸éœ€è¦æ„ŸçŸ¥å› ä¸º Pod ä¸ŠæœåŠ¡çš„æ„å¤–å´©æºƒã€K8S é‡æ–°æ‹‰èµ· Pod è€Œé€ æˆçš„ IP å˜æ›´ï¼Œå¤–éƒ¨ç”¨æˆ·ä¹Ÿä¸éœ€è¦æ„ŸçŸ¥å› å‡çº§ã€å˜æ›´æœåŠ¡å¸¦æ¥çš„ Pod æ›¿æ¢è€Œé€ æˆçš„ IP å˜åŒ–ï¼Œå¦ä¸€æ–¹é¢ï¼ŒService è¿˜å¯ä»¥åšæµé‡è´Ÿè½½å‡è¡¡</strong></p><p>ä½†æ˜¯ï¼ŒService ä¸»è¦è´Ÿè´£ K8S é›†ç¾¤<strong>å†…éƒ¨çš„ç½‘ç»œæ‹“æ‰‘</strong>ã€‚é›†ç¾¤å¤–éƒ¨éœ€è¦ç”¨ Ingress ã€‚</p><p>Ingress æ˜¯æ•´ä¸ª K8S é›†ç¾¤çš„æ¥å…¥å±‚ï¼Œå¤æ‚é›†ç¾¤å†…å¤–é€šè®¯ã€‚</p><p>Ingress å’Œ Service çš„ç½‘ç»œæ‹“æ‰‘å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/images/Docker/110774.png" alt="https://note.youdao.com/yws/public/resource/bc7bee305611b52d6900ba209a92bd4d/xmlnote/1E62D8F04F0D47A5A1F1720FE24E8C9A/110774"></p>',34),i={},k=(0,a(66262).A)(i,[["render",function(n,s){const a=(0,p.g2)("OutboundLink");return(0,p.uX)(),(0,p.CE)(p.FK,null,[e,(0,p.Lk)("p",null,[(0,p.eW)("è¿›å…¥é¡µé¢"),(0,p.Lk)("a",t,[(0,p.eW)("ingress-nginx/mandatory.yaml at nginx-0.20.0 Â· kubernetes/ingress-nginx Â· GitHub"),(0,p.bF)(a)]),(0,p.eW)("ï¼Œå°†é‡Œé¢å†…å®¹å¤åˆ¶ï¼Œä¿å­˜åˆ°k8s masteræœºå™¨ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ingress-controller.yamlé‡Œã€‚è¿è¡Œç½‘ä¸Šçš„è¿™ä¸ªæœ‰é—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥è¯•ä¸‹é¢çš„ã€‚")]),(0,p.Lk)("details",l,[c,(0,p.Lk)("p",null,[(0,p.eW)("é…ç½®å®Œåç›´æ¥åœ¨å®¢æˆ·æœºæµè§ˆå™¨è®¿é—®"),(0,p.Lk)("a",o,[(0,p.eW)("http://tomcat.hzz.org/"),(0,p.bF)(a)]),(0,p.eW)(" ï¼Œèƒ½æ­£å¸¸è®¿é—®tomcatã€‚")]),u]),r],64)}]])},66262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,p]of s)a[n]=p;return a}}}]);