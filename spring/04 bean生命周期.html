<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>é™é»˜ã®Blog</title><meta name="description" content="é™é»˜çš„Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">é™é»˜ã®Blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#beançš„ç”Ÿå‘½å‘¨æœŸ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Beançš„ç”Ÿå‘½å‘¨æœŸ"><!--[--><!--]--> Beançš„ç”Ÿå‘½å‘¨æœŸ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#springåº•å±‚æ‰«é¢" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Springåº•å±‚æ‰«é¢"><!--[--><!--]--> Springåº•å±‚æ‰«é¢ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#åˆå¹¶beandefinition" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åˆå¹¶BeanDefinition"><!--[--><!--]--> åˆå¹¶BeanDefinition <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#ç±»åŠ è½½" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç±»åŠ è½½"><!--[--><!--]--> ç±»åŠ è½½ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#å®ä¾‹åŒ–å‰" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å®ä¾‹åŒ–å‰"><!--[--><!--]--> å®ä¾‹åŒ–å‰ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#å®ä¾‹åŒ–" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å®ä¾‹åŒ–"><!--[--><!--]--> å®ä¾‹åŒ– <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_1-supplieråˆ›å»ºå¯¹è±¡" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1. Supplieråˆ›å»ºå¯¹è±¡"><!--[--><!--]--> 1. Supplieråˆ›å»ºå¯¹è±¡ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="2. å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡"><!--[--><!--]--> 2. å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_3-æ¨æ–­æ„é€ æ–¹æ³•" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3. æ¨æ–­æ„é€ æ–¹æ³•"><!--[--><!--]--> 3. æ¨æ–­æ„é€ æ–¹æ³• <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#beandefinitionçš„åç½®å¤„ç†â¤ï¸" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="BeanDefinitionçš„åç½®å¤„ç†â¤ï¸"><!--[--><!--]--> BeanDefinitionçš„åç½®å¤„ç†â¤ï¸ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#å®ä¾‹åŒ–å" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å®ä¾‹åŒ–å"><!--[--><!--]--> å®ä¾‹åŒ–å <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#è‡ªåŠ¨æ³¨å…¥" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è‡ªåŠ¨æ³¨å…¥"><!--[--><!--]--> è‡ªåŠ¨æ³¨å…¥ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#å¤„ç†å±æ€§" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¤„ç†å±æ€§"><!--[--><!--]--> å¤„ç†å±æ€§ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#æ‰§è¡Œaware" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æ‰§è¡ŒAware"><!--[--><!--]--> æ‰§è¡ŒAware <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#åˆå§‹åŒ–å‰" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åˆå§‹åŒ–å‰"><!--[--><!--]--> åˆå§‹åŒ–å‰ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#åˆå§‹åŒ–" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åˆå§‹åŒ–"><!--[--><!--]--> åˆå§‹åŒ– <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#åˆå§‹åŒ–å" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åˆå§‹åŒ–å"><!--[--><!--]--> åˆå§‹åŒ–å <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#beançš„é”€æ¯è¿‡ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Beançš„é”€æ¯è¿‡ç¨‹"><!--[--><!--]--> Beançš„é”€æ¯è¿‡ç¨‹ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#è®¾è®¡æ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è®¾è®¡æ¨¡å¼"><!--[--><!--]--> è®¾è®¡æ¨¡å¼ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/spring/04%20bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#springbootä¸­çš„contextå…³é—­" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="SpringBootä¸­çš„contextå…³é—­"><!--[--><!--]--> SpringBootä¸­çš„contextå…³é—­ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="beançš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#beançš„ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><p><a href="https://www.processon.com/view/link/5f15341b07912906d9ae8642" target="_blank" rel="noopener noreferrer">link<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:625px;height:345px;" src="https://www.processon.com/view/link/5f15341b07912906d9ae8642"></iframe><p><a href="https://github.com/Q10Viking/learncode/tree/main/spring/_02_spring-bean-lifecycle" target="_blank" rel="noopener noreferrer">Source Code<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://www.processon.com/view/link/5f8588c87d9c0806f27358c1" target="_blank" rel="noopener noreferrer">Link<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:625px;height:345px;" src="https://www.processon.com/view/link/5f8588c87d9c0806f27358c1"></iframe><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>å®ä¾‹åŒ–å‰: InstantiationAwareBeanPostProcessor<span class="token comment">#postProcessBeforeInstantiation</span>
æ„é€ æ–¹æ³•
merged bean definition: MergedBeanDefinitionPostProcessor<span class="token comment">#postProcessMergedBeanDefinition</span>
å®ä¾‹åŒ–å: InstantiationAwareBeanPostProcessor<span class="token comment">#postProcessAfterInstantiation</span>
å·²ç»å®Œæˆå±æ€§æ³¨å…¥Hello World <span class="token operator">|</span> InstantiationAwareBeanPostProcessor<span class="token comment">#postProcessProperties</span>
Aware bean name: userService
@PostConstruct
åˆå§‹åŒ–å‰: BeanPostProcessor<span class="token comment">#postProcessBeforeInitialization</span>
InitializingBean<span class="token comment">#afterPropertiesSet</span>
åˆå§‹åŒ–å: BeanPostProcessor<span class="token comment">#postProcessAfterInitialization</span>
@PreDestory
DisposableBean<span class="token comment">#destroy</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="springåº•å±‚æ‰«é¢" tabindex="-1"><a class="header-anchor" href="#springåº•å±‚æ‰«é¢" aria-hidden="true">#</a> Springåº•å±‚æ‰«é¢</h2><p><a href="https://www.processon.com/view/link/61370ee60e3e7412ecd95d43" target="_blank" rel="noopener noreferrer">Link<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:625px;height:345px;" src="https://www.processon.com/view/link/61370ee60e3e7412ecd95d43"></iframe><ol><li>é¦–å…ˆï¼Œé€šè¿‡ResourcePatternResolverè·å¾—æŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„æ‰€æœ‰<code>.class</code>æ–‡ä»¶ï¼ˆSpringæºç ä¸­å°†æ­¤æ–‡ä»¶åŒ…è£…æˆäº†Resourceå¯¹è±¡ï¼‰</li><li>éå†æ¯ä¸ªResourceå¯¹è±¡</li><li>åˆ©ç”¨MetadataReaderFactoryè§£æResourceå¯¹è±¡å¾—åˆ°MetadataReaderï¼ˆåœ¨Springæºç ä¸­MetadataReaderFactoryå…·ä½“çš„å®ç°ç±»ä¸ºCachingMetadataReaderFactoryï¼ŒMetadataReaderçš„å…·ä½“å®ç°ç±»ä¸ºSimpleMetadataReaderï¼‰</li><li>åˆ©ç”¨MetadataReaderè¿›è¡ŒexcludeFilterså’ŒincludeFiltersï¼Œä»¥åŠæ¡ä»¶æ³¨è§£@Conditionalçš„ç­›é€‰ï¼ˆæ¡ä»¶æ³¨è§£å¹¶ä¸èƒ½ç†è§£ï¼šæŸä¸ªç±»ä¸Šæ˜¯å¦å­˜åœ¨@Conditionalæ³¨è§£ï¼Œå¦‚æœå­˜åœ¨åˆ™è°ƒç”¨æ³¨è§£ä¸­æ‰€æŒ‡å®šçš„ç±»çš„matchæ–¹æ³•è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™é€šè¿‡ç­›é€‰ï¼ŒåŒ¹é…å¤±è´¥åˆ™passæ‰ã€‚ï¼‰</li><li>ç­›é€‰é€šè¿‡åï¼ŒåŸºäºmetadataReaderç”ŸæˆScannedGenericBeanDefinition</li><li>å†åŸºäºmetadataReaderåˆ¤æ–­æ˜¯ä¸æ˜¯å¯¹åº”çš„ç±»æ˜¯ä¸æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»</li><li>å¦‚æœç­›é€‰é€šè¿‡ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºæ‰«æåˆ°äº†ä¸€ä¸ªBeanï¼Œå°†ScannedGenericBeanDefinitionåŠ å…¥ç»“æœé›†</li></ol><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCachingMetadataReaderFactoryè§£ææŸä¸ª.classæ–‡ä»¶å¾—åˆ°MetadataReaderå¯¹è±¡æ˜¯åˆ©ç”¨çš„<strong>ASM</strong>æŠ€æœ¯ï¼Œå¹¶æ²¡æœ‰åŠ è½½è¿™ä¸ªç±»åˆ°JVMã€‚å¹¶ä¸”ï¼Œæœ€ç»ˆå¾—åˆ°çš„ScannedGenericBeanDefinitionå¯¹è±¡ï¼Œ<strong>beanClasså±æ€§å­˜å‚¨çš„æ˜¯å½“å‰ç±»çš„åå­—ï¼Œè€Œä¸æ˜¯classå¯¹è±¡</strong>ã€‚ï¼ˆbeanClasså±æ€§çš„ç±»å‹æ˜¯Objectï¼Œå®ƒå³å¯ä»¥å­˜å‚¨ç±»çš„åå­—ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨classå¯¹è±¡ï¼‰</p></blockquote><h3 id="åˆå¹¶beandefinition" tabindex="-1"><a class="header-anchor" href="#åˆå¹¶beandefinition" aria-hidden="true">#</a> åˆå¹¶BeanDefinition</h3><p>é€šè¿‡æ‰«æå¾—åˆ°æ‰€æœ‰BeanDefinitionä¹‹åï¼Œå°±å¯ä»¥æ ¹æ®BeanDefinitionåˆ›å»ºBeanå¯¹è±¡äº†ï¼Œä½†æ˜¯åœ¨Springä¸­æ”¯æŒçˆ¶å­BeanDefinitionï¼Œå’ŒJavaçˆ¶å­ç±»ç±»ä¼¼ï¼Œä½†æ˜¯å®Œå…¨ä¸æ˜¯ä¸€å›äº‹ã€‚</p><p>çˆ¶å­BeanDefinitionå®é™…ç”¨çš„æ¯”è¾ƒå°‘ï¼Œä½¿ç”¨æ˜¯è¿™æ ·çš„ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;parent&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.zhouyu.service.Parent&quot;</span> scope<span class="token operator">=</span><span class="token string">&quot;prototype&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;child&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.zhouyu.service.Child&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¹ˆå®šä¹‰çš„æƒ…å†µä¸‹ï¼Œchildæ˜¯å•ä¾‹Beanã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;parent&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.zhouyu.service.Parent&quot;</span> scope<span class="token operator">=</span><span class="token string">&quot;prototype&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;child&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.zhouyu.service.Child&quot;</span> parent<span class="token operator">=</span><span class="token string">&quot;parent&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä½†æ˜¯è¿™ä¹ˆå®šä¹‰çš„æƒ…å†µä¸‹ï¼Œchildå°±æ˜¯åŸå‹Beanäº†ã€‚â€‹</p><p>å› ä¸ºchildçš„çˆ¶BeanDefinitionæ˜¯parentï¼Œæ‰€ä»¥ä¼šç»§æ‰¿parentä¸Šæ‰€å®šä¹‰çš„scopeå±æ€§ã€‚ â€‹è€Œåœ¨æ ¹æ®childæ¥ç”ŸæˆBeanå¯¹è±¡ä¹‹å‰ï¼Œéœ€è¦è¿›è¡ŒBeanDefinitionçš„åˆå¹¶ï¼Œå¾—åˆ°å®Œæ•´çš„childçš„BeanDefinitionã€‚</p><h3 id="ç±»åŠ è½½" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½" aria-hidden="true">#</a> ç±»åŠ è½½</h3><p>BeanDefinitionåˆå¹¶ä¹‹åï¼Œå°±å¯ä»¥å»åˆ›å»ºBeanå¯¹è±¡äº†ï¼Œè€Œåˆ›å»ºBeanå°±å¿…é¡»å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œå®ä¾‹åŒ–å°±å¿…é¡»å…ˆåŠ è½½å½“å‰BeanDefinitionæ‰€å¯¹åº”çš„classï¼Œåœ¨AbstractAutowireCapableBeanFactoryç±»çš„createBean()æ–¹æ³•ä¸­ï¼Œä¸€å¼€å§‹å°±ä¼šè°ƒç”¨ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolvedClass <span class="token operator">=</span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>è¿™è¡Œä»£ç å°±æ˜¯å»åŠ è½½ç±»ï¼Œè¯¥æ–¹æ³•æ˜¯è¿™ä¹ˆå®ç°çš„ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mbd<span class="token punctuation">.</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PrivilegedExceptionAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                                         <span class="token function">doResolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> typesToMatch<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">doResolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> typesToMatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanClass <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å¦‚æœbeanClasså±æ€§çš„ç±»å‹æ˜¯Classï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šæ ¹æ®ç±»åè¿›è¡ŒåŠ è½½ï¼ˆdoResolveBeanClassæ–¹æ³•æ‰€åšçš„äº‹æƒ…ï¼‰</p><p>ä¼šåˆ©ç”¨BeanFactoryæ‰€è®¾ç½®çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨**ClassUtils.getDefaultClassLoader()**æ‰€è¿”å›çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚</p><h4 id="classutils-getdefaultclassloader" tabindex="-1"><a class="header-anchor" href="#classutils-getdefaultclassloader" aria-hidden="true">#</a> <strong>ClassUtils.getDefaultClassLoader()</strong></h4><ol><li>ä¼˜å…ˆè¿”å›å½“å‰çº¿ç¨‹ä¸­çš„ClassLoader</li><li>çº¿ç¨‹ä¸­ç±»åŠ è½½å™¨ä¸ºnullçš„æƒ…å†µä¸‹ï¼Œè¿”å›ClassUtilsç±»çš„ç±»åŠ è½½å™¨</li><li>å¦‚æœClassUtilsç±»çš„ç±»åŠ è½½å™¨ä¸ºç©ºï¼Œé‚£ä¹ˆåˆ™è¡¨ç¤ºæ˜¯Bootstrapç±»åŠ è½½å™¨åŠ è½½çš„ClassUtilsç±»ï¼Œé‚£ä¹ˆåˆ™è¿”å›ç³»ç»Ÿç±»åŠ è½½å™¨</li></ol><h2 id="å®ä¾‹åŒ–å‰" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–å‰" aria-hidden="true">#</a> å®ä¾‹åŒ–å‰</h2><p>å½“å‰BeanDefinitionå¯¹åº”çš„ç±»æˆåŠŸåŠ è½½åï¼Œå°±å¯ä»¥å®ä¾‹åŒ–å¯¹è±¡äº†ï¼Œä½†æ˜¯... â€‹</p><p>åœ¨Springä¸­ï¼Œå®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰ï¼ŒSpringæä¾›äº†ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå…è®¸ç”¨æˆ·æ¥æ§åˆ¶æ˜¯å¦åœ¨æŸä¸ªæˆ–æŸäº›Beanå®ä¾‹åŒ–ä¹‹å‰åšä¸€äº›å¯åŠ¨åŠ¨ä½œã€‚è¿™ä¸ªæ‰©å±•ç‚¹å«<strong>InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation()</strong>ã€‚æ¯”å¦‚ï¼š â€‹</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®ä¾‹åŒ–å‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¦‚ä¸Šä»£ç ä¼šå¯¼è‡´ï¼Œåœ¨userServiceè¿™ä¸ªBeanå®ä¾‹åŒ–å‰ï¼Œä¼šè¿›è¡Œæ‰“å°ã€‚ â€‹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒpostProcessBeforeInstantiation()æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå¦‚æœè¿™ä¹ˆå®ç°ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®ä¾‹åŒ–å‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>userServiceè¿™ä¸ªBeanï¼Œåœ¨å®ä¾‹åŒ–å‰ä¼šç›´æ¥è¿”å›ä¸€ä¸ªç”±æˆ‘ä»¬æ‰€å®šä¹‰çš„UserServiceå¯¹è±¡ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œè¡¨ç¤ºä¸éœ€è¦Springæ¥å®ä¾‹åŒ–äº†ï¼Œå¹¶ä¸”åç»­çš„Springä¾èµ–æ³¨å…¥ä¹Ÿä¸ä¼šè¿›è¡Œäº†ï¼Œä¼šè·³è¿‡ä¸€äº›æ­¥éª¤ï¼Œç›´æ¥æ‰§è¡Œåˆå§‹åŒ–åè¿™ä¸€æ­¥ã€‚</p><hr><h2 id="å®ä¾‹åŒ–" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–" aria-hidden="true">#</a> å®ä¾‹åŒ–</h2><p>åœ¨è¿™ä¸ªæ­¥éª¤ä¸­å°±ä¼šæ ¹æ®BeanDefinitionå»åˆ›å»ºä¸€ä¸ªå¯¹è±¡äº†ã€‚</p><h3 id="_1-supplieråˆ›å»ºå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1-supplieråˆ›å»ºå¯¹è±¡" aria-hidden="true">#</a> 1. Supplieråˆ›å»ºå¯¹è±¡</h3><p>é¦–å…ˆåˆ¤æ–­BeanDefinitionä¸­æ˜¯å¦è®¾ç½®äº†Supplierï¼Œå¦‚æœè®¾ç½®äº†åˆ™è°ƒç”¨Supplierçš„get()å¾—åˆ°å¯¹è±¡ã€‚ â€‹å¾—ç›´æ¥ä½¿ç”¨BeanDefinitionå¯¹è±¡æ¥è®¾ç½®Supplierï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token class-name">BeanDefinitionBuilder</span><span class="token punctuation">.</span><span class="token function">genericBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
beanDefinition<span class="token punctuation">.</span><span class="token function">setInstanceSupplier</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_2-å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡" aria-hidden="true">#</a> 2. å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡</h3><p>å¦‚æœæ²¡æœ‰è®¾ç½®Supplierï¼Œåˆ™æ£€æŸ¥BeanDefinitionä¸­æ˜¯å¦è®¾ç½®äº†factoryMethodï¼Œä¹Ÿå°±æ˜¯å·¥å‚æ–¹æ³•ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¾ç½®factoryMethodï¼Œæ¯”å¦‚ï¼š â€‹</p><p>æ–¹å¼ä¸€ï¼š</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.zhouyu.service.UserService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createUserService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>å¯¹åº”çš„UserServiceç±»ä¸ºï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">UserService</span> <span class="token function">createUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡ŒcreateUserService()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ–¹å¼äºŒï¼š</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commonService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.zhouyu.service.CommonService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commonService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createUserService<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¯¹åº”çš„CommonServiceçš„ç±»ä¸ºï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">UserService</span> <span class="token function">createUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Springå‘ç°å½“å‰BeanDefinitionæ–¹æ³•è®¾ç½®äº†å·¥å‚æ–¹æ³•åï¼Œå°±ä¼šåŒºåˆ†è¿™ä¸¤ç§æ–¹å¼ï¼Œç„¶åè°ƒç”¨å·¥å‚æ–¹æ³•å¾—åˆ°å¯¹è±¡ã€‚ â€‹</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡@Beanæ‰€å®šä¹‰çš„BeanDefinitionï¼Œæ˜¯å­˜åœ¨factoryMethodå’ŒfactoryBeançš„ï¼Œä¹Ÿå°±æ˜¯å’Œä¸Šé¢çš„æ–¹å¼äºŒéå¸¸ç±»ä¼¼ï¼Œ@Beanæ‰€æ³¨è§£çš„æ–¹æ³•å°±æ˜¯factoryMethodï¼ŒAppConfigå¯¹è±¡å°±æ˜¯factoryBeanã€‚å¦‚æœ@Beanæ‰€æ‰€æ³¨è§£çš„æ–¹æ³•æ˜¯staticçš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„å°±æ˜¯æ–¹å¼ä¸€ã€‚</p><h3 id="_3-æ¨æ–­æ„é€ æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-æ¨æ–­æ„é€ æ–¹æ³•" aria-hidden="true">#</a> 3. æ¨æ–­æ„é€ æ–¹æ³•</h3><p>æ¨æ–­å®Œæ„é€ æ–¹æ³•åï¼Œå°±ä¼šä½¿ç”¨æ„é€ æ–¹æ³•æ¥è¿›è¡Œå®ä¾‹åŒ–äº†ã€‚</p><p>é¢å¤–çš„ï¼Œåœ¨æ¨æ–­æ„é€ æ–¹æ³•é€»è¾‘ä¸­é™¤å¼€ä¼šå»é€‰æ‹©æ„é€ æ–¹æ³•ä»¥åŠæŸ¥æ‰¾å…¥å‚å¯¹è±¡æ„å¤–ï¼Œä¼šè¿˜åˆ¤æ–­æ˜¯å¦åœ¨å¯¹åº”çš„ç±»ä¸­æ˜¯å¦å­˜åœ¨ä½¿ç”¨**@Lookupæ³¨è§£**äº†æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨åˆ™æŠŠè¯¥æ–¹æ³•å°è£…ä¸ºLookupOverrideå¯¹è±¡å¹¶æ·»åŠ åˆ°BeanDefinitionä¸­ã€‚ â€‹</p><p>åœ¨å®ä¾‹åŒ–æ—¶ï¼Œå¦‚æœåˆ¤æ–­å‡ºæ¥å½“å‰BeanDefinitionä¸­æ²¡æœ‰LookupOverrideï¼Œé‚£å°±ç›´æ¥ç”¨æ„é€ æ–¹æ³•åå°„å¾—åˆ°ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚å¦‚æœå­˜åœ¨LookupOverrideå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç±»ä¸­å­˜åœ¨@Lookupæ³¨è§£äº†çš„æ–¹æ³•ï¼Œé‚£å°±ä¼šç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ â€‹</p><p>@Lookupæ³¨è§£å°±æ˜¯<strong>æ–¹æ³•æ³¨å…¥</strong>ï¼Œä½¿ç”¨demoå¦‚ä¸‹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

 <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">OrderService</span> orderService <span class="token operator">=</span> <span class="token function">createOrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>orderService<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Lookup</span><span class="token punctuation">(</span><span class="token string">&quot;orderService&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">OrderService</span> <span class="token function">createOrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="beandefinitionçš„åç½®å¤„ç†â¤ï¸" tabindex="-1"><a class="header-anchor" href="#beandefinitionçš„åç½®å¤„ç†â¤ï¸" aria-hidden="true">#</a> BeanDefinitionçš„åç½®å¤„ç†â¤ï¸</h2><p>Beanå¯¹è±¡å®ä¾‹åŒ–å‡ºæ¥ä¹‹åï¼Œæ¥ä¸‹æ¥å°±åº”è¯¥ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼äº†ã€‚åœ¨çœŸæ­£ç»™å±æ€§èµ‹å€¼ä¹‹å‰ï¼ŒSpringåˆæä¾›äº†ä¸€ä¸ªæ‰©å±•ç‚¹<strong>MergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition()</strong>ï¼Œå¯ä»¥å¯¹æ­¤æ—¶çš„BeanDefinitionè¿›è¡ŒåŠ å·¥ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuMergedBeanDefinitionPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">MergedBeanDefinitionPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessMergedBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanType<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beanDefinition<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;orderService&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>åœ¨Springæºç ä¸­ï¼ŒAutowiredAnnotationBeanPostProcessorå°±æ˜¯ä¸€ä¸ªMergedBeanDefinitionPostProcessorï¼Œå®ƒçš„postProcessMergedBeanDefinition()ä¸­ä¼šå»æŸ¥æ‰¾æ³¨å…¥ç‚¹ï¼Œå¹¶ç¼“å­˜åœ¨AutowiredAnnotationBeanPostProcessorå¯¹è±¡çš„ä¸€ä¸ªMapä¸­ï¼ˆinjectionMetadataCacheï¼‰ã€‚</p><h2 id="å®ä¾‹åŒ–å" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹åŒ–å" aria-hidden="true">#</a> å®ä¾‹åŒ–å</h2><p>åœ¨å¤„ç†å®ŒBeanDefinitionåï¼ŒSpringåˆè®¾è®¡äº†ä¸€ä¸ªæ‰©å±•ç‚¹ï¼š<strong>InstantiationAwareBeanPostProcessor.postProcessAfterInstantiation()</strong>ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuInstantiationAwareBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">postProcessAfterInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> bean<span class="token punctuation">;</span>
            userService<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä¸Šè¿°ä»£ç å°±æ˜¯å¯¹userServiceæ‰€å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ â€‹è¿™ä¸ªæ‰©å±•ç‚¹ï¼Œåœ¨Springæºç ä¸­åŸºæœ¬æ²¡æœ‰æ€ä¹ˆä½¿ç”¨ã€‚</p><h2 id="è‡ªåŠ¨æ³¨å…¥" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨æ³¨å…¥" aria-hidden="true">#</a> è‡ªåŠ¨æ³¨å…¥</h2><p>è¿™é‡Œçš„è‡ªåŠ¨æ³¨å…¥æŒ‡çš„æ˜¯Springçš„è‡ªåŠ¨æ³¨å…¥</p><h2 id="å¤„ç†å±æ€§" tabindex="-1"><a class="header-anchor" href="#å¤„ç†å±æ€§" aria-hidden="true">#</a> å¤„ç†å±æ€§</h2><p>è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œå°±ä¼šå¤„ç†@Autowiredã€@Resourceã€@Valueç­‰æ³¨è§£ï¼Œä¹Ÿæ˜¯é€šè¿‡**InstantiationAwareBeanPostProcessor.postProcessProperties()**æ‰©å±•ç‚¹æ¥å®ç°çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å®ç°ä¸€ä¸ªè‡ªå·±çš„è‡ªåŠ¨æ³¨å…¥åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuInstantiationAwareBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PropertyValues</span> <span class="token function">postProcessProperties</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">ZhouyuInject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> pvs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="æ‰§è¡Œaware" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œaware" aria-hidden="true">#</a> æ‰§è¡ŒAware</h2><p>å®Œæˆäº†å±æ€§èµ‹å€¼ä¹‹åï¼ŒSpringä¼šæ‰§è¡Œä¸€äº›å›è°ƒï¼ŒåŒ…æ‹¬ï¼š</p><ol><li>BeanNameAwareï¼šå›ä¼ beanNameç»™beanå¯¹è±¡ã€‚</li><li>BeanClassLoaderAwareï¼šå›ä¼ classLoaderç»™beanå¯¹è±¡ã€‚</li><li>BeanFactoryAwareï¼šå›ä¼ beanFactoryç»™å¯¹è±¡ã€‚</li></ol><h2 id="åˆå§‹åŒ–å‰" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–å‰" aria-hidden="true">#</a> åˆå§‹åŒ–å‰</h2><p>åˆå§‹åŒ–å‰ï¼Œä¹Ÿæ˜¯Springæä¾›çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼š<strong>BeanPostProcessor.postProcessBeforeInitialization()</strong>ï¼Œæ¯”å¦‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå§‹åŒ–å‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>åˆ©ç”¨åˆå§‹åŒ–å‰ï¼Œå¯ä»¥å¯¹è¿›è¡Œäº†ä¾èµ–æ³¨å…¥çš„Beanè¿›è¡Œå¤„ç†ã€‚ â€‹</p><p>åœ¨Springæºç ä¸­ï¼š</p><ol><li>InitDestroyAnnotationBeanPostProcessorä¼šåœ¨åˆå§‹åŒ–å‰è¿™ä¸ªæ­¥éª¤ä¸­æ‰§è¡Œ@PostConstructçš„æ–¹æ³•ï¼Œ</li><li>ApplicationContextAwareProcessorä¼šåœ¨åˆå§‹åŒ–å‰è¿™ä¸ªæ­¥éª¤ä¸­è¿›è¡Œå…¶ä»–Awareçš„å›è°ƒï¼š <ol><li>EnvironmentAwareï¼šå›ä¼ ç¯å¢ƒå˜é‡</li><li>EmbeddedValueResolverAwareï¼šå›ä¼ å ä½ç¬¦è§£æå™¨</li><li>ResourceLoaderAwareï¼šå›ä¼ èµ„æºåŠ è½½å™¨</li><li>ApplicationEventPublisherAwareï¼šå›ä¼ äº‹ä»¶å‘å¸ƒå™¨</li><li>MessageSourceAwareï¼šå›ä¼ å›½é™…åŒ–èµ„æº</li><li>ApplicationStartupAwareï¼šå›ä¼ åº”ç”¨å…¶ä»–ç›‘å¬å¯¹è±¡ï¼Œå¯å¿½ç•¥</li><li>ApplicationContextAwareï¼šå›ä¼ Springå®¹å™¨ApplicationContext</li></ol></li></ol><h2 id="åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–" aria-hidden="true">#</a> åˆå§‹åŒ–</h2><ol><li>æŸ¥çœ‹å½“å‰Beanå¯¹è±¡æ˜¯å¦å®ç°äº†InitializingBeanæ¥å£ï¼Œå¦‚æœå®ç°äº†å°±è°ƒç”¨å…¶afterPropertiesSet()æ–¹æ³•</li><li>æ‰§è¡ŒBeanDefinitionä¸­æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•</li></ol><h2 id="åˆå§‹åŒ–å" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–å" aria-hidden="true">#</a> åˆå§‹åŒ–å</h2><p>è¿™æ˜¯Beanåˆ›å»ºç”Ÿå‘½å‘¨æœŸä¸­çš„æœ€åä¸€ä¸ªæ­¥éª¤ï¼Œä¹Ÿæ˜¯Springæä¾›çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼š<strong>BeanPostProcessor.postProcessAfterInitialization()</strong>ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhouyuBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå§‹åŒ–å&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å¯ä»¥åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œå¯¹Beanæœ€ç»ˆè¿›è¡Œå¤„ç†ï¼ŒSpringä¸­çš„<strong>AOPå°±æ˜¯åŸºäºåˆå§‹åŒ–åå®ç°</strong>çš„ï¼Œ<strong>åˆå§‹åŒ–åè¿”å›çš„å¯¹è±¡æ‰æ˜¯æœ€ç»ˆçš„Beanå¯¹è±¡</strong>ã€‚</p><h2 id="beançš„é”€æ¯è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#beançš„é”€æ¯è¿‡ç¨‹" aria-hidden="true">#</a> Beançš„é”€æ¯è¿‡ç¨‹</h2><p>Beané”€æ¯æ˜¯å‘é€åœ¨Springå®¹å™¨å…³é—­è¿‡ç¨‹ä¸­çš„ã€‚ â€‹åœ¨Springå®¹å™¨å…³é—­æ—¶ï¼Œæ¯”å¦‚ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userService<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®¹å™¨å…³é—­</span>
context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨Beanåˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œåœ¨æœ€åï¼ˆåˆå§‹åŒ–ä¹‹åï¼‰ï¼Œæœ‰ä¸€ä¸ªæ­¥éª¤ä¼šå»åˆ¤æ–­å½“å‰åˆ›å»ºçš„Beanæ˜¯ä¸æ˜¯DisposableBeanï¼š</p><ol><li>å½“å‰Beanæ˜¯å¦å®ç°äº†DisposableBeanæ¥å£</li><li>æˆ–è€…ï¼Œå½“å‰Beanæ˜¯å¦å®ç°äº†AutoCloseableæ¥å£</li><li>BeanDefinitionä¸­æ˜¯å¦æŒ‡å®šäº†destroyMethod</li><li>è°ƒç”¨DestructionAwareBeanPostProcessor.requiresDestruction(bean)è¿›è¡Œåˆ¤æ–­ <ol><li>ApplicationListenerDetectorä¸­ç›´æ¥ä½¿å¾—ApplicationListeneræ˜¯DisposableBean</li><li>InitDestroyAnnotationBeanPostProcessorä¸­ä½¿å¾—æ‹¥æœ‰@PreDestroyæ³¨è§£äº†çš„æ–¹æ³•å°±æ˜¯DisposableBean</li></ol></li><li>æŠŠç¬¦åˆä¸Šè¿°ä»»æ„ä¸€ä¸ªæ¡ä»¶çš„Beané€‚é…æˆDisposableBeanAdapterå¯¹è±¡ï¼Œå¹¶å­˜å…¥disposableBeansä¸­ï¼ˆä¸€ä¸ªLinkedHashMapï¼‰</li></ol><p>åœ¨Springå®¹å™¨å…³é—­è¿‡ç¨‹æ—¶ï¼š</p><ol><li>é¦–å…ˆå‘å¸ƒContextClosedEventäº‹ä»¶</li><li>è°ƒç”¨lifecycleProcessorçš„onCloese()æ–¹æ³•</li><li>é”€æ¯å•ä¾‹Bean <ol><li>éå†disposableBeans <ol><li>æŠŠæ¯ä¸ªdisposableBeanä»å•ä¾‹æ± ä¸­ç§»é™¤</li><li>è°ƒç”¨disposableBeançš„destroy()</li><li>å¦‚æœè¿™ä¸ªdisposableBeanè¿˜è¢«å…¶ä»–Beanä¾èµ–äº†ï¼Œé‚£ä¹ˆä¹Ÿå¾—é”€æ¯å…¶ä»–Bean</li><li>å¦‚æœè¿™ä¸ªdisposableBeanè¿˜åŒ…å«äº†inner beansï¼Œå°†è¿™äº›Beanä»å•ä¾‹æ± ä¸­ç§»é™¤æ‰ (inner beanå‚è€ƒhttps://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-inner-beans)</li></ol></li><li>æ¸…ç©ºmanualSingletonNamesï¼Œæ˜¯ä¸€ä¸ªSetï¼Œå­˜çš„æ˜¯ç”¨æˆ·æ‰‹åŠ¨æ³¨å†Œçš„å•ä¾‹Beançš„beanName</li><li>æ¸…ç©ºallBeanNamesByTypeï¼Œæ˜¯ä¸€ä¸ªMapï¼Œkeyæ˜¯beanç±»å‹ï¼Œvalueæ˜¯è¯¥ç±»å‹æ‰€æœ‰çš„beanNameæ•°ç»„</li><li>æ¸…ç©ºsingletonBeanNamesByTypeï¼Œå’ŒallBeanNamesByTypeç±»ä¼¼ï¼Œåªä¸è¿‡åªå­˜äº†å•ä¾‹Bean</li></ol></li></ol><h3 id="è®¾è®¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡æ¨¡å¼" aria-hidden="true">#</a> è®¾è®¡æ¨¡å¼</h3><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼š<strong>é€‚é…å™¨æ¨¡å¼</strong></p><p>åœ¨é”€æ¯æ—¶ï¼ŒSpringä¼šæ‰¾å‡ºå®ç°äº†DisposableBeanæ¥å£çš„Beanã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬åœ¨å®šä¹‰ä¸€ä¸ªBeanæ—¶ï¼Œå¦‚æœè¿™ä¸ªBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œæˆ–è€…å®ç°äº†AutoCloseableæ¥å£ï¼Œæˆ–è€…åœ¨BeanDefinitionä¸­æŒ‡å®šäº†destroyMethodNameï¼Œé‚£ä¹ˆè¿™ä¸ªBeanéƒ½å±äºâ€œDisposableBeanâ€ï¼Œè¿™äº›Beanåœ¨å®¹å™¨å…³é—­æ—¶éƒ½è¦è°ƒç”¨ç›¸åº”çš„é”€æ¯æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œå°±éœ€è¦è¿›è¡Œé€‚é…ï¼Œå°†å®ç°äº†DisposableBeanæ¥å£ã€æˆ–è€…AutoCloseableæ¥å£ç­‰é€‚é…æˆå®ç°äº†DisposableBeanæ¥å£ï¼Œæ‰€ä»¥å°±ç”¨åˆ°äº†DisposableBeanAdapterã€‚</p><p>ä¼šæŠŠå®ç°äº†AutoCloseableæ¥å£çš„ç±»å°è£…æˆDisposableBeanAdapterï¼Œè€ŒDisposableBeanAdapterå®ç°äº†DisposableBeanæ¥å£ã€‚</p><h3 id="springbootä¸­çš„contextå…³é—­" tabindex="-1"><a class="header-anchor" href="#springbootä¸­çš„contextå…³é—­" aria-hidden="true">#</a> SpringBootä¸­çš„contextå…³é—­</h3><p>ApplicationContextç»“æŸæ—¶ä¼šè¿è¡Œä¸€ä¸ªé’©å­æ–¹æ³•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">SpringApplicationShutdownHook</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">addRuntimeShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;SpringApplicationShutdownHook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> â† <a href="/spring/" class="nav-link router-link-active" aria-label="Back To ç›®å½•"><!--[--><!--]--> Back To ç›®å½• <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
