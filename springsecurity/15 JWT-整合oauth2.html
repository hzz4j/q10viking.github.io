<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>é™é»˜ã®Blog</title><meta name="description" content="é™é»˜çš„Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">é™é»˜ã®Blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#jwt-json-web-token" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="jwt(Json web token)"><!--[--><!--]--> jwt(Json web token) <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#payload" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="payload"><!--[--><!--]--> payload <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#jjwt" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="JJWT"><!--[--><!--]--> JJWT <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æµ‹è¯•"><!--[--><!--]--> æµ‹è¯• <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#tokenè§£æ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="tokenè§£æ"><!--[--><!--]--> tokenè§£æ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#tokenè¿‡æœŸæ ¡éªŒ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="tokenè¿‡æœŸæ ¡éªŒ"><!--[--><!--]--> tokenè¿‡æœŸæ ¡éªŒ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#spring-security-oauth2æ•´åˆjwt" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Spring security oauth2æ•´åˆjwt"><!--[--><!--]--> Spring security oauth2æ•´åˆjwt <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#ä¾èµ–" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¾èµ–"><!--[--><!--]--> ä¾èµ– <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#æ·»åŠ é…ç½®æ–‡ä»¶jwttokenenhancerconfig-java" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æ·»åŠ é…ç½®æ–‡ä»¶JwtTokenEnhancerConfig.java"><!--[--><!--]--> æ·»åŠ é…ç½®æ–‡ä»¶JwtTokenEnhancerConfig.java <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity/15%20JWT-%E6%95%B4%E5%90%88oauth2.html#æµ‹è¯•-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æµ‹è¯•"><!--[--><!--]--> æµ‹è¯• <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="jwt-json-web-token" tabindex="-1"><a class="header-anchor" href="#jwt-json-web-token" aria-hidden="true">#</a> jwt(Json web token)</h2><ul><li>OAuth 2.0æ˜¯å½“å‰ä¸šç•Œæ ‡å‡†çš„æˆæƒåè®®ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯è‹¥å¹²ä¸ªé’ˆå¯¹ä¸åŒåœºæ™¯çš„ä»¤ç‰Œé¢å‘å’Œç®¡ç†æµç¨‹ï¼›</li><li>JWTæ˜¯ä¸€ç§è½»é‡çº§ã€è‡ªåŒ…å«çš„ä»¤ç‰Œï¼Œå¯ç”¨äºåœ¨å¾®æœåŠ¡é—´å®‰å…¨åœ°ä¼ é€’ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><h3 id="payload" tabindex="-1"><a class="header-anchor" href="#payload" aria-hidden="true">#</a> payload</h3><p>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ï¼ˆå»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨ï¼‰</p><ul><li><strong>iss</strong>: jwtç­¾å‘è€…</li><li><strong>sub</strong>: jwtæ‰€é¢å‘çš„ç”¨æˆ·</li><li><strong>aud</strong>: æ¥æ”¶jwtçš„ä¸€æ–¹</li><li><strong>exp</strong>: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´</li><li><strong>nbf</strong>: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</li><li><strong>iat</strong>: jwtçš„ç­¾å‘æ—¶é—´</li><li><strong>jti</strong>: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</li></ul><h2 id="jjwt" tabindex="-1"><a class="header-anchor" href="#jjwt" aria-hidden="true">#</a> JJWT</h2><p>JJWTæ˜¯ä¸€ä¸ªæä¾›ç«¯åˆ°ç«¯çš„JWTåˆ›å»ºå’ŒéªŒè¯çš„Javaåº“</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--JWTä¾èµ–--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a> æµ‹è¯•</h3><blockquote><p>èƒ½å¤Ÿç”Ÿæˆtoken,å¹¶èƒ½è§£ætoken</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtdemoApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SECRETKEY</span> <span class="token operator">=</span> <span class="token string">&quot;123123&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> jwtBuilder <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//å£°æ˜çš„æ ‡è¯†{&quot;jti&quot;:&quot;666&quot;}</span>
                <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;666&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//ä¸»ä½“ï¼Œç”¨æˆ·{&quot;sub&quot;:&quot;hzz&quot;}</span>
                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;hzz&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//åˆ›å»ºæ—¥æœŸ{&quot;ita&quot;:&quot;xxxxxx&quot;}</span>
                <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">//è®¾ç½®è¿‡æœŸæ—¶é—´   1åˆ†é’Ÿ</span>
                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">//ç›´æ¥ä¼ å…¥map</span>
                <span class="token comment">// .addClaims(map)</span>
                <span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token string">&quot;roles&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token string">&quot;logo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xxx.jpg&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//ç­¾åæ‰‹æ®µï¼Œå‚æ•°1ï¼šç®—æ³•ï¼Œå‚æ•°2ï¼šç›</span>
                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">HS256</span><span class="token punctuation">,</span> <span class="token constant">SECRETKEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> token <span class="token operator">=</span> jwtBuilder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ä¸‰éƒ¨åˆ†çš„base64è§£å¯†</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Base64Codec</span><span class="token punctuation">.</span><span class="token constant">BASE64</span><span class="token punctuation">.</span><span class="token function">decodeToString</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Base64Codec</span><span class="token punctuation">.</span><span class="token constant">BASE64</span><span class="token punctuation">.</span><span class="token function">decodeToString</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ— æ³•è§£å¯†</span>
<span class="token comment">//        System.out.println(Base64Codec.BASE64.decodeToString(split[2]));</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI2NjYiLCJzdWIiOiJoenoiLCJpYXQiOjE2Nzg4NTI0MzYsImV4cCI6MTY3ODg1MjQ5Niwicm9sZXMiOiJhZG1pbiIsImxvZ28iOiJ4eHguanBnIn0.LmGgOqi71YyhekY9pgbN1S3xCoeTNAI5jX3J0lwfXG8
 * =========
 * <span class="token punctuation">{</span>&quot;alg&quot;:&quot;HS256&quot;<span class="token punctuation">}</span>
 * <span class="token punctuation">{</span>&quot;jti&quot;:&quot;666&quot;,&quot;sub&quot;:&quot;hzz&quot;,&quot;iat&quot;:1678852436,&quot;exp&quot;:1678852496,&quot;roles&quot;:&quot;admin&quot;,&quot;logo&quot;:&quot;xxx.jpg
 */</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="tokenè§£æ" tabindex="-1"><a class="header-anchor" href="#tokenè§£æ" aria-hidden="true">#</a> tokenè§£æ</h2><p>åœ¨webåº”ç”¨ä¸­ç”±æœåŠ¡ç«¯åˆ›å»ºäº†tokenç„¶åå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨ä¸‹æ¬¡å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶éœ€è¦æºå¸¦è¿™ä¸ªtokenï¼ˆè¿™å°±å¥½åƒæ˜¯æ‹¿ç€ä¸€å¼ é—¨ç¥¨ä¸€æ ·ï¼‰ï¼Œé‚£æœåŠ¡ç«¯æ¥åˆ°è¿™ä¸ªtokenåº”è¯¥è§£æå‡ºtokenä¸­çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ç”¨æˆ·idï¼‰,æ ¹æ®è¿™äº›ä¿¡æ¯æŸ¥è¯¢æ•°æ®åº“è¿”å›ç›¸åº”çš„ç»“æœã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testParseToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI2NjYiLCJzdWIiOiJoenoiLCJpYXQiOjE2Nzg4NjMxNzQsImV4cCI6MTY3ODg2MzIzNCwicm9sZXMiOiJhZG1pbiIsImxvZ28iOiJ4eHguanBnIn0.vgpt0JT9R3cioTCH5bjRrhJgOff28kKooChZrRKLGOo&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span><span class="token constant">SECRETKEY</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;id:&quot;</span><span class="token operator">+</span>claims<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;subject:&quot;</span><span class="token operator">+</span>claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;issuedAt:&quot;</span><span class="token operator">+</span>claims<span class="token punctuation">.</span><span class="token function">getIssuedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">DateFormat</span> sf <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­¾å‘æ—¶é—´:&quot;</span><span class="token operator">+</span>sf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>claims<span class="token punctuation">.</span><span class="token function">getIssuedAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿‡æœŸæ—¶é—´:&quot;</span><span class="token operator">+</span>sf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>claims<span class="token punctuation">.</span><span class="token function">getExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ—¶é—´:&quot;</span><span class="token operator">+</span>sf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;roles:&quot;</span><span class="token operator">+</span>claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;roles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;logo:&quot;</span><span class="token operator">+</span>claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;logo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * id:666
     * subject:hzz
     * issuedAt:Wed Mar 15 14:52:54 GMT+08:00 2023
     * ç­¾å‘æ—¶é—´:2023-03-15 14:52:54
     * è¿‡æœŸæ—¶é—´:2023-03-15 14:53:54
     * å½“å‰æ—¶é—´:2023-03-15 14:53:37
     * roles:admin
     * logo:xxx.jpg
     */</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="tokenè¿‡æœŸæ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#tokenè¿‡æœŸæ ¡éªŒ" aria-hidden="true">#</a> tokenè¿‡æœŸæ ¡éªŒ</h2><p>ä¸å¸Œæœ›ç­¾å‘çš„tokenæ˜¯æ°¸ä¹…ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºtokenæ·»åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚åŸå› ï¼šä»æœåŠ¡å™¨å‘å‡ºçš„tokenï¼ŒæœåŠ¡å™¨è‡ªå·±å¹¶ä¸åšè®°å½•ï¼Œå°±å­˜åœ¨ä¸€ä¸ªå¼Šç«¯ï¼šæœåŠ¡ç«¯æ— æ³•ä¸»åŠ¨æ§åˆ¶æŸä¸ªtokençš„ç«‹åˆ»å¤±æ•ˆã€‚</p><p>å½“æœªè¿‡æœŸæ—¶å¯ä»¥æ­£å¸¸è¯»å–ï¼Œå½“è¿‡æœŸæ—¶ä¼šå¼•å‘io.jsonwebtoken.ExpiredJwtExceptionå¼‚å¸¸</p><p><img src="/images/springsecurity/image-20230315145914569.png" alt="image-20230315145914569"></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>io.jsonwebtoken.ExpiredJwtException: JWT expired at <span class="token number">2023</span>-03-15T14:53:54Z. Current time: <span class="token number">2023</span>-03-15T14:57:21Z, a difference of <span class="token number">207417</span> milliseconds.  Allowed clock skew: <span class="token number">0</span> milliseconds.
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="spring-security-oauth2æ•´åˆjwt" tabindex="-1"><a class="header-anchor" href="#spring-security-oauth2æ•´åˆjwt" aria-hidden="true">#</a> Spring security oauth2æ•´åˆjwt</h2><p><a href="https://github.com/Q10Viking/springcloudalibaba/tree/main/jwt/jwt-basic" target="_blank" rel="noopener noreferrer">Source Code<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h3 id="ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–" aria-hidden="true">#</a> ä¾èµ–</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="æ·»åŠ é…ç½®æ–‡ä»¶jwttokenenhancerconfig-java" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ é…ç½®æ–‡ä»¶jwttokenenhancerconfig-java" aria-hidden="true">#</a> æ·»åŠ é…ç½®æ–‡ä»¶JwtTokenEnhancerConfig.java</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtTokenEnhancerConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">jwtTokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtTokenStore</span><span class="token punctuation">(</span><span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JwtAccessTokenConverter</span> <span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">JwtAccessTokenConverter</span> accessTokenConverter <span class="token operator">=</span> <span class="token keyword">new</span>
                <span class="token class-name">JwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é…ç½®JWTä½¿ç”¨çš„ç§˜é’¥</span>
        accessTokenConverter<span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span><span class="token string">&quot;123123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> accessTokenConverter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>åœ¨æˆæƒæœåŠ¡å™¨é…ç½®ä¸­æŒ‡å®šä»¤ç‰Œçš„å­˜å‚¨ç­–ç•¥ä¸ºJWT</p><p><img src="/images/springsecurity/56876" alt="https://note.youdao.com/yws/public/resource/91c79470710860cce7e3c8dcf444d0e3/xmlnote/84FA56CB45DB41F39C0A0537C041D7B7/56876"></p><h2 id="æµ‹è¯•-1" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•-1" aria-hidden="true">#</a> æµ‹è¯•</h2><p>ä½¿ç”¨å¯†ç æ¨¡å¼è·å–æˆæƒtoken</p><p><a href="http://localhost:8080/oauth/token?username=hzz&amp;password=Root.123456&amp;grant_type=password&amp;client_id=client&amp;client_secret=123123&amp;scope=all" target="_blank" rel="noopener noreferrer">localhost:8080/oauth/token?username=hzz&amp;password=Root.123456&amp;grant_type=password&amp;client_id=client&amp;client_secret=123123&amp;scope=all<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><img src="/images/springsecurity/image-20230315161615974.png" alt="image-20230315161615974"></p><p>å‘ç°è·å–åˆ°çš„ä»¤ç‰Œå·²ç»å˜æˆäº†JWTä»¤ç‰Œï¼Œå°†access_tokenæ‹¿åˆ°https://jwt.io/ ç½‘ç«™ä¸Šå»è§£æä¸‹å¯ä»¥è·å¾—å…¶ä¸­å†…å®¹</p><p><img src="/images/springsecurity/image-20230315161710643.png" alt="image-20230315161710643"></p><p><strong>æ‰©å±•JWTä¸­çš„å­˜å‚¨å†…å®¹</strong></p><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ‰©å±•JWTä¸­å­˜å‚¨çš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨JWTä¸­æ‰©å±•ä¸€ä¸ª keyä¸ºenhanceï¼Œvalueä¸ºenhance info çš„æ•°æ®ã€‚ ç»§æ‰¿TokenEnhancerå®ç°ä¸€ä¸ªJWTå†…å®¹å¢å¼ºå™¨</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtTokenEnhancer</span> <span class="token keyword">implements</span> <span class="token class-name">TokenEnhancer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OAuth2AccessToken</span> <span class="token function">enhance</span><span class="token punctuation">(</span><span class="token class-name">OAuth2AccessToken</span> accessToken<span class="token punctuation">,</span> <span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;enhancer&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;enhancer-info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultOAuth2AccessToken</span><span class="token punctuation">)</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAdditionalInformation</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> accessToken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å‘èµ„æºæœåŠ¡å™¨è¯·æ±‚èµ„æº</p><p><img src="/images/springsecurity/image-20230315162005375.png" alt="image-20230315162005375"></p><p><img src="/images/springsecurity/image-20230315162031737.png" alt="image-20230315162031737"></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;enhancer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;enhancer-info&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hzz&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;all&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1678871304</span><span class="token punctuation">,</span>
	<span class="token property">&quot;authorities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;admin&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;34cac767-4e3b-474e-a19a-bf7cfc9b82d7&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;client_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;client&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> â† <a href="/springsecurity/" class="nav-link router-link-active" aria-label="Back To ç›®å½•"><!--[--><!--]--> Back To ç›®å½• <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
