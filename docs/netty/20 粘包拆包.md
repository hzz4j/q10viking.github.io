---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To ç›®å½•
  link: /netty/
typora-root-url: ..\.vuepress\public
---



## **ä»€ä¹ˆæ˜¯TCPç²˜åŒ…åŠåŒ…**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE4FCB9257726549F6B0D2D8C565EACA30/10116](/images/netty/10116.png)

å‡è®¾å®¢æˆ·ç«¯åˆ†åˆ«å‘é€äº†ä¸¤ä¸ªæ•°æ®åŒ…D1å’ŒD2ç»™æœåŠ¡ç«¯ï¼Œç”±äºæœåŠ¡ç«¯ä¸€æ¬¡è¯»å–åˆ°çš„å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ•…å¯èƒ½å­˜åœ¨ä»¥ä¸‹4ç§æƒ…å†µã€‚

1. æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œåˆ†åˆ«æ˜¯D1å’ŒD2ï¼Œæ²¡æœ‰ç²˜åŒ…å’Œæ‹†åŒ…ï¼›

2. æœåŠ¡ç«¯ä¸€æ¬¡æ¥æ”¶åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼ŒD1å’ŒD2ç²˜åˆåœ¨ä¸€èµ·ï¼Œè¢«ç§°ä¸ºTCPç²˜åŒ…ï¼›

3. æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†å®Œæ•´çš„D1åŒ…å’ŒD2åŒ…çš„éƒ¨åˆ†å†…å®¹ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D2åŒ…çš„å‰©ä½™å†…å®¹ï¼Œè¿™è¢«ç§°ä¸ºTCPæ‹†åŒ…ï¼›

4. æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†D1åŒ…çš„éƒ¨åˆ†å†…å®¹D1_1ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D1åŒ…çš„å‰©ä½™å†…å®¹D1_2å’ŒD2åŒ…çš„æ•´åŒ…ã€‚

å¦‚æœæ­¤æ—¶æœåŠ¡ç«¯TCPæ¥æ”¶æ»‘çª—éå¸¸å°ï¼Œè€Œæ•°æ®åŒ…D1å’ŒD2æ¯”è¾ƒå¤§ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‘ç”Ÿç¬¬äº”ç§å¯èƒ½ï¼Œå³æœåŠ¡ç«¯åˆ†å¤šæ¬¡æ‰èƒ½å°†D1å’ŒD2åŒ…æ¥æ”¶å®Œå…¨ï¼ŒæœŸé—´å‘ç”Ÿå¤šæ¬¡æ‹†åŒ…ã€‚



## **TCPç²˜åŒ…/åŠåŒ…å‘ç”Ÿçš„åŸå› **

### ç²˜åŒ…

> å®¢æˆ·ç«¯å‘é€

ç”±äºTCPåè®®æœ¬èº«çš„æœºåˆ¶ï¼ˆé¢å‘è¿æ¥çš„å¯é åœ°åè®®-ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶ï¼‰å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¼šç»´æŒä¸€ä¸ªè¿æ¥ï¼ˆChannelï¼‰ï¼Œæ•°æ®åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒç»­ä¸æ–­åœ°å°†å¤šä¸ªæ•°æ®åŒ…å‘å¾€æœåŠ¡å™¨ï¼Œä½†æ˜¯å¦‚æœå‘é€çš„ç½‘ç»œæ•°æ®åŒ…å¤ªå°ï¼Œé‚£ä¹ˆä»–æœ¬èº«ä¼šå¯ç”¨Nagleç®—æ³•ï¼ˆå¯é…ç½®æ˜¯å¦å¯ç”¨ï¼‰å¯¹è¾ƒå°çš„æ•°æ®åŒ…è¿›è¡Œåˆå¹¶ï¼ˆåŸºäºæ­¤ï¼ŒTCPçš„ç½‘ç»œå»¶è¿Ÿè¦UDPçš„é«˜äº›ï¼‰ç„¶åå†å‘é€ï¼ˆè¶…æ—¶æˆ–è€…åŒ…å¤§å°è¶³å¤Ÿï¼‰ã€‚é‚£ä¹ˆè¿™æ ·çš„è¯ï¼ŒæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯ï¼ˆæ•°æ®æµï¼‰çš„æ—¶å€™å°±æ— æ³•åŒºåˆ†å“ªäº›æ•°æ®åŒ…æ˜¯å®¢æˆ·ç«¯è‡ªå·±åˆ†å¼€å‘é€çš„ï¼Œè¿™æ ·äº§ç”Ÿäº†ç²˜åŒ…ï¼›

> æœåŠ¡ç«¯æ¥æ”¶

æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°æ•°æ®åº“åï¼Œæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰è¢«åŠæ—¶ä»ç¼“å­˜åŒºå–èµ°ï¼Œä¸‹æ¬¡åœ¨å–æ•°æ®çš„æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°ä¸€æ¬¡å–å‡ºå¤šä¸ªæ•°æ®åŒ…çš„æƒ…å†µï¼Œé€ æˆç²˜åŒ…ç°è±¡



> UDP

æœ¬èº«ä½œä¸ºæ— è¿æ¥çš„ä¸å¯é çš„ä¼ è¾“åè®®ï¼ˆé€‚åˆé¢‘ç¹å‘é€è¾ƒå°çš„æ•°æ®åŒ…ï¼‰ï¼Œä»–ä¸ä¼šå¯¹æ•°æ®åŒ…è¿›è¡Œåˆå¹¶å‘é€ï¼ˆä¹Ÿå°±æ²¡æœ‰Nagleç®—æ³•ä¹‹è¯´äº†ï¼‰ï¼Œä»–ç›´æ¥æ˜¯ä¸€ç«¯å‘é€ä»€ä¹ˆæ•°æ®ï¼Œç›´æ¥å°±å‘å‡ºå»äº†ï¼Œæ—¢ç„¶ä»–ä¸ä¼šå¯¹æ•°æ®åˆå¹¶ï¼Œæ¯ä¸€ä¸ªæ•°æ®åŒ…éƒ½æ˜¯å®Œæ•´çš„ï¼ˆæ•°æ®+UDPå¤´+IPå¤´ç­‰ç­‰å‘ä¸€æ¬¡æ•°æ®å°è£…ä¸€æ¬¡ï¼‰ä¹Ÿå°±æ²¡æœ‰ç²˜åŒ…ä¸€è¯´äº†ã€‚



### åŠåŒ…(æ‹†åŒ…)

> å°±æ˜¯ä¸€ä¸ªæ•°æ®åŒ…è¢«åˆ†æˆäº†å¤šæ¬¡æ¥æ”¶

åº”ç”¨ç¨‹åºå†™å…¥æ•°æ®çš„å­—èŠ‚å¤§å°å¤§äºå¥—æ¥å­—å‘é€ç¼“å†²åŒºçš„å¤§å°



## ä»£ç æ¼”ç¤ºæ‹†åŒ…ä¸åŠåŒ…

[Source Code](https://github.com/Q10Viking/learncode/tree/main/Netty/niebao/niebao/src/main/java/org/hzz/demo)

å®¢æˆ·ç«¯å‘é€ä¸‹é¢çš„æ¶ˆæ¯100æ¡

```sh
Java,Golang,Python,Javascript,C++
```

åœ¨æœåŠ¡ç«¯æ¥æ”¶çš„æ—¶å€™ï¼Œéƒ½ç²˜è´´åœ¨äº†ä¸€èµ·

```sh
Server Accept[Java,Golang,Python,Javascript,C++   # è¢«ç²˜åŒ…äº†
Java,Golang,Python,Javascript,C++
Java,Golang,Python,Javascript,C++
Java,Golang,Python,Javascript,C++
Java,Golang,Python,Javascript,C++
Java,Gola] and the counter is:1    # è¿™æ¡æ•°æ®å·²ç»è¢«æ‹†åŒ…äº†
```

æœåŠ¡ç«¯æ­£ç¡®çš„å¤„ç†ç»“æœ,è¿™é‡ŒæœåŠ¡ç«¯æ·»åŠ äº†`LineBasedFrameDecoder`ä¸“é—¨æ¥å¤„ç†æ•°æ®ä»¥`\r\n` ç»“å°¾çš„æ•°æ®

```sh
Server Accept[Java,Golang,Python,Javascript,C++] and the counter is:97
Server Accept[Java,Golang,Python,Javascript,C++] and the counter is:98
Server Accept[Java,Golang,Python,Javascript,C++] and the counter is:99
Server Accept[Java,Golang,Python,Javascript,C++] and the counter is:100
```



### åŸç†

[ç²˜åŒ…åŠåŒ…| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾](https://www.processon.com/view/link/6438f08196a2d95a1006f242)

<common-progresson-snippet src="https://www.processon.com/view/link/6438f08196a2d95a1006f242"/>

![ç²˜åŒ…åŠåŒ…](/images/netty/ç²˜åŒ…åŠåŒ….png)



## **è§£å†³ç²˜åŒ…åŠåŒ…**ğŸ˜˜

ç”±äºåº•å±‚çš„TCPæ— æ³•ç†è§£ä¸Šå±‚çš„ä¸šåŠ¡æ•°æ®ï¼Œæ‰€ä»¥åœ¨åº•å±‚æ˜¯æ— æ³•ä¿è¯æ•°æ®åŒ…ä¸è¢«æ‹†åˆ†å’Œé‡ç»„çš„ï¼Œè¿™ä¸ªé—®é¢˜åªèƒ½é€šè¿‡ä¸Šå±‚çš„åº”ç”¨åè®®æ ˆè®¾è®¡æ¥è§£å†³ã€‚**å…¶è§£ç çš„è¿‡ç¨‹å°±ç›¸å½“äºæ˜¯è§£æåº”ç”¨å±‚çš„åè®®**ã€‚



æ ¹æ®ä¸šç•Œçš„ä¸»æµåè®®çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å½’çº³å¦‚ä¸‹



### 1. åˆ†éš”ç¬¦

> 1. åœ¨åŒ…å°¾å¢åŠ åˆ†å‰²ç¬¦ï¼Œæ¯”å¦‚å›è½¦æ¢è¡Œç¬¦è¿›è¡Œåˆ†å‰²ï¼Œä¾‹å¦‚FTPåè®®

- ä¸Šé¢ä¾‹å­ä½¿ç”¨**LineBasedFrameDecoder** (nettyæä¾›çš„ç±»)æ¥å¤„ç†æ¢è¡Œåˆ†å‰²`\r\n`

  ```java
  ch.pipeline().addLast(new LineBasedFrameDecoder(1024));
  ```

- ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦`DelimiterBasedFrameDecoder` å¦‚è‡ªå®šä¹‰`@~`

```java
public static final String DELIMITER_SYMBOL = "@~";
ByteBuf delimiter = Unpooled.copiedBuffer(DELIMITER_SYMBOL.getBytes());
ch.pipeline().addLast(new DelimiterBasedFrameDecoder(1024,delimiter));
```



### 2. æ¶ˆæ¯å®šé•¿

> ä¾‹å¦‚æ¯ä¸ªæŠ¥æ–‡çš„å¤§å°ä¸ºå›ºå®šé•¿åº¦200å­—èŠ‚ï¼Œå¦‚æœä¸å¤Ÿï¼Œç©ºä½è¡¥ç©ºæ ¼ï¼›

```java
ch.pipeline().addLast(new FixedLengthFrameDecoder(200))
```



## 3.å°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“â¤ï¸

> æ¶ˆæ¯å¤´ä¸­åŒ…å«è¡¨ç¤ºæ¶ˆæ¯æ€»é•¿åº¦ï¼ˆæˆ–è€…æ¶ˆæ¯ä½“é•¿åº¦ï¼‰çš„å­—æ®µï¼Œé€šå¸¸è®¾è®¡æ€è·¯ä¸ºæ¶ˆæ¯å¤´çš„ç¬¬ä¸€ä¸ªå­—æ®µä½¿ç”¨int32æ¥è¡¨ç¤ºæ¶ˆæ¯çš„æ€»é•¿åº¦ï¼Œä½¿ç”¨LengthFieldBasedFrameDecoder

[Source Code](https://github.com/Q10Viking/learncode/tree/main/Netty/HelloWorld/src/main/java/org/hzz/msgpack)



### å­—èŠ‚å­˜å‚¨ç©ºé—´ä¸16è¿›åˆ¶çš„å…³ç³»

- å­—èŠ‚è¡¨ç¤ºå­˜å‚¨ç©ºé—´
- 16è¿›åˆ¶è¡¨ç¤ºå€¼

```sh
1000å­—èŠ‚(byte) = 8000æ¯”ç‰¹
1KB=1000B = 8000æ¯”ç‰¹

1B = 0000 0000   äºŒè¿›åˆ¶è¡¨ç¤º
2B = 0000 0000 0000 0000  äºŒè¿›åˆ¶è¡¨ç¤º
2B = 0x0000

2Bè¡¨ç¤ºå­˜å‚¨ç©ºé—´ï¼Œå®é™…å­˜å‚¨çš„å€¼ä¸ºbitè¡¨ç¤º
æ¯”å¦‚ä¸¤ä¸ªå­—èŠ‚çš„å¯ä»¥å­˜å‚¨çš„æ•°å­—æœ€å¤§æ˜¯: 655335åè¿›åˆ¶
1111 1111 1111 1111 äºŒè¿›åˆ¶
0xFFFF				16è¿›åˆ¶

ä¸€ä¸ªé•¿åº¦å æ®2Bç©ºé—´ï¼Œç›®å‰è¡¨ç¤ºçš„é•¿åº¦æ˜¯14
0x000C
```



### LengthFieldBasedFrameDecoderè¯¦è§£



> **æ•°æ®åŒ…å¤§å°: 14B = é•¿åº¦åŸŸ2B + "HELLO, WORLD"ï¼ˆå•è¯HELLO+ä¸€ä¸ªé€—å·+ä¸€ä¸ªç©ºæ ¼+å•è¯WORLDï¼‰**

![img](/images/netty/10127.png)

é•¿åº¦åŸŸçš„å€¼ä¸º12B(0x000c)ã€‚å¸Œæœ›è§£ç åä¿æŒä¸€æ ·ï¼Œæ ¹æ®ä¸Šé¢çš„å…¬å¼,å‚æ•°åº”è¯¥ä¸ºï¼š

1. lengthFieldOffset = 0
2. lengthFieldLength = 2
3. lengthAdjustment  æ— éœ€è°ƒæ•´
4. initialBytesToStrip = 0 - è§£ç è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¸¢å¼ƒä»»ä½•æ•°æ®



> **æ•°æ®åŒ…å¤§å°: 14B = é•¿åº¦åŸŸ2B + "HELLO, WORLD"**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE2D67B7B75DB24DB0B07D9800E83CC4BC/10128](/images/netty/10128.png)

é•¿åº¦åŸŸçš„å€¼ä¸º12B(0x000c)ã€‚è§£ç åï¼Œå¸Œæœ›ä¸¢å¼ƒé•¿åº¦åŸŸ2Bå­—æ®µï¼Œæ‰€ä»¥ï¼Œåªè¦initialBytesToStrip = 2å³å¯

1. lengthFieldOffset = 0
2. lengthFieldLength = 2
3. lengthAdjustment  æ— éœ€è°ƒæ•´
4. initialBytesToStrip = 2 è§£ç è¿‡ç¨‹ä¸­ï¼Œä¸¢å¼ƒ2ä¸ªå­—èŠ‚çš„æ•°æ®



> **æ•°æ®åŒ…å¤§å°: 14B = é•¿åº¦åŸŸ2B + "HELLO, WORLD"ã€‚é•¿åº¦åŸŸçš„å€¼ä¸º14(0x000E)**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE88B8AB34A2F7400ABD92464376128C98/10129](/images/netty/10129.png)

é•¿åº¦åŸŸçš„å€¼ä¸º14(0x000E)ï¼ŒåŒ…å«äº†é•¿åº¦åŸŸæœ¬èº«çš„é•¿åº¦ã€‚å¸Œæœ›è§£ç åä¿æŒä¸€æ ·ï¼Œæ ¹æ®ä¸Šé¢çš„å…¬å¼ï¼Œå‚æ•°åº”è¯¥ä¸º

1. lengthFieldOffset = 0
2. lengthFieldLength = 2
3. lengthAdjustment = -2  å› ä¸ºé•¿åº¦åŸŸä¸º14ï¼Œè€ŒæŠ¥æ–‡å†…å®¹ä¸º12ï¼Œä¸ºäº†é˜²æ­¢è¯»å–æŠ¥æ–‡è¶…å‡ºæŠ¥æ–‡æœ¬ä½“ï¼Œå’Œå°†é•¿åº¦å­—æ®µä¸€èµ·è¯»å–è¿›æ¥ï¼Œéœ€è¦å‘Šè¯‰nettyï¼Œå®é™…è¯»å–çš„æŠ¥æ–‡é•¿åº¦æ¯”é•¿åº¦åŸŸä¸­çš„è¦å°‘2ï¼ˆ12-14=-2ï¼‰
4. initialBytesToStrip = 0 - è§£ç è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¸¢å¼ƒä»»ä½•æ•°æ®

---------

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE27A2423158E2405A81AED9A987F2F034/10130](/images/netty/10130.png)

é•¿åº¦åŸŸçš„å€¼ä¸º12B(0x000c)ã€‚ç¼–ç è§£ç åï¼Œé•¿åº¦ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥initialBytesToStrip = 0ã€‚å‚æ•°åº”è¯¥ä¸º:

1. lengthFieldOffset = 2
2. lengthFieldLength = 3
3. lengthAdjustment = 0æ— éœ€è°ƒæ•´
4. initialBytesToStrip = 0 - è§£ç è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¸¢å¼ƒä»»ä½•æ•°æ®

----------

> **Headerä¸é•¿åº¦åŸŸçš„ä½ç½®æ¢äº†ã€‚æ€»æ•°æ®åŒ…é•¿åº¦: 17=é•¿åº¦åŸŸ(3B) + Header(2B) + "HELLO, WORLD"**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE56B49B7B6F9C4C0F8AD72167C8EF63BD/10131](/images/netty/10131.png)

é•¿åº¦åŸŸçš„å€¼ä¸º12B(0x000c)ã€‚ç¼–ç è§£ç åï¼Œé•¿åº¦ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥initialBytesToStrip = 0ã€‚å‚æ•°åº”è¯¥ä¸º:

1. lengthFieldOffset = 0
2. lengthFieldLength = 3
3. lengthAdjustment = 2  å› ä¸ºé•¿åº¦åŸŸä¸º12ï¼Œè€ŒæŠ¥æ–‡å†…å®¹ä¸º12ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æŠŠHeaderçš„å€¼ä¸€èµ·è¯»å–è¿›æ¥ï¼Œéœ€è¦å‘Šè¯‰nettyï¼Œå®é™…è¯»å–çš„æŠ¥æ–‡å†…å®¹é•¿åº¦æ¯”é•¿åº¦åŸŸä¸­çš„è¦å¤š2ï¼ˆ12+2=14ï¼‰
4. initialBytesToStrip = 0 - è§£ç è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¸¢å¼ƒä»»ä½•æ•°æ®

----------

> **å¸¦æœ‰ä¸¤ä¸ªheaderã€‚HDR1 ä¸¢å¼ƒï¼Œé•¿åº¦åŸŸä¸¢å¼ƒï¼Œåªå‰©ä¸‹ç¬¬äºŒä¸ªheaderå’Œæœ‰æ•ˆåŒ…ä½“ï¼Œè¿™ç§åè®®ä¸­ï¼Œä¸€èˆ¬HDR1å¯ä»¥è¡¨ç¤ºmagicNumberï¼Œè¡¨ç¤ºåº”ç”¨åªæ¥å—ä»¥è¯¥magicNumberå¼€å¤´çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œrpcé‡Œé¢ç”¨çš„æ¯”è¾ƒå¤šã€‚æ€»æ•°æ®åŒ…é•¿åº¦: 16=HDR1(1B)+é•¿åº¦åŸŸ(2B) +HDR2(1B) + "HELLO, WORLD"**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICEF4793DB7C074430AB7085820B8BB7473/10132](/images/netty/10132.png)

é•¿åº¦åŸŸçš„å€¼ä¸º12B(0x000c)

1. lengthFieldOffset = 1 (HDR1çš„é•¿åº¦)
2. lengthFieldLength = 2
3. lengthAdjustment =1  å› ä¸ºé•¿åº¦åŸŸä¸º12ï¼Œè€ŒæŠ¥æ–‡å†…å®¹ä¸º12ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æŠŠHDR2çš„å€¼ä¸€èµ·è¯»å–è¿›æ¥ï¼Œéœ€è¦å‘Šè¯‰nettyï¼Œå®é™…è¯»å–çš„æŠ¥æ–‡å†…å®¹é•¿åº¦æ¯”é•¿åº¦åŸŸä¸­çš„è¦å¤š1ï¼ˆ12+1=13ï¼‰
4. initialBytesToStrip = 3  ä¸¢å¼ƒäº†HDR1å’Œé•¿åº¦å­—æ®µ

--------

> **å¸¦æœ‰ä¸¤ä¸ªheaderï¼ŒHDR1 ä¸¢å¼ƒï¼Œé•¿åº¦åŸŸä¸¢å¼ƒï¼Œåªå‰©ä¸‹ç¬¬äºŒä¸ªheaderå’Œæœ‰æ•ˆåŒ…ä½“ã€‚æ€»æ•°æ®åŒ…é•¿åº¦: 16=HDR1(1B)+é•¿åº¦åŸŸ(2B) +HDR2(1B) + "HELLO, WORLD"**

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICEE36380D9BCEA48D1ABE567EFC7D25643/10133](/images/netty/10133.png)

é•¿åº¦åŸŸçš„å€¼ä¸º16B(0x0010)ï¼Œé•¿åº¦ä¸º2ï¼ŒHDR1çš„é•¿åº¦ä¸º1ï¼ŒHDR2çš„é•¿åº¦ä¸º1ï¼ŒåŒ…ä½“çš„é•¿åº¦ä¸º12ï¼Œ1+1+2+12=16ã€‚

1. lengthFieldOffset = 1
2. lengthFieldLength = 2
3. lengthAdjustment = -3å› ä¸ºé•¿åº¦åŸŸä¸º16ï¼Œéœ€è¦å‘Šè¯‰nettyï¼Œå®é™…è¯»å–çš„æŠ¥æ–‡å†…å®¹é•¿åº¦æ¯”é•¿åº¦åŸŸä¸­çš„è¦ å°‘3ï¼ˆ13-16= -3ï¼‰
4. initialBytesToStrip = 3ä¸¢å¼ƒäº†HDR1å’Œé•¿åº¦å­—æ®µ



### ä¸¾ä¾‹

å®¢æˆ·ç«¯å‘ä¸€ä¸²å­—ç¬¦`HELLO, WORLD` ä½¿ç”¨ä¸¤ä¸ªé•¿åº¦å•ä½è¡¨ç¤º

```java
/*å‘Šè¯‰nettyï¼Œè®¡ç®—ä¸€ä¸‹æŠ¥æ–‡çš„é•¿åº¦ï¼Œç„¶åä½œä¸ºæŠ¥æ–‡å¤´åŠ åœ¨å‰é¢*/
ch.pipeline().addLast(new LengthFieldPrepender(2));
```

![https://note.youdao.com/yws/public/resource/f71d324d40f6c4bfb67e419a8fb42862/xmlnote/OFFICE2D67B7B75DB24DB0B07D9800E83CC4BC/10128](/images/netty/10128.png)

æœåŠ¡ç«¯æ¥æ”¶

```java
ch.pipeline().addLast(new LengthFieldBasedFrameDecoder(65535,
                    0,2,0,2));


/***********************************************************
- maxFrameLength 65535
- lengthFieldOffset 0
- lengthFieldLength 2
- lengthAdjustment 0
- initialBytesToStrip 2
**/
```

