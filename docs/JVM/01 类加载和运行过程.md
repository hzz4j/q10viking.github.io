---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To ç›®å½•
  link: /JVM/
typora-root-url: ..\.vuepress\public
---



::: tip

[Source Code](https://github.com/Q10Viking/learncode/tree/main/jvm/_01_jvm_classload)

:::

## javaç¨‹åºå¯åŠ¨åº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

::: tip

åœ¨æ§åˆ¶å°è¾“å…¥ java org.hzz.Math

:::

![image-20220817175748092](/images/jvm/image-20220817175748092.png)

::: details Math.java

```java
public class Math {
    public static final int initData = 666;
    public static User user = new User();

    public int compute() {  //ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€å—æ ˆå¸§å†…å­˜åŒºåŸŸ
        int a = 1;
        int b = 2;
        int c = (a + b) * 10;
        return c;
    }

    public static void main(String[] args) {
        Math math = new Math();
        math.compute();
        System.out.println("Hello JVM");
    }
}
```

:::

```sh
D:\learncode\jvm\_01_jvm_classload\target\classes> java org.hzz.Math
Hello JVM
```

1. åˆ›å»ºjavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰

2. JVMåˆ›å»ºå¼•å¯¼ç±»åŠ è½½å™¨

3. **å¼•å¯¼ç±»åŠ è½½å™¨**åŠ è½½å¹¶å®ä¾‹åŒ–sun.misc.Launcher  (`This class is used by the system to launch the main application.`)

4. åœ¨Launcheræ„é€ æ–¹æ³•å†…éƒ¨ï¼Œå…¶åˆ›å»ºäº†ä¸¤ä¸ªç±»åŠ è½½å™¨**ExtClassLoader,AppClassLoader**

::: details Launcher.java

   ```java
   /**
    * This class is used by the system to launch the main application.
   Launcher */
   public class Launcher {
       private static Launcher launcher = new Launcher();
       private ClassLoader loader;
       public Launcher() {
               // Create the extension class loader
               ClassLoader extcl;
               try {
                   extcl = ExtClassLoader.getExtClassLoader();
               } catch (IOException e) {
                   throw new InternalError(
                       "Could not create extension class loader", e);
               }
   
               // Now create the class loader to use to launch the application
               try {
                   loader = AppClassLoader.getAppClassLoader(extcl);
               } catch (IOException e) {
                   throw new InternalError(
                       "Could not create application class loader", e);
               }
               // Also set the context class loader for the primordial thread.
               Thread.currentThread().setContextClassLoader(loader);
           // ... 
       }
       // ...
       /*
        * Returns the class loader used to launch the main application.
        */
       public ClassLoader getClassLoader() {
           return loader;
       }
   }
   ```
:::

5. JVMé»˜è®¤ä½¿ç”¨Launcherçš„getClassLoader()æ–¹æ³•è¿”å›çš„ç±»åŠ è½½å™¨AppClassLoaderçš„å®ä¾‹åŠ è½½æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚Mathï¼‰
6. åŠ è½½å®ŒæˆåJVMä¼šæ‰§è¡ŒMathç±»çš„mainæ–¹æ³•

![img](/images/jvm/102280)

### ä»Hotspotè§’åº¦åˆ†æJVMå¯åŠ¨mainæ–¹æ³•æµç¨‹

1. åˆ›å»ºjavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰

2. JVMåˆ›å»ºå¼•å¯¼ç±»åŠ è½½å™¨

3. å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½å¹¶å®ä¾‹åŒ–sun.misc.Launcher  (`This class is used by the system to launch the main application.`)

4. åœ¨Launcheræ„é€ æ–¹æ³•å†…éƒ¨ï¼Œå…¶åˆ›å»ºäº†ä¸¤ä¸ªç±»åŠ è½½å™¨**ExtClassLoader,AppClassLoader**

![img](/images/jvm/106918.png)



> éªŒè¯Launcheræ˜¯è¢«å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½çš„

```java
public class LauncherTest {
    public static void main(String[] args) {
        System.out.println(LauncherTest.class.getClassLoader());
        System.out.println(Launcher.class.getClassLoader());
    }
}
/**
 * sun.misc.Launcher$AppClassLoader@18b4aac2
 * null
 */
```



----------



## ç±»åŠ è½½å…¨è¿‡ç¨‹â­

> ç±»çš„å®Œå…¨åŠ è½½è¿‡ç¨‹ï¼š**åŠ è½½ >> è¿æ¥(éªŒè¯ >> å‡†å¤‡ >> è§£æ) >> åˆå§‹åŒ–**ï¼Œï¼ˆåªæ‰§è¡Œä¸€éï¼‰

```java
protected Class<?> loadClass(String name, boolean resolve)
        throws ClassNotFoundException
    {
    }
```

![image-20210325020601096](/images/jvm/image-20210325020601096.png)



### åŠ è½½

åŠ è½½æ—¶ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š

1. é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµ
2. å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„
3. åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œ**ä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£**ã€‚

ç›¸å¯¹äºç±»åŠ è½½çš„å…¶ä»–é˜¶æ®µè€Œè¨€ï¼ŒåŠ è½½é˜¶æ®µï¼ˆå‡†ç¡®åœ°è¯´ï¼Œæ˜¯åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œå› ä¸ºå¼€å‘äººå‘˜æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ã€‚

**åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„ äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œè€Œä¸”åœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›æ•°æ®ã€‚**



### è¿æ¥

#### éªŒè¯

::: tip

æ ¡éªŒclasså­—èŠ‚ç æ–‡ä»¶ç¬¦åˆjavaè§„èŒƒï¼Œç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§

:::

éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š

1. **æ–‡ä»¶æ ¼å¼éªŒè¯**ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚
2. **å…ƒæ•°æ®éªŒè¯**ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚
3. **å­—èŠ‚ç éªŒè¯**ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„
4. **å­—èŠ‚ç éªŒè¯**ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„

éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨**-Xverifynone**å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚



#### å‡†å¤‡

::: tip

**é™æ€å˜é‡**åˆ†é…å†…å­˜ï¼Œ**åˆå§‹å€¼èµ‹å€¼ï¼Œèµ‹äºˆé»˜è®¤å€¼**

:::

å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š

1. è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­

2. è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨Javaä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚

   ```java
   å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼špublic static int value = 3ï¼›
   
   é‚£ä¹ˆå˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0ï¼Œè€Œä¸æ˜¯3ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º3çš„putstaticæŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨<clinit>ï¼ˆï¼‰æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º3çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚
   
   å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹referenceæ¥è¯´ï¼Œå¦‚æ•°ç»„å¼•ç”¨ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾å¼åœ°èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œå³nullã€‚
   
   å¦‚æœåœ¨æ•°ç»„åˆå§‹åŒ–æ—¶æ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å…ƒç´ å°†æ ¹æ®å¯¹åº”çš„æ•°æ®ç±»å‹è€Œè¢«èµ‹äºˆé»˜è®¤çš„é›¶å€¼ã€‚
   ```

3. å¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ConstantValueå±æ€§ï¼Œå³åŒæ—¶è¢«finalå’Œstaticä¿®é¥°ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå˜é‡valueå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstValueå±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚

   ```java
   å‡è®¾ç±»å˜é‡valueè¢«å®šä¹‰ä¸ºï¼š public static final int value = 3ï¼›
   
   ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºvalueç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®ConstantValueçš„è®¾ç½®å°†valueèµ‹å€¼ä¸º3ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºstatic finalå¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°†å…¶ç»“æœæ”¾å…¥äº†è°ƒç”¨å®ƒçš„ç±»çš„å¸¸é‡æ± ä¸­
   ```

### è§£æ

2. è§£æ

   1. **é™æ€é“¾æ¥**ï¼Œ**å°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨**ï¼Œ**é™æ€æ–¹æ³•**æ›¿æ¢ä¸ºæŒ‡å‘æ•°æ®æ‰€å­˜çš„å†…å­˜åœ°å€æˆ–å¥æŸ„ï¼›æé«˜æ•ˆç‡ï¼Œ**ä¸ä¼šå˜ï¼ˆèƒ½å¤Ÿç¡®å®šå†…å­˜çš„åœ°å€ä½ç½®ï¼‰**,**ç¬¦å·å¼•ç”¨ï¼ˆå­—é¢ç¬¦å·é‡ï¼‰**å¦‚ï¼šmainæ–¹æ³•ï¼Œç±»åç§°
   2. **åŠ¨æ€é“¾æ¥**ï¼Œåœ¨**è¿è¡ŒæœŸé—´**å®Œæˆ**ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨**ï¼Œå¦‚å®ä¾‹æ–¹æ³•çš„è°ƒç”¨ï¼Œæ‰¾åˆ°å†…å­˜ä½ç½®ï¼Œ**ä¼šå˜**ï¼Œç›´åˆ°è¿è¡Œæ—¶æ‰çŸ¥é“æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œå¦‚**å¤šæ€ï¼Œæ¥å£**çš„å½±å“ã€‚
   3. classå­—èŠ‚ç ä¸­Constant pool**å¸¸é‡æ± **(**å­—é¢ç¬¦å·é‡**)ï¼Œè¿™äº›æœ€ç»ˆä¼šè¢«åŠ è½½åˆ° JVMå†…å­˜ä¸­ï¼Œå°±ä¼šå­˜åœ¨åœ°å€
      1. å¸¸é‡æ± ä¸­ï¼š #12 ä¸º**æ ‡è¯†ç¬¦**  **å­—é¢ç¬¦å·é‡**


::: tip

ç±»è¢«åŠ è½½åˆ°**æ–¹æ³•åŒº**ä¸­åä¸»è¦åŒ…å« **è¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»å‹ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç±»åŠ è½½å™¨çš„å¼•ç”¨ã€å¯¹åº”classå®ä¾‹çš„å¼•ç”¨**ç­‰ä¿¡æ¯

:::

**ç±»åŠ è½½å™¨çš„å¼•ç”¨**ï¼šè¿™ä¸ªç±»åˆ°ç±»åŠ è½½å™¨å®ä¾‹çš„å¼•ç”¨

**å¯¹åº”classå®ä¾‹çš„å¼•ç”¨**ï¼šâ¤ï¸ç±»åŠ è½½å™¨åœ¨**åŠ è½½ç±»ä¿¡æ¯**æ”¾åˆ°æ–¹æ³•åŒºä¸­åï¼Œä¼šåˆ›å»º**ä¸€ä¸ªå¯¹åº”çš„Class ç±»å‹çš„å¯¹è±¡å®ä¾‹**æ”¾åˆ°å †(Heap)ä¸­â¤ï¸, ä½œä¸ºå¼€å‘äººå‘˜è®¿é—®æ–¹æ³•åŒºä¸­**ç±»å®šä¹‰**çš„å…¥å£å’Œåˆ‡å…¥ç‚¹



## ç±»çš„æ‡’åŠ è½½ï¼ˆæ‡’åˆå§‹åŒ–ï¼‰â¤ï¸

::: tip

ç±»çš„å®Œå…¨åŠ è½½è¿‡ç¨‹ï¼š**åŠ è½½ >> éªŒè¯ >> å‡†å¤‡ >> è§£æ >> åˆå§‹åŒ–**ï¼Œï¼ˆåªæ‰§è¡Œä¸€éï¼‰è€Œç±»çš„æ‡’åŠ è½½ä¸»è¦æ˜¯ä½“ç°åœ¨æ‡’åˆå§‹åŒ–ä¸Šã€‚

jaråŒ…æˆ–è€…waråŒ…é‡Œé¢çš„ç±»**ä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½çš„**ï¼Œä½¿ç”¨åˆ°æ—¶æ‰ä¼šè¢«åŠ è½½

â¤ï¸**ä¸»ç±»åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¦‚æœä½¿ç”¨åˆ°å…¶å®ƒç±»ï¼Œä¼šé€æ­¥åŠ è½½è¿™äº›ç±»,å¹¶ä¸”é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨æ˜¯åŠ è½½è¯¥ä¸»ç±»æ—¶çš„ç±»åŠ è½½å™¨**â¤ï¸

:::

> ä¸‹é¢è¿™ä¸ªç¨‹åºéªŒè¯ï¼š1. ç±»åŠ è½½è¿‡ç¨‹åˆå§‹åŒ–çš„éªŒè¯  2. æ‡’åŠ è½½
>
> â¤ï¸å¯ä»¥çœ‹åˆ°é™æ€å˜é‡Aå’Œé™æ€ä»£ç å—æ‰§è¡Œäº†ï¼Œä½†æ˜¯Då’ŒCå¹¶æ²¡æœ‰è¢«åŠ è½½ã€‚â¤ï¸

```java
public class TestDynamicLoad {
    public static A a = new A();

    static {
        System.out.println("*************load TestDynamicLoad*******************");
    }

    public D d = new D();

    public static void main(String[] args) {
        System.out.println("*************main method****************************");
        B b = new B();
        C c = null;
    }
}

class A {
    static {
        System.out.println("*************load A*********************************");
    }
}

class B {
    static {
        System.out.println("*************load B*********************************");
    }
}

class C {
    static {
        System.out.println("*************load C*********************************");
    }
}

class D {
    static {
        System.out.println("*************load D*********************************");
    }
}
/**
 * *************load A*********************************
 * *************load TestDynamicLoad*******************
 * *************main method****************************
 * *************load B*********************************
 */
```



##### å®ä¾‹åŒ–æ—¶åˆ°åº•æ˜¯æˆå‘˜å˜é‡å…ˆè¿˜æ˜¯æ„é€ æ–¹æ³•å…ˆ?

> ä»ä¸‹é¢çš„ä¾‹å­**å¯ä»¥çœ‹å‡ºæ˜æ˜¾æˆå‘˜å˜é‡å…ˆåˆå§‹åŒ–**

```java
public class FieldMemberVsInitDemo {
    private A a = new A();
    public FieldMemberVsInitDemo(){
        System.out.println("FieldMemberVsInitDemo init...");
    }

    class A{
        public A(){
            System.out.println("A init...");
        }
    }
    public static void main(String[] args) {
        new FieldMemberVsInitDemo();
    }
}
/**
 * A init...
 * FieldMemberVsInitDemo init...
 */
```





### ç±»åŠ è½½åˆå§‹åŒ–æ—¶æœºğŸ˜Š

::: tip

ç±»é»˜è®¤æ˜¯æ‡’åŠ è½½æœºåˆ¶ï¼Œåªæœ‰ä½¿ç”¨åˆ°äº†çš„æ—¶å€™æ‰ä¼šè¿›è¡ŒåŠ è½½ï¼Œä»è€Œè§¦å‘åˆå§‹åŒ–

**Javaç±»åŠ è½½ä¼šåˆå§‹åŒ–**çš„æƒ…å†µæœ‰ä¸”ä»…æœ‰ä»¥ä¸‹äº”ç§ï¼šï¼ˆä¹Ÿç§°ä¸ºä¸»åŠ¨å¼•ç”¨ï¼‰

:::

1. é€šè¿‡initæŒ‡ä»¤ï¼Œå¦‚new newInstance
2. getStaticï¼ˆè¯»å–ä¸€ä¸ªé™æ€å­—æ®µï¼‰
3. putstaticï¼ˆè®¾ç½®ä¸€ä¸ªé™æ€å­—æ®µï¼‰
4. invokeStaticï¼ˆè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼‰è¿™å››æ¡æŒ‡ä»¤å­—èŠ‚ç å‘½ä»¤æ—¶
5. å­ç±»åˆå§‹åŒ–ä¼šå…ˆè°ƒç”¨çˆ¶ç±»

> â¤ï¸å¦‚ä¸‹é¢çš„ä»£ç å¹¶ä¸ä¼šæ‰§è¡ŒAç±»ä¸­çš„é™æ€ä»£ç å—ï¼Œè™½ç„¶ä½¿ç”¨äº†A.class.getName()ï¼ŒclassLoader.loadClass("org.hzz.dynamicload.a.A")ç­‰ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœŸæ­£è§¦å‘åŠ è½½ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆï¼ŒA.class.getName(),èƒ½è·å–åˆ°ä¿¡æ¯å‘¢ï¼Ÿå› ä¸ºA.classåªæ˜¯è¢«åŠ è½½åˆ°äº†æ–¹æ³•åŒºï¼ˆç±»ä¿¡æ¯ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨å †çš„Classå¯¹è±¡â¤ï¸

```java
/**
 * ç±»Aå¹¶æ²¡æœ‰è¢«åŠ è½½
 */
public class TestA {
    public static void main(String[] args) throws Exception {
        ClassLoader classLoader = A.class.getClassLoader();
        System.out.println(A.class.getName());
        // ç±»åŠ è½½ æ˜¯ä¸€ä¸ªæ‡’åŠ è½½ï¼Œåªæœ‰ä½¿ç”¨åˆ°äº†æ‰ä¼šè¿›è¡ŒåŠ è½½
        Class<?> aClass = classLoader.loadClass("org.hzz.dynamicload.a.A");
        System.out.println(A.class == aClass);
        System.out.println(A.class);
        // åˆå§‹åŒ–
        //aClass.newInstance();
        // A.hello();
    }
}

/**
 * org.hzz.dynamicload.a.A
 * true
 * class org.hzz.dynamicload.a.A
 */
class A {
    static {
        System.out.println("A init success");
    }

    public static void hello() {
    }
}
```



### Class.forName

::: tip

æ›´èƒ½éªŒè¯ç±»æ‡’åˆå§‹åŒ–çš„ä¾‹å­

:::

```java
public class TestB {
    public static void main(String[] args) throws ClassNotFoundException {
        Class b0 = B.class;  // æ‡’åŠ è½½ï¼Œä¸ä¼šåˆå§‹åŒ–
        // æ‡’åŠ è½½ï¼Œä¸ä¼šåˆå§‹åŒ–B
        Class<?> b1 = Class.forName("org.hzz.B",false,TestB.class.getClassLoader());
        System.out.println(b1 == b0); // true
        // ä¼šåˆå§‹åŒ–
        // ç›¸å½“äº Class<?> b1 = Class.forName("org.hzz.B",true,TestB.class.getClassLoader());
        Class<?> b2 = Class.forName("org.hzz.B");
        System.out.println(b1 == b2); // true
    }
}
/**è¾“å‡º
 * true
 * B init success
 * true
 */
class B{
    static {
        System.out.println("B init success");
    }
}
```



### ConstantValueâ¤ï¸

::: tip

ç›®å‰ç”±Oracleå…¬å¸å®ç°çš„Javacç¼–è¯‘å™¨çš„é€‰æ‹©æ˜¯ï¼Œåªæœ‰åŒæ—¶è¢«finalå’Œstaticä¿®é¥°çš„å­—æ®µæ‰æœ‰ConstantValueå±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªå˜é‡çš„æ•°æ®ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…Stringï¼Œåœ¨ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºè¯¥å˜é‡ç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨ç±»åŠ è½½çš„å‡†å¤‡é˜¶æ®µï¼Œä¼šç”¨ConstantValueä¸­çš„å€¼æ¥åˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ•°æ®ç±»å‹çš„é›¶å€¼æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚ç›¸åï¼Œå¦‚æœç±»å˜é‡ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–è€…stringï¼Œæˆ–è€…finalä¿®é¥°ï¼Œå°±ä¼šåœ¨< clinit >()ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚

åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µå·²ç»æœ‰å€¼äº†ã€‚

:::

```java
public class TestConstantValue {
    public static void main(String[] args) {
        System.out.println(V.A);
        System.out.println(V.B); // è®¿é—®ç±»ä¸­ConstantValueï¼ˆå­—é¢å¸¸é‡å¹¶ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼‰
        System.out.println("------------------------");
        //System.out.println(V.C);
        System.out.println(V.B == "hello World");
    }

}

/**
 * 1
 * hello World
 * ------------------------
 * true
 */
class V{
    public final static int A = 1;
    public final static String B = "hello World";
    public final static String C = new String("hello World");

    static {
        System.out.println("init success");
    }
}
```



### éªŒè¯loadClassåªæ˜¯åŠ è½½ç±»

```java
public class TestConstantValueV2 {
    public static void main(String[] args) throws NoSuchFieldException, ClassNotFoundException, IllegalAccessException {
        Class<?> v2Class = ClassLoader.getSystemClassLoader().loadClass("org.hzz.variables.V2");
        Field a = v2Class.getField("A");
        System.out.println(a.get(null));
    }
}

/**
 * init success
 * 1
 */
class V2{
    public final static int A = 1;
    static {
        System.out.println("init success");
    }
}
```



## IDEA æŸ¥çœ‹sunåŒ…æºç 

::: tip

ç›®æ ‡åœ¨IDEAä¸­sun.misc.Launcher.classå˜æˆäº†sun.misc.Launcher.java

:::

```sh
# å°†openjdkçš„ä»£ç ä¸‹è½½åˆ°æœ¬åœ°ç›®å½•E:\openjdk\jdk8\
git clone https://github.com/openjdk-mirror/jdk.git
# æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯
git branch -r
# é€‰æ‹©origin/jdk8u/jdk8u/master åˆ†æ”¯
git checkout origin/jdk8u/jdk8u/master
```

![image-20220817183845957](/images/jvm/image-20220817183845957.png)

IDEAä¸­æŒ‡å®šæºç è·¯å¾„

![image-20220817190108274](/images/jvm/image-20220817190108274.png)



### å‚è€ƒ

[ç”¨IDEAè°ƒè¯•JDKæºç  (å«é˜…è¯»è°ƒè¯•æºç çš„æŠ€å·§)](https://blog.csdn.net/qq_42322103/article/details/104369824?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-104369824-blog-123503216.t5_layer_targeting_s_randoms&spm=1001.2101.3001.4242.2&utm_relevant_index=4)

[idea æŸ¥çœ‹javaæºç _IDEAæŸ¥çœ‹Javaçš„sunåŒ…ä¸‹çš„æºç ](https://blog.csdn.net/weixin_34779181/article/details/114514893)

