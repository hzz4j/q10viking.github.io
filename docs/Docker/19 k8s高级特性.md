---
sidebarDepth: 3
sidebar: auto
prev:
  text: Back To ç›®å½•
  link: /Docker/
typora-root-url: ..\.vuepress\public
---



## ReplicaSet

ReplicaSetç¡®ä¿ä»»ä½•æ—¶é—´éƒ½æœ‰æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬åœ¨è¿è¡Œã€‚é€šå¸¸ç”¨æ¥ä¿è¯ç»™å®šæ•°é‡çš„ã€å®Œå…¨ç›¸åŒçš„Podçš„å¯ç”¨æ€§ã€‚å»ºè®®ä½¿ç”¨Deploymentæ¥ç®¡ç†ReplicaSetï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ReplicaSetã€‚



## ConfigMap

ConfigMapæ˜¯ä¸€ç§APIå¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚ä½¿ç”¨æ—¶ï¼ŒPodå¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ConfigMapå¯ä»¥å°†ä½ çš„é…ç½®æ•°æ®å’Œåº”ç”¨ç¨‹åºä»£ç åˆ†å¼€



## Volume

VolumeæŒ‡çš„æ˜¯å­˜å‚¨å·ï¼ŒåŒ…å«å¯è¢«Podä¸­å®¹å™¨è®¿é—®çš„æ•°æ®ç›®å½•ã€‚å®¹å™¨ä¸­çš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ˜¯ä¸´æ—¶å­˜æ”¾çš„ï¼Œå½“å®¹å™¨å´©æºƒæ—¶æ–‡ä»¶ä¼šä¸¢å¤±ï¼ŒåŒæ—¶æ— æ³•åœ¨å¤šä¸ªPodä¸­å…±äº«æ–‡ä»¶ï¼Œé€šè¿‡ä½¿ç”¨å­˜å‚¨å·å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚

å¸¸ç”¨çš„å­˜å‚¨å·æœ‰å¦‚ä¸‹å‡ ç§ï¼š

- configMapï¼šconfigMapå·æä¾›äº†å‘Podæ³¨å…¥é…ç½®æ•°æ®çš„æ–¹æ³•ã€‚ConfigMapå¯¹è±¡ä¸­å­˜å‚¨çš„æ•°æ®å¯ä»¥è¢«configMapç±»å‹çš„å·å¼•ç”¨ï¼Œç„¶åè¢«Podä¸­è¿è¡Œçš„å®¹å™¨åŒ–åº”ç”¨ä½¿ç”¨ã€‚
- emptyDirï¼šemptyDirå·å¯ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®ã€‚å½“Podåˆ†æ´¾åˆ°æŸä¸ªNodeä¸Šæ—¶ï¼ŒemptyDirå·ä¼šè¢«åˆ›å»ºï¼Œå¹¶ä¸”Podåœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡ŒæœŸé—´ï¼Œå·ä¸€ç›´å­˜åœ¨ã€‚å½“Podè¢«ä»èŠ‚ç‚¹ä¸Šåˆ é™¤æ—¶emptyDirå·ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚
- hostPathï¼šhostPathå·èƒ½å°†ä¸»æœºèŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°ä½ çš„Podä¸­ã€‚åœ¨Minikubeä¸­çš„ä¸»æœºæŒ‡çš„æ˜¯Minikubeæ‰€åœ¨è™šæ‹Ÿæœºã€‚
- localï¼šlocalå·æ‰€ä»£è¡¨çš„æ˜¯æŸä¸ªè¢«æŒ‚è½½çš„æœ¬åœ°å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ç£ç›˜ã€åˆ†åŒºæˆ–è€…ç›®å½•ã€‚localå·åªèƒ½ç”¨ä½œé™æ€åˆ›å»ºçš„æŒä¹…å·ï¼Œå°šä¸æ”¯æŒåŠ¨æ€é…ç½®ã€‚
- nfsï¼šnfså·èƒ½å°†NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æŒ‚è½½åˆ°ä½ çš„Podä¸­ã€‚
- persistentVolumeClaimï¼špersistentVolumeClaimå·ç”¨æ¥å°†æŒä¹…å·ï¼ˆPersistentVolumeï¼‰æŒ‚è½½åˆ°Podä¸­ã€‚æŒä¹…å·ï¼ˆPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥ç”±ç®¡ç†å‘˜äº‹å…ˆä¾›åº”ï¼Œæˆ–è€…ä½¿ç”¨å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰æ¥åŠ¨æ€ä¾›åº”ï¼ŒæŒä¹…å·æ˜¯é›†ç¾¤èµ„æºç±»ä¼¼äºèŠ‚ç‚¹



## IngressğŸ˜˜

é€šè¿‡K8Sçš„Ingressèµ„æºå¯ä»¥å®ç°ç±»ä¼¼Nginxçš„åŸºäºåŸŸåè®¿é—®ï¼Œä»è€Œå®ç°Podçš„è´Ÿè½½å‡è¡¡è®¿é—®ã€‚

![https://note.youdao.com/yws/public/resource/bc7bee305611b52d6900ba209a92bd4d/xmlnote/CF0D33EA656C4B80A3161D651F0EC02E/111179](/images/Docker/111179.png)



**å®‰è£…Ingress**

è¿›å…¥é¡µé¢[ingress-nginx/mandatory.yaml at nginx-0.20.0 Â· kubernetes/ingress-nginx Â· GitHub](https://github.com/kubernetes/ingress-nginx/blob/nginx-0.20.0/deploy/mandatory.yaml)ï¼Œå°†é‡Œé¢å†…å®¹å¤åˆ¶ï¼Œä¿å­˜åˆ°k8s masteræœºå™¨ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ingress-controller.yamlé‡Œã€‚è¿è¡Œç½‘ä¸Šçš„è¿™ä¸ªæœ‰é—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥è¯•ä¸‹é¢çš„ã€‚

::: details

```yml
apiVersion: v1
kind: Namespace
metadata:
  name: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx

---

kind: ConfigMap
apiVersion: v1
metadata:
  name: nginx-configuration
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: tcp-services
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: udp-services
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nginx-ingress-serviceaccount
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx

---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: nginx-ingress-clusterrole
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
      - endpoints
      - nodes
      - pods
      - secrets
    verbs:
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - nodes
    verbs:
      - get
  - apiGroups:
      - ""
    resources:
      - services
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "extensions"
    resources:
      - ingresses
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - create
      - patch
  - apiGroups:
      - "extensions"
    resources:
      - ingresses/status
    verbs:
      - update

---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: Role
metadata:
  name: nginx-ingress-role
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
      - pods
      - secrets
      - namespaces
    verbs:
      - get
  - apiGroups:
      - ""
    resources:
      - configmaps
    resourceNames:
      # Defaults to "<election-id>-<ingress-class>"
      # Here: "<ingress-controller-leader>-<nginx>"
      # This has to be adapted if you change either parameter
      # when launching the nginx-ingress-controller.
      - "ingress-controller-leader-nginx"
    verbs:
      - get
      - update
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - create
  - apiGroups:
      - ""
    resources:
      - endpoints
    verbs:
      - get

---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: RoleBinding
metadata:
  name: nginx-ingress-role-nisa-binding
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: nginx-ingress-role
subjects:
  - kind: ServiceAccount
    name: nginx-ingress-serviceaccount
    namespace: ingress-nginx

---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: nginx-ingress-clusterrole-nisa-binding
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: nginx-ingress-clusterrole
subjects:
  - kind: ServiceAccount
    name: nginx-ingress-serviceaccount
    namespace: ingress-nginx

---

apiVersion: apps/v1
kind: DaemonSet 
metadata:
  name: nginx-ingress-controller
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: ingress-nginx
      app.kubernetes.io/part-of: ingress-nginx
  template:
    metadata:
      labels:
        app.kubernetes.io/name: ingress-nginx
        app.kubernetes.io/part-of: ingress-nginx
      annotations:
        prometheus.io/port: "10254"
        prometheus.io/scrape: "true"
    spec:
      hostNetwork: true
      serviceAccountName: nginx-ingress-serviceaccount
      containers:
        - name: nginx-ingress-controller
          image: siriuszg/nginx-ingress-controller:0.20.0
          args:
            - /nginx-ingress-controller
            - --configmap=$(POD_NAMESPACE)/nginx-configuration
            - --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services
            - --udp-services-configmap=$(POD_NAMESPACE)/udp-services
            - --publish-service=$(POD_NAMESPACE)/ingress-nginx
            - --annotations-prefix=nginx.ingress.kubernetes.io
          securityContext:
            allowPrivilegeEscalation: true
            capabilities:
              drop:
                - ALL
              add:
                - NET_BIND_SERVICE
            # www-data -> 33
            runAsUser: 33
          env:
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          ports:
            - name: http
              containerPort: 80
            - name: https
              containerPort: 443
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz
              port: 10254
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 10
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz
              port: 10254
              scheme: HTTP
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 10

---
apiVersion: v1
kind: Service
metadata:
  name: ingress-nginx
  namespace: ingress-nginx
spec:
  #type: NodePort
  ports:
  - name: http
    port: 80
    targetPort: 80
    protocol: TCP
  - name: https
    port: 443
    targetPort: 443
    protocol: TCP
  selector:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
```

### å®‰è£…

> å®‰è£…Ingress

```sh
 kubectl apply -f ingress-controller.yaml
```



æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ

```sh
kubectl get pods -n ingress-nginx -o wide
[root@k8s-master learnk8s]# kubectl get pods -n ingress-nginx -o wide
NAME                             READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES
nginx-ingress-controller-rqwgj   1/1     Running   0          2m14s   192.168.135.132   k8s-node1   <none>           <none>
nginx-ingress-controller-txds2   1/1     Running   0          2m14s   192.168.135.135   k8s-node2   <none>           <none>
```

![image-20230425174451412](/images/Docker/image-20230425174451412.png)



### é…ç½®è®¿é—®è§„åˆ™

é…ç½®ingressè®¿é—®è§„åˆ™ï¼ˆå°±æ˜¯ç±»ä¼¼é…ç½®nginxçš„ä»£ç†è½¬å‘é…ç½®ï¼‰ï¼Œè®©ingresså°†åŸŸåtomcat.tuling.comè½¬å‘ç»™åç«¯çš„my-tomcat-yamlæœåŠ¡

![image-20230425181346538](/images/Docker/image-20230425181346538.png)

æ–°å»ºä¸€ä¸ªæ–‡ä»¶`ingress-tomcat.yaml`ï¼Œå†…å®¹å¦‚ä¸‹

```yaml
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: web-ingress
spec:
  rules:
  - host: tomcat.hzz.org  #è½¬å‘åŸŸå
    http:
      paths:
      - path: /
        backend:
          serviceName: my-tomcat-yaml
          servicePort: 80  #serviceçš„ç«¯å£
```

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæ•ˆè§„åˆ™

```sh
kubectl apply -f ingress-tomcat.yaml
```

æŸ¥çœ‹ç”Ÿæ•ˆçš„ingressè§„åˆ™ï¼š

```sh
[root@k8s-master learnk8s]# kubectl get ing
NAME          CLASS    HOSTS            ADDRESS   PORTS   AGE
web-ingress   <none>   tomcat.hzz.org             80      2m30s
```

åœ¨è®¿é—®æœºå™¨é…ç½®hostï¼Œwin10å®¢æˆ·æœºåœ¨ç›®å½•ï¼š`C:\Windows\System32\drivers\etc`ï¼Œåœ¨hosté‡Œå¢åŠ å¦‚ä¸‹host(ingresséƒ¨ç½²çš„æœºå™¨ipå¯¹åº”è®¿é—®çš„åŸŸå)

```sh
 192.168.135.132 tomcat.hzz.org
 192.168.135.135 tomcat.hzz.org
```

é…ç½®å®Œåç›´æ¥åœ¨å®¢æˆ·æœºæµè§ˆå™¨è®¿é—®[http://tomcat.hzz.org/](http://tomcat.hzz.org/) ï¼Œèƒ½æ­£å¸¸è®¿é—®tomcatã€‚

![image-20230425182529373](/images/Docker/image-20230425182529373.png)





## é…ç½®ç®¡ç†



