<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/images/favicon-32x32.png"><title>é™é»˜ã®Blog</title><meta name="description" content="é™é»˜çš„Vuepress Blog">
    <link rel="preload" href="/assets/js/runtime~app.2c87fbe0.js" as="script"><link rel="preload" href="/assets/css/styles.b779b927.css" as="style"><link rel="preload" href="/assets/js/95615.aba5921d.js" as="script"><link rel="preload" href="/assets/js/app.4aafd1f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.b779b927.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">é™é»˜ã®Blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/topicNav/" class="nav-link" aria-label="ğŸ“—Menu"><!--[--><!--]--> ğŸ“—Menu <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/aboutme/" class="nav-link" aria-label="AboutMe"><!--[--><!--]--> AboutMe <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/Q10Viking/q10viking.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">Tomcatæºç åˆ†æ</p><ul class=""><li><!--[--><a href="/tomcat/01 æºç åˆ†æç¯å¢ƒæ­å»º.md" class="nav-link sidebar-item" aria-label="01 æºç åˆ†æç¯å¢ƒæ­å»º"><!--[--><!--]--> 01 æºç åˆ†æç¯å¢ƒæ­å»º <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/02 Servletè§„èŒƒä¸Servletå®¹å™¨.md" class="nav-link sidebar-item" aria-label="02 Servletè§„èŒƒä¸Servletå®¹å™¨"><!--[--><!--]--> 02 Servletè§„èŒƒä¸Servletå®¹å™¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/03 Servlet Demoå¼€å‘ç¯å¢ƒå‡†å¤‡.md" class="nav-link sidebar-item" aria-label="03 Servlet Demoå¼€å‘ç¯å¢ƒå‡†å¤‡"><!--[--><!--]--> 03 Servlet Demoå¼€å‘ç¯å¢ƒå‡†å¤‡ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/04 Servletè§„èŒƒRequestè§£è¯».md" class="nav-link sidebar-item" aria-label="04 Servletè§„èŒƒRequestè§£è¯»"><!--[--><!--]--> 04 Servletè§„èŒƒRequestè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/05 Servletè§„èŒƒServletContextè§£è¯».md" class="nav-link sidebar-item" aria-label="05 Servletè§„èŒƒServletContextè§£è¯»"><!--[--><!--]--> 05 Servletè§„èŒƒServletContextè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/06 Servletè§„èŒƒServletConfigè§£è¯».md" class="nav-link sidebar-item" aria-label="06 Servletè§„èŒƒServletConfigè§£è¯»"><!--[--><!--]--> 06 Servletè§„èŒƒServletConfigè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/07 Servletè§„èŒƒListenerè§£è¯».md" class="nav-link sidebar-item" aria-label="07 Servletè§„èŒƒListenerè§£è¯»"><!--[--><!--]--> 07 Servletè§„èŒƒListenerè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/08 Servletè§„èŒƒFilterè§£è¯».md" class="nav-link sidebar-item" aria-label="08 Servletè§„èŒƒFilterè§£è¯»"><!--[--><!--]--> 08 Servletè§„èŒƒFilterè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/09 Servletè§„èŒƒSessionè§£è¯».md" class="nav-link sidebar-item" aria-label="09 Servletè§„èŒƒSessionè§£è¯»"><!--[--><!--]--> 09 Servletè§„èŒƒSessionè§£è¯» <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/10 Tomcatæ•´ä½“æ¶æ„.md" class="nav-link sidebar-item" aria-label="10 Tomcatæ•´ä½“æ¶æ„"><!--[--><!--]--> 10 Tomcatæ•´ä½“æ¶æ„ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/11 Socketè¿æ¥ä¸ç¼“å†²åŒºæ•°æ®å¤„ç†.md" class="nav-link sidebar-item" aria-label="11 Socketè¿æ¥ä¸ç¼“å†²åŒºæ•°æ®å¤„ç†"><!--[--><!--]--> 11 Socketè¿æ¥ä¸ç¼“å†²åŒºæ•°æ®å¤„ç† <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/12 git.md" class="nav-link sidebar-item" aria-label="12 git"><!--[--><!--]--> 12 git <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/13 é•¿è¿æ¥åˆ†æ.md" class="nav-link sidebar-item" aria-label="13 é•¿è¿æ¥åˆ†æ"><!--[--><!--]--> 13 é•¿è¿æ¥åˆ†æ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/14 è§£æHTTPè¯·æ±‚.md" class="nav-link sidebar-item" aria-label="14 è§£æHTTPè¯·æ±‚"><!--[--><!--]--> 14 è§£æHTTPè¯·æ±‚ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/15 tomcatå¯åŠ¨æµç¨‹.md" class="nav-link sidebar-item" aria-label="15 tomcatå¯åŠ¨æµç¨‹"><!--[--><!--]--> 15 tomcatå¯åŠ¨æµç¨‹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/16 ç±»åŠ è½½å™¨.md" class="nav-link sidebar-item" aria-label="16 ç±»åŠ è½½å™¨"><!--[--><!--]--> 16 ç±»åŠ è½½å™¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/17 tomcatä¸­å¤šReactoræ¨¡å‹.md" class="nav-link sidebar-item" aria-label="17 tomcatä¸­å¤šReactoræ¨¡å‹"><!--[--><!--]--> 17 tomcatä¸­å¤šReactoræ¨¡å‹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/18 tomcatä¸­çš„ç±»åŠ è½½å™¨.md" class="nav-link sidebar-item active" aria-label="18 tomcatä¸­çš„ç±»åŠ è½½å™¨"><!--[--><!--]--> 18 tomcatä¸­çš„ç±»åŠ è½½å™¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/19 tomcatå¯åŠ¨æµç¨‹.md" class="nav-link sidebar-item" aria-label="19 tomcatå¯åŠ¨æµç¨‹"><!--[--><!--]--> 19 tomcatå¯åŠ¨æµç¨‹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/tomcat/å¸¸è§é—®é¢˜.md" class="nav-link sidebar-item" aria-label="å¸¸è§é—®é¢˜"><!--[--><!--]--> å¸¸è§é—®é¢˜ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="javaä¸­ç³»ç»Ÿè‡ªå¸¦çš„ç±»åŠ è½½å™¨" tabindex="-1"><a class="header-anchor" href="#javaä¸­ç³»ç»Ÿè‡ªå¸¦çš„ç±»åŠ è½½å™¨" aria-hidden="true">#</a> Javaä¸­ç³»ç»Ÿè‡ªå¸¦çš„ç±»åŠ è½½å™¨</h2><p>æ¯ä¸ªç±»åŠ è½½å™¨å¯¹åº”çš„ç›®å½•</p><p>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ æŒ‡å®šçš„classpathï¼‰ï¼Œæ‰©å±•ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p><p>â€œ<strong>åŒäº²å§”æ´¾</strong>â€: é¦–å…ˆå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œçˆ¶ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½åˆ°ç±»ï¼Œè‡ªå·±æ‰è¿›è¡Œç±»çš„åŠ è½½</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">{</span>
	<span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">// è¿›è¡Œäº†å¹¶å‘çš„æ§åˆ¶ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨å†åŠ è½½ä¸€ä¸ªç±»éƒ½æœ‰å¯¹åº”çš„ä¸€æŠŠé”</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" aria-hidden="true">#</a> è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h2><blockquote><p>æ‰“ç ´åŒäº²å§”æ´¾ï¼ˆ<strong>å°±æ˜¯åŠ è½½ç±»çš„å…ˆåé¡ºåºé—®é¢˜</strong>ï¼‰å°±æ˜¯è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨å…ˆå»åŠ è½½ï¼Œæ›´å¥½çš„åˆ©ç”¨åŒäº²å§”æ´¾ã€‚</p></blockquote><ol><li><p>ç»§æ‰¿æŠ½è±¡çš„ClassLoaderç±»</p></li><li><p>æŒ‡å®šçˆ¶ç±»åŠ è½½å™¨ä¸Javaç³»ç»Ÿå…³è”èµ·æ¥</p></li><li><p>æŒ‡å®šåŠ è½½ç±»çš„è·¯å¾„ï¼ˆåœ¨findClassä¸­ä½¿ç”¨è¯¥è·¯å¾„ï¼‰ï¼Œ<strong>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å®é™…å»åŠ è½½ç±»ï¼ˆå°†classæ–‡ä»¶è¯»å–æˆäºŒè¿›åˆ¶æµï¼Œç„¶åè½¬åŒ–ä¸ºClasså¯¹è±¡ï¼‰</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// è¯»å–æ–‡ä»¶ä¸ºå­—èŠ‚</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;æŒ‡å®šç›®å½•ä¸‹çš„ç±»æ–‡ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è°ƒç”¨javaä¸­æä¾›çš„defineClassæ–¹æ³•å°†å­—èŠ‚æ•°æ®å˜æˆJavaå¯¹è±¡ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æˆ–è¿›è¡Œç±»çš„æ²™ç®±ä¿æŠ¤æœºåˆ¶</span>
     <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>åœ¨loadClassæ–¹æ³•ä¸­è¿›è¡Œæ‰“ç ´åŒäº²å§”æ´¾</p><ol><li><p>éœ€è¦æ³¨æ„åˆ°çš„ç‚¹æ˜¯<strong>åœ¨åŠ è½½ä¸€ä¸ªç±»çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªç±»ä¾èµ–åˆ°çš„å…¶ä»–ç±»ï¼Œé‚£ä¹ˆè¿™äº›ç±»ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨è¿›è¡Œå»åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´javaç³»ç»Ÿå°±ä¼šå†æ¬¡è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªä¾èµ–çš„ç±»ï¼Œä¹Ÿå°±è¯´é‡æ–°è°ƒç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•</strong></p></li><li><p>javaæœ‰<strong>æ²™ç®±ä¿æŠ¤æœºåˆ¶</strong>ï¼Œå¯¹äºåŒ…åä»¥javaå¼€å¤´çš„ç±»ï¼Œä¼šæä¾›ä¿æŠ¤ã€‚æ‰€ä»¥javaä¸­ä¿æŠ¤ç±»éœ€è¦å…ˆä½¿ç”¨Javaä¸­ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œ<strong>ä½†æ˜¯æˆ‘ä»¬éœ€è¦è¶Šè¿‡ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>SecurityException</span><span class="token operator">:</span> <span class="token class-name">Prohibited</span> <span class="token keyword">package</span> <span class="token namespace">name</span><span class="token operator">:</span> java<span class="token punctuation">.</span>lang
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ol></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>hzz</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassLoader</span> extClassLoader <span class="token operator">=</span> <span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
             aClass <span class="token operator">=</span> extClassLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ignore<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>aClass <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> aClass<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\learncode\\classloader\\out\\production\\classloader\\org\\hzz\\Test1.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// defineClassæ–¹æ³•ä¸­ä¼šè¿›è¡Œç±»çš„æ²™ç®±å®‰å…¨ä¿æŠ¤æœºåˆ¶</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> aClass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> b<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            data <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>in <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyClassLoader</span> myClassLoader1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyClassLoader</span> myClassLoader2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> myClassLoader1<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> bClass <span class="token operator">=</span> myClassLoader2<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aClass <span class="token operator">==</span> bClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// org.hzz.MyClassLoader@1b6d3586</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h2 id="ä¸åŒç±»åŠ è½½å™¨å®ä¾‹åŠ è½½å‡ºæ¥çš„ç±»æ˜¯ä¸åŒçš„" tabindex="-1"><a class="header-anchor" href="#ä¸åŒç±»åŠ è½½å™¨å®ä¾‹åŠ è½½å‡ºæ¥çš„ç±»æ˜¯ä¸åŒçš„" aria-hidden="true">#</a> ä¸åŒç±»åŠ è½½å™¨å®ä¾‹åŠ è½½å‡ºæ¥çš„ç±»æ˜¯ä¸åŒçš„</h2><blockquote><p>JVMä¸­ç¡®å®šä¸€ä¸ªç±»æ˜¯ classloader + class</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MyClassLoader</span> myClassLoader1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MyClassLoader</span> myClassLoader2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> myClassLoader1<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> bClass <span class="token operator">=</span> myClassLoader2<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aClass <span class="token operator">==</span> bClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="tomcatç±»åŠ è½½å™¨å¤„ç†åº”ç”¨çš„åŸç†" tabindex="-1"><a class="header-anchor" href="#tomcatç±»åŠ è½½å™¨å¤„ç†åº”ç”¨çš„åŸç†" aria-hidden="true">#</a> tomcatç±»åŠ è½½å™¨å¤„ç†åº”ç”¨çš„åŸç†</h2><p>WebappClassLoader:tomatä¸­ç”¨äºéƒ¨ç½²åº”ç”¨ï¼Œæ¯”å¦‚è¯´æœ‰ä¸¤ä¸ªåº”ç”¨ï¼Œè¿™ä¸¤ä¸ªåº”ç”¨éƒ½æœ‰ç›¸åŒçš„ç±»åã€‚org.hzz.Testã€‚</p><p>é‚£ä¹ˆtomcatä¸ºäº†åŒºåˆ†ï¼Œå°±ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œæ¥åˆ†åˆ«åŠ è½½åº”ç”¨ä¸­çš„ç±»</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>WebappClassLoaderå®ä¾‹(ç›®å½•)--------åº”ç”¨1
WebappClassLoaderå®ä¾‹ï¼ˆç›®å½•ï¼‰--------åº”ç”¨2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Tomcatä¸­å†…éƒ¨ä¹Ÿæœ‰å¾ˆå¤šç±»éœ€è¦åŠ è½½,</p><p>tomcatä¸­çš„å®ç°</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Context</span>
	name
	<span class="token class-name">WebappClassLoader</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/images/tomcat/image-20220508145923528.png" alt=""></p><h2 id="webappclassloaderåŠ è½½ç±»åŸç†" tabindex="-1"><a class="header-anchor" href="#webappclassloaderåŠ è½½ç±»åŸç†" aria-hidden="true">#</a> WebappClassLoaderåŠ è½½ç±»åŸç†</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1. å…ˆä»tomcatçš„ç¼“å†²ä¸­æŸ¥æ‰¾æ˜¯å¦åŠ è¿‡è¿™ä¸ªç±»
2. å†ä»jvmçš„ç¼“å†²ä¸­æŸ¥æ‰¾æ˜¯å¦åŠ è½½è¿‡è¿™ä¸ªç±»
3. å…ˆä»æ‰©å¼ ç±»åŠ è½½åŠ è½½å™¨å»åŠ è½½ç±»ï¼Œå¤„ç†javaçš„æ²™ç®±å®‰å…¨ä¿æŠ¤æœºåˆ¶ã€
4. æ˜¯å¦ç”¨çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ Class.forName(name,false,parentClassLoader);
5. æ²¡æœ‰å§”æ‰˜ï¼Œé‚£ä¹ˆå°±è‡ªå·±å°±å…ˆå»åŠ è½½ç±»
6. è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="å®é™…å»åŠ è½½ç±»findclass" tabindex="-1"><a class="header-anchor" href="#å®é™…å»åŠ è½½ç±»findclass" aria-hidden="true">#</a> å®é™…å»åŠ è½½ç±»findClass</h3><blockquote><p>ä»å¼•ç”¨çš„classes ç›®å½•å’ŒlibåŒ…ç›®å½•ä¸‹</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// WebappClassLoaderBase  ResourceEntry findResourceInternal</span>
<span class="token number">1.</span> å…ˆç”Ÿæˆ<span class="token class-name">ResourceEntry</span>å¯¹è±¡ï¼ˆurlpath<span class="token punctuation">,</span>æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹ï¼ŒloadedClasså¯¹è±¡ï¼‰
	<span class="token number">2.</span> åœ¨ç”Ÿæˆçš„<span class="token class-name">ResourceEntry</span>å¯¹è±¡ä¸­ä¼šå»è¯»å–<span class="token keyword">class</span>æ–‡ä»¶
	
<span class="token number">2.</span> è·å–è¿™ä¸ª<span class="token class-name">ResourceEntry</span>å¯¹è±¡ä¸­åŠ è½½çš„ç±»æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå»ç”Ÿæˆç±»ï¼ˆdefineClassï¼‰
<span class="token number">3.</span> å°†è¿™ä¸ª<span class="token class-name">ResourceEntry</span>çš„å±æ€§
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>é‚£ä¹ˆå¦‚ä½•å»æ‰¾åˆ°æ–‡ä»¶ï¼Œç”Ÿæˆå­—èŠ‚æµå‘¢ï¼Ÿå°¤å…¶æ˜¯åœ¨jaråŒ…ä¸­çš„</p><ol><li><p>æ™®é€šçš„classæ ¹æ®è·¯å¾„ç›´æ¥å»æ‰¾</p></li><li><p>jaråŒ…é‡Œé¢çš„class</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å»JaråŒ…ä¸­å¯»æ‰¾è¿™ä¸ªç±»,æ‰åˆ°äº†è¿”å›,æ²¡æœ‰å°±ä¸ºnull</span>
<span class="token class-name">JarEntry</span> jarfile <span class="token operator">=</span> <span class="token class-name">JarFile</span><span class="token punctuation">.</span><span class="token function">getJarEntry</span><span class="token punctuation">(</span><span class="token string">&quot;org/apache/catalina/deploy/ServletDef.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h2 id="å®æˆ˜ä»jaråŒ…ä¸­åŠ è½½ä¸€ä¸ªç±»" tabindex="-1"><a class="header-anchor" href="#å®æˆ˜ä»jaråŒ…ä¸­åŠ è½½ä¸€ä¸ªç±»" aria-hidden="true">#</a> å®æˆ˜ä»jaråŒ…ä¸­åŠ è½½ä¸€ä¸ªç±»</h2><blockquote><p>D:\learncode\classloader\src\org\hzz\JarFileTest.java</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>hzz</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>jar<span class="token punctuation">.</span></span><span class="token class-name">JarFile</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>zip<span class="token punctuation">.</span></span><span class="token class-name">ZipEntry</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JarFileTest</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">JarFile</span> jarFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JarFile</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\learncode\\classloader\\myjars\\hzz-test.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ZipEntry</span> entry <span class="token operator">=</span> jarFile<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token string">&quot;org/hzz/Test1.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¤„ç†äºŒè¿›åˆ¶æ•°æ®</span>
        <span class="token keyword">int</span> contentLength <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>entry<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> binaryContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>contentLength<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> binaryStream <span class="token operator">=</span> jarFile<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> n <span class="token operator">=</span> binaryStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>binaryContent<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                    binaryContent<span class="token punctuation">.</span>length <span class="token operator">-</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            pos <span class="token operator">+=</span> n<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åŠ è½½ç±»</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JarFileTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">,</span>
                binaryContent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binaryContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> main <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Thread.currentThread().setContextClassLoader(aClass.getClassLoader());</span>
        main<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        Enumeration entries = jarFile.entries();</span>
<span class="token comment">//        while (entries.hasMoreElements()) {</span>
<span class="token comment">//            System.out.println(entries.nextElement());</span>
<span class="token comment">//        }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="çƒ­åŠ è½½" tabindex="-1"><a class="header-anchor" href="#çƒ­åŠ è½½" aria-hidden="true">#</a> çƒ­åŠ è½½</h2><p>WebappLoader.java</p><p>éœ€è¦æœ‰ä¸€ä¸ªçº¿ç¨‹å»ç›‘å¬</p><h3 id="æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¿®æ”¹" aria-hidden="true">#</a> æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¿®æ”¹</h3><h4 id="_1-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å˜åŒ–" aria-hidden="true">#</a> 1. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼Ÿ</h4><p>æ¯”è¾ƒæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚</p><p>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨äº†ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</p><hr><p><strong>jaråŒ…æ˜¯å¦æœ‰æ·»åŠ å’Œåˆ é™¤</strong>: tomcatåœ¨åŠ è½½åº”ç”¨æ—¶ä¼šæŠŠjaråŒ…çš„åç§°å­˜å‚¨èµ·æ¥ï¼Œå½“æ£€æµ‹çš„æ—¶å€™ï¼Œåˆå»è·å–æ‰€æ‰€æœ‰çš„jaråŒ…ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[1.jar,2.jar]  å¯åŠ¨æ—¶è¯»å–åˆ°çš„jaråŒ…
[11.jar,23.jar]  ä¿®æ”¹åçš„jaråŒ…ï¼Œæ£€æµ‹æ—¶è¯»å–åˆ°çš„
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å½“æ£€æµ‹åˆ°æœ‰ä¿®æ”¹åã€‚å°±è°ƒç”¨StandardContext.reload</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>åœ¨reloadä¸­ä¼šé‡æ–°stop()---&gt;start()
çƒ­åŠ è½½ contextå®ä¾‹è¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªæ˜¯åœ¨stopæ—¶å°†webappclassLoader = null;å½“startæ—¶åˆä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªWebAppClassLoader
æœ€åè°ƒç”¨WebappLoaderä¸­çš„startInternal()æ–¹æ³•ï¼Œåˆ›å»ºæ–°çš„WebappClassLoaderå®ä¾‹ï¼Œç„¶åå¼€å§‹é‡æ–°åŠ è½½åº”ç”¨ã€‚åˆ°æ­¤tomcatçš„çƒ­éƒ¨ç½²æµç¨‹å°±å®Œæˆäº†ã€‚
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨javaä¸­ç±»çš„åŠ è½½æ˜¯jvmè‡ªåŠ¨å¸®æˆ‘ä»¬åšçš„ã€‚é‚£ä¹ˆåœ¨tomcatä¸­è‡ªå®šä¹‰åŠ è½½å™¨ä¹‹åï¼Œéš¾é“åŠ è½½åº”ç”¨çš„ç±»æ—¶ã€‚æ¯æ¬¡éƒ½å»è°ƒç”¨WebappClassLoaderçš„loadClassæ–¹æ³•å—ï¼Ÿ<strong>åªéœ€è¦loadClassä¸€æ¬¡ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç±»ä¸­æ‰€æœ‰newå‡ºæ¥çš„å¯¹è±¡éƒ½æ˜¯ç”±è¿™ä¸ªç±»åŠ è½½åŠ è½½çš„</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å¦‚æœæˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½ä¸€ä¸ªç±»</span>
<span class="token class-name">MyClassLoader1</span> myClassLoader1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> aClass <span class="token operator">=</span> myClassLoader1<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;org.hzz.Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> o <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//åœ¨Test1çš„æ„é€ æ–¹æ³•ä¸­A a = new A()å¯¹è±¡ï¼Œé‚£ä¹ˆa.getClass().getClassLoader()è¿˜æ˜¯æˆ‘ä»¬è‡ªå®šçš„ç±»åŠ è½½å™¨</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Context
	name
	reloadable = true
	WebappClassLoader
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç¬¬äºŒä¸ªé—®é¢˜ï¼š å¦‚æœä¹‹å‰çš„ç±»å·²ç»å®ä¾‹åŒ–äº†ï¼Œå·²ç»è¢«ä¸šåŠ¡ä»£ç ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆé‡æ–°åŠ è½½è¿™ä¸ªç±»ï¼Œæ€ä¹ˆç›´åˆ°å“ªä¸ªä¸šåŠ¡ç±»å¼•ç”¨äº†è¿™ä¸ªå®ä¾‹ï¼Ÿå…¶å®å¹¶ä¸æ˜¯æˆ‘æƒ³çš„è¿™æ ·ï¼Œè€Œæ˜¯æŠŠæ•´ä¸ªåº”ç”¨åˆé‡æ–°åŠ è½½äº†ä¸€éã€‚<a href="https://www.cnblogs.com/yuanjia2717/p/11279312.html" target="_blank" rel="noopener noreferrer">Tomcatçƒ­éƒ¨ç½²å®ç°åŸç† - andrew2717 - åšå®¢å›­ (cnblogs.com)<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h2 id="ä»€ä¹ˆæ˜¯çƒ­éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯çƒ­éƒ¨ç½²" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯çƒ­éƒ¨ç½²ï¼Ÿ</h2><p>tomcatä¸­åº”ç”¨çš„é…ç½®å˜æ›´äº†</p><p>ä¼šå°†contextå®ä¾‹é”€æ¯æ‰ï¼Œé‡æ–°æ–°ç”Ÿä¸€ä¸ªContext</p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.2c87fbe0.js" defer></script><script src="/assets/js/95615.aba5921d.js" defer></script><script src="/assets/js/app.4aafd1f6.js" defer></script>
  </body>
</html>
